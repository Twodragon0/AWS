"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.TextToSql = exports.MetatdataSource = exports.DbName = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const path = require("path");
const cdk = require("aws-cdk-lib");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const ec2 = require("aws-cdk-lib/aws-ec2");
const events = require("aws-cdk-lib/aws-events");
const iam = require("aws-cdk-lib/aws-iam");
const lambda = require("aws-cdk-lib/aws-lambda");
const logs = require("aws-cdk-lib/aws-logs");
const rds = require("aws-cdk-lib/aws-rds");
const s3 = require("aws-cdk-lib/aws-s3");
const secretsmanager = require("aws-cdk-lib/aws-secretsmanager");
const sqs = require("aws-cdk-lib/aws-sqs");
const stepfunctions = require("aws-cdk-lib/aws-stepfunctions");
const tasks = require("aws-cdk-lib/aws-stepfunctions-tasks");
const cdk_nag_1 = require("cdk-nag");
const base_class_1 = require("../../../common/base-class/base-class");
const construct_name_enum_1 = require("../../../common/base-class/construct-name-enum");
const custom_resource_provider_helper_1 = require("../../../common/helpers/custom-resource-provider-helper");
const eventBridgeHelper = require("../../../common/helpers/eventbridge-helper");
const lambda_builder_helper_1 = require("../../../common/helpers/lambda-builder-helper");
const s3BucketHelper = require("../../../common/helpers/s3-bucket-helper");
const utils_1 = require("../../../common/helpers/utils");
const vpcHelper = require("../../../common/helpers/vpc-helper");
const types_1 = require("../../../patterns/gen-ai/aws-rag-appsync-stepfn-kendra/types");
var DbName;
(function (DbName) {
    DbName["MYSQL"] = "MySQL";
    DbName["POSTGRESQL"] = "PostgreSQL";
})(DbName || (exports.DbName = DbName = {}));
var MetatdataSource;
(function (MetatdataSource) {
    MetatdataSource["CONFIG_FILE"] = "config_file";
    MetatdataSource["KNOWLEDGE_BASE"] = "knowledge_base";
})(MetatdataSource || (exports.MetatdataSource = MetatdataSource = {}));
class TextToSql extends base_class_1.BaseClass {
    /**
     * Constructs a new instance of the TextToSql class.
     * @param {Construct} scope - represents the scope for all the resources.
     * @param {string} id - this is a a scope-unique id.
     * @param {TextToSqlProps} props - user provided props for the construct.
     * @since 0.0.0
     * @public
     */
    constructor(scope, id, props) {
        super(scope, id);
        const baseProps = {
            stage: props.stage,
            constructName: construct_name_enum_1.ConstructName.AWSTEXTTOSQL,
            constructId: id,
            observability: props.observability,
        };
        vpcHelper.CheckVpcProps(props);
        s3BucketHelper.CheckS3Props({
            existingBucketObj: props.existingconfigAssetsBucketObj,
            bucketProps: props.configAssetsBucketProps,
        });
        eventBridgeHelper.CheckEventBridgeProps(props);
        this.updateEnvSuffix(baseProps);
        this.addObservabilityToConstruct(baseProps);
        // vpc
        if (props?.existingVpc && props?.existingSubnetGroup) {
            this.vpc = props.existingVpc;
            this.subnetGroup = props.existingSubnetGroup;
        }
        else {
            this.vpc = new ec2.Vpc(this, 'Vpc', props.vpcProps);
            this.subnetGroup = new rds.SubnetGroup(this, 'SubnetGroup', {
                vpc: this.vpc,
                vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS },
                description: 'Subnet group for Aurora Serverless',
            });
        }
        // add VPC endpoints for the compute environment
        vpcHelper.AddAwsServiceEndpoint(this, this.vpc, types_1.ServiceEndpointTypeEnum.EVENTS);
        vpcHelper.AddAwsServiceEndpoint(this, this.vpc, types_1.ServiceEndpointTypeEnum.STEP_FUNCTIONS);
        vpcHelper.AddAwsServiceEndpoint(this, this.vpc, types_1.ServiceEndpointTypeEnum.S3);
        const dbPort = props.dbPort ? props.dbPort : 1534;
        // Security group
        if (props?.existingLambdaSecurityGroup) {
            this.lambdaSecurityGroup = props.existingLambdaSecurityGroup;
        }
        else {
            this.lambdaSecurityGroup = new ec2.SecurityGroup(this, 'lambdaSecurityGroup', {
                vpc: this.vpc,
                allowAllOutbound: true,
            });
        }
        if (props?.existingDBSecurityGroup) {
            this.dbSecurityGroup = props.existingDBSecurityGroup;
        }
        else {
            this.dbSecurityGroup = new ec2.SecurityGroup(this, 'DBSecurityGroup', {
                vpc: this.vpc,
            });
            // Add an inbound rule to allow traffic from the Lambda security group
            this.dbSecurityGroup.addIngressRule(ec2.Peer.securityGroupId(this.lambdaSecurityGroup.securityGroupId), ec2.Port.tcp(dbPort), // Assuming MySQL is running on port 3306
            'Allow Lambda function to access the database');
        }
        // vpc flowloggroup
        const logGroup = new logs.LogGroup(this, 'textToSqlConstructVPCGroup');
        const vpcFlowLogrole = new iam.Role(this, 'textToSqlConstructRole', {
            assumedBy: new iam.ServicePrincipal('vpc-flow-logs.amazonaws.com'),
        });
        // vpc flowlogs
        new ec2.FlowLog(this, 'FlowLog', {
            resourceType: ec2.FlowLogResourceType.fromVpc(this.vpc),
            destination: ec2.FlowLogDestination.toCloudWatchLogs(logGroup, vpcFlowLogrole),
        });
        // bucket for storing server access logging
        const serverAccessLogBucket = new s3.Bucket(this, 'serverAccessLogBucket' + this.stage, {
            blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL,
            encryption: s3.BucketEncryption.S3_MANAGED,
            enforceSSL: true,
            versioned: true,
            lifecycleRules: [
                {
                    expiration: cdk.Duration.days(90),
                },
            ],
        });
        // config asset bucket
        if (props?.existingconfigAssetsBucketObj) {
            this.configAssetBucket = props.existingconfigAssetsBucketObj;
        }
        else if (props?.configAssetsBucketProps) {
            this.configAssetBucket = new s3.Bucket(this, 'configasset' + this.stage, props.configAssetsBucketProps);
        }
        else {
            this.configAssetBucket = new s3.Bucket(this, 'configasset' + this.stage, {
                accessControl: s3.BucketAccessControl.PRIVATE,
                blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL,
                encryption: s3.BucketEncryption.S3_MANAGED,
                bucketName: 'configasset' +
                    this.stage.toLowerCase() +
                    '-' +
                    cdk.Aws.REGION +
                    '-' +
                    cdk.Aws.ACCOUNT_ID,
                serverAccessLogsBucket: serverAccessLogBucket,
                enforceSSL: true,
                versioned: true,
                lifecycleRules: [
                    {
                        expiration: cdk.Duration.days(90),
                    },
                ],
            });
        }
        const configFilePath = path.join(__dirname, '../../../../resources/gen-ai/aws-text-to-sql');
        const textToSQLFunctionRole = new iam.Role(this, 'queryConfigFunctionRole', {
            assumedBy: new iam.ServicePrincipal('lambda.amazonaws.com'),
            inlinePolicies: {
                LambdaFunctionServiceRolePolicy: new iam.PolicyDocument({
                    statements: [
                        new iam.PolicyStatement({
                            actions: [
                                'logs:CreateLogGroup',
                                'logs:CreateLogStream',
                                'logs:PutLogEvents',
                                'bedrock:InvokeModel',
                                'bedrock:InvokeModelWithResponseStream',
                                's3:GetObject',
                                's3:GetBucketLocation',
                                's3:ListBucket',
                                's3:PutObject',
                            ],
                            resources: [
                                `arn:${aws_cdk_lib_1.Aws.PARTITION}:logs:${aws_cdk_lib_1.Aws.REGION}:${aws_cdk_lib_1.Aws.ACCOUNT_ID}:log-group:/aws/lambda/*`,
                                'arn:' +
                                    aws_cdk_lib_1.Aws.PARTITION +
                                    ':s3:::' +
                                    this.configAssetBucket.bucketName +
                                    '/*',
                                `arn:${aws_cdk_lib_1.Aws.PARTITION}:logs:${aws_cdk_lib_1.Aws.REGION}:${aws_cdk_lib_1.Aws.ACCOUNT_ID}:log-group:/aws/lambda/*`,
                                'arn:' +
                                    aws_cdk_lib_1.Aws.PARTITION +
                                    ':bedrock:' +
                                    aws_cdk_lib_1.Aws.REGION +
                                    '::foundation-model/*',
                            ],
                        }),
                    ],
                }),
            },
        });
        // Minimum permissions for a Lambda function to execute while accessing a resource within a VPC
        textToSQLFunctionRole.addToPolicy(new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: [
                'ec2:CreateNetworkInterface',
                'ec2:DeleteNetworkInterface',
                'ec2:AssignPrivateIpAddresses',
                'ec2:UnassignPrivateIpAddresses',
            ],
            resources: [
                'arn:' +
                    aws_cdk_lib_1.Aws.PARTITION +
                    ':ec2:' +
                    aws_cdk_lib_1.Aws.REGION +
                    ':' +
                    aws_cdk_lib_1.Aws.ACCOUNT_ID +
                    ':*/*',
            ],
        }));
        textToSQLFunctionRole.addToPolicy(new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: ['ec2:DescribeNetworkInterfaces'],
            resources: ['*'],
        }));
        textToSQLFunctionRole.addToPolicy(new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: ['s3:ListBucket'],
            resources: [
                'arn:' + aws_cdk_lib_1.Aws.PARTITION + ':s3:::' + this.configAssetBucket.bucketName,
            ],
        }));
        const configLoaderPolicy = new iam.ManagedPolicy(this, 'AuroraPgPolicy', {
            managedPolicyName: (0, utils_1.generatePhysicalNameV2)(this, 'configLoaderPolicy', {
                maxLength: 32,
                lower: true,
            }),
            statements: [
                new iam.PolicyStatement({
                    actions: [
                        'ec2:DescribeInstances',
                        'ec2:CreateNetworkInterface',
                        'ec2:AttachNetworkInterface',
                        'ec2:DescribeNetworkInterfaces',
                        'autoscaling:CompleteLifecycleAction',
                        'ec2:DeleteNetworkInterface',
                    ],
                    resources: ['*'],
                }),
                new iam.PolicyStatement({
                    actions: [
                        'logs:CreateLogGroup',
                        'logs:CreateLogStream',
                        'logs:PutLogEvents',
                        'bedrock:InvokeModel',
                        'bedrock:InvokeModelWithResponseStream',
                        's3:GetObject',
                        's3:GetBucketLocation',
                        's3:ListBucket',
                        's3:PutObject',
                    ],
                    resources: [
                        `arn:${aws_cdk_lib_1.Aws.PARTITION}:logs:${aws_cdk_lib_1.Aws.REGION}:${aws_cdk_lib_1.Aws.ACCOUNT_ID}:log-group:/aws/lambda/*`,
                        'arn:' +
                            aws_cdk_lib_1.Aws.PARTITION +
                            ':s3:::' +
                            this.configAssetBucket.bucketName +
                            '/*',
                        `arn:${aws_cdk_lib_1.Aws.PARTITION}:logs:${aws_cdk_lib_1.Aws.REGION}:${aws_cdk_lib_1.Aws.ACCOUNT_ID}:log-group:/aws/lambda/*`,
                        'arn:' +
                            aws_cdk_lib_1.Aws.PARTITION +
                            ':bedrock:' +
                            aws_cdk_lib_1.Aws.REGION +
                            '::foundation-model/*',
                    ],
                }),
            ],
        });
        const customResource = (0, custom_resource_provider_helper_1.buildCustomResourceProvider)({
            providerName: 'ConfigFileLoaderCRProvider',
            vpc: this.vpc,
            securityGroup: this.lambdaSecurityGroup,
            codePath: path.join(__dirname, '../../../../lambda/aws-text-to-sql'),
            handler: 'custom_resources.on_event',
            runtime: cdk.aws_lambda.Runtime.PYTHON_3_12,
        });
        const crProvider = customResource.getProvider(this);
        crProvider.role.addManagedPolicy(configLoaderPolicy);
        const configFileLoader = new cdk.CustomResource(this, 'ConfigFileLoader', {
            resourceType: 'Custom::ConfigFileLoader',
            serviceToken: crProvider.serviceToken,
            properties: {
                configBucket: this.configAssetBucket.bucketName,
                configFilePath: configFilePath,
            },
        });
        configFileLoader.node.addDependency(this.configAssetBucket);
        //crProvider.role.node.addDependency(configLoaderPolicy);
        cdk_nag_1.NagSuppressions.addResourceSuppressions(textToSQLFunctionRole, [
            {
                id: 'AwsSolutions-IAM5',
                reason: 'AWSLambdaBasicExecutionRole is used.',
            },
        ], true);
        const reformulateQuestionFunctionName = (0, utils_1.generatePhysicalNameV2)(this, 'reformulateQuestionFunction' + this.stage, { maxLength: 63, lower: true });
        const reformulateQuestionFunctionProps = {
            functionName: reformulateQuestionFunctionName,
            description: 'Lambda function to reformulate user question',
            code: lambda.DockerImageCode.fromImageAsset(path.join(__dirname, '../../../../lambda/aws-text-to-sql/reformulate_question')),
            vpc: this.vpc,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS },
            securityGroups: [this.lambdaSecurityGroup],
            memorySize: (0, utils_1.lambdaMemorySizeLimiter)(this, 1769 * 4),
            timeout: aws_cdk_lib_1.Duration.minutes(10),
            tracing: this.lambdaTracing,
            role: textToSQLFunctionRole,
            environment: {
                DB_NAME: props.dbName,
                METADATA_SOURCE: props.metadataSource,
                CONFIG_BUCKET: this.configAssetBucket.bucketName,
            },
        };
        // Lambda function to load  the config and do all pre steps before query generation.
        const reformulateQuestionFunction = (0, lambda_builder_helper_1.buildDockerLambdaFunction)(this, 'reformulateQuestionFunction' + this.stage, reformulateQuestionFunctionProps, props.customQueryConfigurerLambdaProps);
        const queryGeneratorFunctionName = (0, utils_1.generatePhysicalNameV2)(this, 'queryGeneratorFunction' + this.stage, { maxLength: 63, lower: true });
        const queryGeneratorFunctionProps = {
            functionName: queryGeneratorFunctionName,
            description: 'Lambda function to generate the query based on user question.',
            code: lambda.DockerImageCode.fromImageAsset(path.join(__dirname, '../../../../lambda/aws-text-to-sql/query_generator')),
            vpc: this.vpc,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS },
            securityGroups: [this.lambdaSecurityGroup],
            memorySize: (0, utils_1.lambdaMemorySizeLimiter)(this, 1769 * 4),
            timeout: aws_cdk_lib_1.Duration.minutes(10),
            tracing: this.lambdaTracing,
            role: textToSQLFunctionRole,
            environment: {
                DB_NAME: props.dbName,
                CONFIG_BUCKET: this.configAssetBucket.bucketName,
                SECRET_ARN: props.databaseSecretARN,
            },
        };
        // Lambda function used to generate the query
        const queryGeneratorFunction = (0, lambda_builder_helper_1.buildDockerLambdaFunction)(this, 'queryGeneratorFunction' + this.stage, queryGeneratorFunctionProps, props.customQueryGeneratorLambdaProps);
        // Lambda function used to execute the query
        const queryExecutorFunctionName = (0, utils_1.generatePhysicalNameV2)(this, 'queryExecutorFunctionName' + this.stage, { maxLength: 63, lower: true });
        const queryExecutorFunctionProps = {
            functionName: queryExecutorFunctionName,
            description: 'Lambda function to execute the query.',
            code: lambda.DockerImageCode.fromImageAsset(path.join(__dirname, '../../../../lambda/aws-text-to-sql/query_executor')),
            vpc: this.vpc,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS },
            securityGroups: [this.lambdaSecurityGroup],
            memorySize: (0, utils_1.lambdaMemorySizeLimiter)(this, 1769 * 4),
            timeout: aws_cdk_lib_1.Duration.minutes(10),
            tracing: this.lambdaTracing,
            role: textToSQLFunctionRole,
            environment: {
                DB_NAME: props.dbName,
                CONFIG_BUCKET: this.configAssetBucket.bucketName,
                SECRET_ARN: props.databaseSecretARN,
            },
        };
        // Lambda function used to generate the query
        const queryExecutorFunction = (0, lambda_builder_helper_1.buildDockerLambdaFunction)(this, 'queryExecutorFunctionName' + this.stage, queryExecutorFunctionProps, props.customQueryExecutorLambdaProps);
        // lambda function for autocorrect loop
        const autocorrectQueryFunctionName = (0, utils_1.generatePhysicalNameV2)(this, 'autocorrectQueryFunction' + this.stage, { maxLength: 63, lower: true });
        const autocorrectQueryFunctionProps = {
            functionName: autocorrectQueryFunctionName,
            description: 'Lambda function to keep the count of autocorrect loop.',
            code: lambda.DockerImageCode.fromImageAsset(path.join(__dirname, '../../../../lambda/aws-text-to-sql/query_autocorrect')),
            vpc: this.vpc,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS },
            securityGroups: [this.lambdaSecurityGroup],
            memorySize: (0, utils_1.lambdaMemorySizeLimiter)(this, 1769 * 4),
            timeout: aws_cdk_lib_1.Duration.minutes(10),
            tracing: this.lambdaTracing,
            role: textToSQLFunctionRole,
        };
        const autocorrectQueryFunction = (0, lambda_builder_helper_1.buildDockerLambdaFunction)(this, 'autocorrectQueryFunction' + this.stage, autocorrectQueryFunctionProps, undefined);
        const feedbackQueueName = (0, utils_1.generatePhysicalNameV2)(this, 'feedbackQueue' + this.stage, { maxLength: 63, lower: true });
        const queue = new sqs.Queue(this, 'userFeedbackQueue', {
            queueName: feedbackQueueName,
            visibilityTimeout: aws_cdk_lib_1.Duration.seconds(3600),
        });
        queue.addToResourcePolicy(new iam.PolicyStatement({
            effect: iam.Effect.DENY,
            principals: [new iam.AnyPrincipal()],
            actions: ['sqs:*'],
            resources: [queue.queueArn],
            conditions: {
                Bool: {
                    'aws:SecureTransport': 'false',
                },
            },
        }));
        this.feedbackQueue = queue;
        const outputQueueName = (0, utils_1.generatePhysicalNameV2)(this, 'outputQueue' + this.stage, { maxLength: 63, lower: true });
        const outputQueue = new sqs.Queue(this, 'outputQueue', {
            queueName: outputQueueName,
            visibilityTimeout: aws_cdk_lib_1.Duration.seconds(3600),
        });
        outputQueue.addToResourcePolicy(new iam.PolicyStatement({
            effect: iam.Effect.DENY,
            principals: [new iam.AnyPrincipal()],
            actions: ['sqs:*'],
            resources: [outputQueue.queueArn],
            conditions: {
                Bool: {
                    'aws:SecureTransport': 'false',
                },
            },
        }));
        this.outputQueue = outputQueue;
        const dbsecret = secretsmanager.Secret.fromSecretCompleteArn(this, 'dbsecret', props.databaseSecretARN);
        dbsecret.grantRead(queryGeneratorFunction);
        dbsecret.grantRead(queryExecutorFunction);
        const reformulateQuestionState = new tasks.LambdaInvoke(this, 'reformulate_question', {
            lambdaFunction: reformulateQuestionFunction,
            inputPath: '$.detail',
            resultPath: '$.queryConfig',
        });
        const reformulatedQuestionFeedbackState = new tasks.SqsSendMessage(this, 'get_feedback_on_reformulated_question', {
            queue,
            messageBody: stepfunctions.TaskInput.fromObject({
                message: 'Following is the reformulated question. Do you agree with the new question?',
                reformualted_question: stepfunctions.TaskInput.fromJsonPathAt('$.reformulated_user_question'),
                user_question: stepfunctions.TaskInput.fromJsonPathAt('$.user_question'),
                question_unique_id: stepfunctions.TaskInput.fromJsonPathAt('$.question_unique_id'),
                execute_sql_strategy: stepfunctions.TaskInput.fromJsonPathAt('$.execute_sql_strategy'),
                execution_start_time: stepfunctions.TaskInput.fromJsonPathAt('$.execution_start_time'),
                TaskToken: stepfunctions.JsonPath.taskToken,
            }),
            integrationPattern: stepfunctions.IntegrationPattern.WAIT_FOR_TASK_TOKEN,
        });
        const alternateQueryGeneratorState = new tasks.LambdaInvoke(this, 'generate_alternate_query', {
            lambdaFunction: queryGeneratorFunction,
            resultPath: '$.queryConfig',
        });
        // SF loggroup
        const sflogGroup = new logs.LogGroup(this, 'TextToSqlStepFunctionLogGroup', {
            logGroupName: '/aws/vendedlogs/states/TextToSqlStepFunction',
            removalPolicy: cdk.RemovalPolicy.DESTROY,
        });
        const autocorrectChoiceState = new stepfunctions.Choice(this, 'is_autocorrect_required?', {});
        const configureCountState = new stepfunctions.Pass(this, 'configure_count', {
            result: stepfunctions.Result.fromObject({
                count: 3,
                index: 0,
                step: 1,
            }),
            resultPath: '$.iterator',
        });
        const iteratorState = new tasks.LambdaInvoke(this, 'iterator', {
            lambdaFunction: autocorrectQueryFunction,
            resultPath: '$.iterator',
        });
        const isCountReachedState = new stepfunctions.Choice(this, 'is_count_reached', {
        //inputPath: '$.iterator',
        });
        // const queryGeneratorTwoState = new tasks.LambdaInvoke(
        //   this,
        //   'generate_query_path_two',
        //   {
        //     lambdaFunction: queryGeneratorFunction,
        //     resultPath: '$.queryConfig',
        //   },
        // );
        const outputState = new tasks.SqsSendMessage(this, 'publish_query_result', {
            queue: outputQueue,
            messageBody: stepfunctions.TaskInput.fromObject({
                result: stepfunctions.TaskInput.fromJsonPathAt('$.queryConfig.Payload.result'),
                user_question: stepfunctions.TaskInput.fromJsonPathAt('$.user_question'),
                question_unique_id: stepfunctions.TaskInput.fromJsonPathAt('$.question_unique_id'),
            }),
        });
        const alternateQueryCorrectChoiceState = new stepfunctions.Choice(this, 'is_alternate_query_correct?', {
        //inputPath: '$.queryConfig.Payload',
        });
        const alternateQueryExecutorState = new tasks.LambdaInvoke(this, 'execute_alternate_query', {
            lambdaFunction: queryExecutorFunction,
            resultPath: '$.queryConfig',
        }).next(alternateQueryCorrectChoiceState
            .when(stepfunctions.Condition.stringEquals('$.queryConfig.Payload.status', 'QUERY_ERROR'), iteratorState)
            .otherwise(outputState));
        const queryExecutorState = new tasks.LambdaInvoke(this, 'execute_query', {
            lambdaFunction: queryExecutorFunction,
            resultPath: '$.queryConfig',
        }).next(autocorrectChoiceState
            .when(stepfunctions.Condition.stringEquals('$.queryConfig.Payload.status', 'QUERY_ERROR'), configureCountState
            .next(iteratorState)
            .next(isCountReachedState
            .when(stepfunctions.Condition.booleanEquals('$.iterator.Payload.continue', true), alternateQueryGeneratorState.next(alternateQueryExecutorState))
            .otherwise(outputState)))
            .otherwise(outputState));
        const feedbackChoiceStateOne = new stepfunctions.Choice(this, 'is_feedback_req_on_reformualted_question?', {
            inputPath: '$.queryConfig.Payload',
        });
        // const feedbackChoiceStateTwo = new stepfunctions.Choice(
        //   this,
        //   'is_feedback_req_on_generated_query_path_two?',
        //   {},
        // );
        const executeQueryChoiceState = new stepfunctions.Choice(this, 'is_query_execution_req?', {})
            .when(stepfunctions.Condition.stringEquals('$.execute_sql_strategy', 'disabled'), outputState)
            .otherwise(queryExecutorState);
        const generatedQueryFeedbackState = new tasks.SqsSendMessage(this, 'get_feedback_on_generated_query', {
            queue,
            messageBody: stepfunctions.TaskInput.fromObject({
                message: 'Following is the generated query. Do you agree with it or want to override?',
                generated_query: stepfunctions.JsonPath.stringAt('$.queryConfig.Payload.result'),
                execute_sql_strategy: stepfunctions.TaskInput.fromJsonPathAt('$.execute_sql_strategy'),
                execution_start_time: stepfunctions.TaskInput.fromJsonPathAt('$.execution_start_time'),
                reformualted_question: stepfunctions.TaskInput.fromJsonPathAt('$.reformulated_user_question'),
                user_question: stepfunctions.TaskInput.fromJsonPathAt('$.user_question'),
                question_unique_id: stepfunctions.TaskInput.fromJsonPathAt('$.question_unique_id'),
                TaskToken: stepfunctions.JsonPath.taskToken,
            }),
            integrationPattern: stepfunctions.IntegrationPattern.WAIT_FOR_TASK_TOKEN,
        }).next(executeQueryChoiceState);
        const generateQueryfeedbackChoiceState = new stepfunctions.Choice(this, 'is_feedback_req_on_generated_query ?', {})
            .when(stepfunctions.Condition.stringEquals('$.queryConfig.Payload.sql_validation_strategy', 'human'), generatedQueryFeedbackState)
            .otherwise(executeQueryChoiceState);
        const queryGeneratorState = new tasks.LambdaInvoke(this, 'generate_query', {
            lambdaFunction: queryGeneratorFunction,
            resultPath: '$.queryConfig',
        }).next(generateQueryfeedbackChoiceState);
        // event bridge
        // Create an IAM role for Events to start the State Machine
        const eventsRole = new iam.Role(this, 'EventsRuleRole', {
            assumedBy: new iam.ServicePrincipal('events.amazonaws.com'),
        });
        if (props?.existingEventBusInterface) {
            this.eventBus = props.existingEventBusInterface;
        }
        else if (props?.eventBusProps) {
            this.eventBus = eventBridgeHelper.buildEventBus(this, {
                eventBusProps: props.eventBusProps,
            });
        }
        else {
            this.eventBus = new events.EventBus(this, 'textToSqlBus' + props.stage, {
                eventBusName: (0, utils_1.generatePhysicalNameV2)(this, 'textToSql' + this.stage, { maxLength: 63, lower: true }),
            });
        }
        this.stepFunction = new stepfunctions.StateMachine(this, 'textToSqlStepFunction' + props.stage, {
            definition: reformulateQuestionState.next(feedbackChoiceStateOne
                .when(stepfunctions.Condition.stringEquals('$.semantic_layer_strategy', 'human'), reformulatedQuestionFeedbackState.next(queryGeneratorState))
                .otherwise(queryGeneratorState)),
            logs: {
                destination: sflogGroup,
                level: stepfunctions.LogLevel.ALL,
            },
            tracingEnabled: true,
            timeout: aws_cdk_lib_1.Duration.days(90),
        });
        this.eventsRule = new events.Rule(this, 'EventsRule', {
            eventBus: this.eventBus,
            targets: [new aws_cdk_lib_1.aws_events_targets.SfnStateMachine(this.stepFunction, {
                    role: eventsRole,
                })],
            eventPattern: {
                source: ['webclient'],
            },
        });
        this.eventBus.grantPutEventsTo(this.stepFunction);
        // Grant the start execution permission to the Events service
        this.stepFunction.grantStartExecution(eventsRole);
    } // end construct
}
exports.TextToSql = TextToSql;
_a = JSII_RTTI_SYMBOL_1;
TextToSql[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.TextToSql", version: "0.1.264" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcGF0dGVybnMvZ2VuLWFpL2F3cy10ZXh0LXRvLXNxbC9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBQ0gsNkJBQTZCO0FBQzdCLG1DQUFtQztBQUNuQyw2Q0FBZ0Y7QUFDaEYsMkNBQTJDO0FBQzNDLGlEQUFpRDtBQUNqRCwyQ0FBMkM7QUFDM0MsaURBQWlEO0FBQ2pELDZDQUE2QztBQUM3QywyQ0FBMkM7QUFDM0MseUNBQXlDO0FBQ3pDLGlFQUFpRTtBQUNqRSwyQ0FBMkM7QUFDM0MsK0RBQStEO0FBQy9ELDZEQUE2RDtBQUM3RCxxQ0FBMEM7QUFFMUMsc0VBRytDO0FBQy9DLHdGQUErRTtBQUMvRSw2R0FBc0c7QUFDdEcsZ0ZBQWdGO0FBRWhGLHlGQUEwRjtBQUMxRiwyRUFBMkU7QUFDM0UseURBR3VDO0FBQ3ZDLGdFQUFnRTtBQUVoRSx3RkFBdUc7QUFHdkcsSUFBWSxNQUdYO0FBSEQsV0FBWSxNQUFNO0lBQ2hCLHlCQUFlLENBQUE7SUFDZixtQ0FBeUIsQ0FBQTtBQUMzQixDQUFDLEVBSFcsTUFBTSxzQkFBTixNQUFNLFFBR2pCO0FBRUQsSUFBWSxlQUdYO0FBSEQsV0FBWSxlQUFlO0lBQ3pCLDhDQUEyQixDQUFBO0lBQzNCLG9EQUFpQyxDQUFBO0FBQ25DLENBQUMsRUFIVyxlQUFlLCtCQUFmLGVBQWUsUUFHMUI7QUF1SUQsTUFBYSxTQUFVLFNBQVEsc0JBQVM7SUFvRHRDOzs7Ozs7O09BT0c7SUFDSCxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQXFCO1FBQzdELEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFakIsTUFBTSxTQUFTLEdBQW1CO1lBQ2hDLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSztZQUNsQixhQUFhLEVBQUUsbUNBQWEsQ0FBQyxZQUFZO1lBQ3pDLFdB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QVksQ0FBQyxlQUFlLENBQ3hDLElBQUksQ0FBQyxZQUFZLEVBQUU7b0JBQ2pCLElBQUksRUFBRSxVQUFVO2lCQUNqQixDQUNGLENBQUM7WUFDRixZQUFZLEVBQUU7Z0JBQ1osTUFBTSxFQUFFLENBQUMsV0FBVyxDQUFDO2FBQ3RCO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFFbEQsNkRBQTZEO1FBQzdELElBQUksQ0FBQyxZQUFZLENBQUMsbUJBQW1CLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDcEQsQ0FBQyxDQUFDLGdCQUFnQjs7QUF6M0JwQiw4QkE0M0JDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiAgQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqICB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogIG9yIGluIHRoZSAnbGljZW5zZScgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWQgb24gYW4gJ0FTIElTJyBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTXG4gKiAgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcbiAqICBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0IHsgQXdzLCBEdXJhdGlvbiwgYXdzX2V2ZW50c190YXJnZXRzIGFzIGV2ZW50c1RhcmdldCB9IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCAqIGFzIGVjMiBmcm9tICdhd3MtY2RrLWxpYi9hd3MtZWMyJztcbmltcG9ydCAqIGFzIGV2ZW50cyBmcm9tICdhd3MtY2RrLWxpYi9hd3MtZXZlbnRzJztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcbmltcG9ydCAqIGFzIGxhbWJkYSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtbGFtYmRhJztcbmltcG9ydCAqIGFzIGxvZ3MgZnJvbSAnYXdzLWNkay1saWIvYXdzLWxvZ3MnO1xuaW1wb3J0ICogYXMgcmRzIGZyb20gJ2F3cy1jZGstbGliL2F3cy1yZHMnO1xuaW1wb3J0ICogYXMgczMgZnJvbSAnYXdzLWNkay1saWIvYXdzLXMzJztcbmltcG9ydCAqIGFzIHNlY3JldHNtYW5hZ2VyIGZyb20gJ2F3cy1jZGstbGliL2F3cy1zZWNyZXRzbWFuYWdlcic7XG5pbXBvcnQgKiBhcyBzcXMgZnJvbSAnYXdzLWNkay1saWIvYXdzLXNxcyc7XG5pbXBvcnQgKiBhcyBzdGVwZnVuY3Rpb25zIGZyb20gJ2F3cy1jZGstbGliL2F3cy1zdGVwZnVuY3Rpb25zJztcbmltcG9ydCAqIGFzIHRhc2tzIGZyb20gJ2F3cy1jZGstbGliL2F3cy1zdGVwZnVuY3Rpb25zLXRhc2tzJztcbmltcG9ydCB7IE5hZ1N1cHByZXNzaW9ucyB9IGZyb20gJ2Nkay1uYWcnO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQge1xuICBCYXNlQ2xhc3MsXG4gIEJhc2VDbGFzc1Byb3BzLFxufSBmcm9tICcuLi8uLi8uLi9jb21tb24vYmFzZS1jbGFzcy9iYXNlLWNsYXNzJztcbmltcG9ydCB7IENvbnN0cnVjdE5hbWUgfSBmcm9tICcuLi8uLi8uLi9jb21tb24vYmFzZS1jbGFzcy9jb25zdHJ1Y3QtbmFtZS1lbnVtJztcbmltcG9ydCB7IGJ1aWxkQ3VzdG9tUmVzb3VyY2VQcm92aWRlciB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9oZWxwZXJzL2N1c3RvbS1yZXNvdXJjZS1wcm92aWRlci1oZWxwZXInO1xuaW1wb3J0ICogYXMgZXZlbnRCcmlkZ2VIZWxwZXIgZnJvbSAnLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvZXZlbnRicmlkZ2UtaGVscGVyJztcblxuaW1wb3J0IHsgYnVpbGREb2NrZXJMYW1iZGFGdW5jdGlvbiB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9oZWxwZXJzL2xhbWJkYS1idWlsZGVyLWhlbHBlcic7XG5pbXBvcnQgKiBhcyBzM0J1Y2tldEhlbHBlciBmcm9tICcuLi8uLi8uLi9jb21tb24vaGVscGVycy9zMy1idWNrZXQtaGVscGVyJztcbmltcG9ydCB7XG4gIGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIsXG4gIGxhbWJkYU1lbW9yeVNpemVMaW1pdGVyLFxufSBmcm9tICcuLi8uLi8uLi9jb21tb24vaGVscGVycy91dGlscyc7XG5pbXBvcnQgKiBhcyB2cGNIZWxwZXIgZnJvbSAnLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvdnBjLWhlbHBlcic7XG5pbXBvcnQgeyBEb2NrZXJMYW1iZGFDdXN0b21Qcm9wcyB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9wcm9wcy9Eb2NrZXJMYW1iZGFDdXN0b21Qcm9wcyc7XG5pbXBvcnQgeyBTZXJ2aWNlRW5kcG9pbnRUeXBlRW51bSB9IGZyb20gJy4uLy4uLy4uL3BhdHRlcm5zL2dlbi1haS9hd3MtcmFnLWFwcHN5bmMtc3RlcGZuLWtlbmRyYS90eXBlcyc7XG5cblxuZXhwb3J0IGVudW0gRGJOYW1lIHtcbiAgTVlTUUwgPSAnTXlTUUwnLFxuICBQT1NUR1JFU1FMID0gJ1Bvc3RncmVTUUwnLFxufVxuXG5leHBvcnQgZW51bSBNZXRhdGRhdGFTb3VyY2Uge1xuICBDT05GSUdfRklMRSA9ICdjb25maWdfZmlsZScsXG4gIEtOT1dMRURHRV9CQVNFID0gJ2tub3dsZWRnZV9iYXNlJyxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUZXh0VG9TcWxQcm9wcyB7XG4gIC8qKlxuICAgKiBPcHRpb25hbC4gVGhlIGNvbnN0cnVjdCBjcmVhdGVzIGEgY3VzdG9tIFZQQyBiYXNlZCBvbiB2cGNQcm9wcy5cbiAgICogUHJvdmlkaW5nIGJvdGggdGhpcyBhbmQgZXhpc3RpbmdWcGMgaXMgYW4gZXJyb3IuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm9uZVxuICAgKi9cbiAgcmVhZG9ubHkgdnBjUHJvcHM/OiBlYzIuVnBjUHJvcHM7XG5cbiAgLyoqXG4gICAqIE9wdGlvbmFsLiBBbiBleGlzdGluZyBWUEMgY2FuIGJlIHVzZWQgdG8gZGVwbG95IHRoZSBjb25zdHJ1Y3QuXG4gICAqIFByb3ZpZGluZyBib3RoIHRoaXMgYW5kIHZwY1Byb3BzIGlzIGFuIGVycm9yLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vbmVcbiAgICovXG4gIHJlYWRvbmx5IGV4aXN0aW5nVnBjPzogZWMyLklWcGM7XG5cbiAgLyoqXG4gICAqIE9wdGlvbmFsLiBBbiBleGlzdGluZyBzdWJuZXQgZ3JvdXAgY2FuIGJlIHVzZWQgdG8gZGVwbG95IHRoZSBjb25zdHJ1Y3QuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm9uZVxuICAgKi9cbiAgcmVhZG9ubHkgZXhpc3RpbmdTdWJuZXRHcm91cD86IHJkcy5TdWJuZXRHcm91cDtcblxuICAvKipcbiAgICogT3B0aW9uYWwuIFNlY3VyaXR5IGdyb3VwIGZvciB0aGUgbGFtYmRhIGZ1bmN0aW9uIHdoaWNoIHRoaXMgY29uc3RydWN0IHdpbGwgdXNlLlxuICAgKiBJZiBubyBleGlzaXRpbmcgc2VjdXJpdHkgZ3JvdXAgaXMgcHJvdmlkZWQgaXQgd2lsbCBjcmVhdGUgb25lIGZyb20gdGhlIHZwYy5cbiAgICogQGRlZmF1bHQgLSBub25lXG4gICAqL1xuICByZWFkb25seSBleGlzdGluZ0xhbWJkYVNlY3VyaXR5R3JvdXA/OiBlYzIuU2VjdXJpdHlHcm91cDtcblxuICAvKipcbiAgICogT3B0aW9uYWwuIFNlY3VyaXR5IGdyb3VwIGZvciB0aGUgZGIgaW5zdGFuY2Ugd2hpY2ggdGhpcyBjb25zdHJ1Y3Qgd2lsbCB1c2UuXG4gICAqIElmIG5vIGV4aXNpdGluZyBzZWN1cml0eSBncm91cCBpcyBwcm92aWRlZCBpdCB3aWxsIGNyZWF0ZSBvbmUgZnJvbSB0aGUgdnBjLlxuICAgKiBAZGVmYXVsdCAtIG5vbmVcbiAgICovXG4gIHJlYWRvbmx5IGV4aXN0aW5nREJTZWN1cml0eUdyb3VwPzogZWMyLlNlY3VyaXR5R3JvdXA7XG5cbiAgLyoqXG4gICAqIFZhbHVlIHdpbGwgYmUgYXBwZW5kZWQgdG8gcmVzb3VyY2VzIG5hbWUuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gX2RldlxuICAgKi9cbiAgcmVhZG9ubHkgc3RhZ2U/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBFbmFibGUgb2JzZXJ2YWJpbGl0eS4gV2FybmluZzogYXNzb2NpYXRlZCBjb3N0IHdpdGggdGhlIHNlcnZpY2VzXG4gICAqIHVzZWQuIEJlc3QgcHJhY3RpY2UgdG8gZW5hYmxlIGJ5IGRlZmF1bHQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gdHJ1ZVxuICAgKi9cbiAgcmVhZG9ubHkgb2JzZXJ2YWJpbGl0eT86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIERhdGFiYXNlIG5hbWUuIFRoaXMgaXMgdGhlIHRhcmdldCBkYXRhYmFzZSBhZ2FpbnN0IHdoaWNoIHRoZSBxdWVyeSB3aWxsIGJlIGdlbmVyYXRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGRiTmFtZTogRGJOYW1lO1xuXG4gIC8qKlxuICAgKiAgRGF0YWJhc2Ugc2VjcmV0LiBEQiBjcmVkZW50aWFscyB0byBjb25uZWN0IHRvIERhdGFiYXNlLlxuICAgKi9cbiAgcmVhZG9ubHkgZGF0YWJhc2VTZWNyZXRBUk46IHN0cmluZztcblxuICAvKipcbiAgICogIE9wdGlvbmFsLiBkYiBwb3J0IG51bWJlci5cbiAgICogIEBkZWZhdWx0IC0xNTM0XG4gICAqL1xuICByZWFkb25seSBkYlBvcnQ/OiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIE9wdGlvbmFsLiBBbGxvd3MgdG8gcHJvdmlkZSBjdXN0b20gbGFtYmRhIGNvZGUgZm9yIGFsbCBwcmUgc3RlcHMgcmVxdWlyZWQgYmVmb3JlIGdlbmVyYXRpbmcgdGhlIHF1ZXJ5LlxuICAgKiBJZiBub3QgcHJvdmlkZWQsIGRlZmF1bHQgY29kZSB3aWxsIGJlIHVzZWQuXG4gICAqXG4gICAqL1xuICByZWFkb25seSBjdXN0b21RdWVyeUNvbmZpZ3VyZXJMYW1iZGFQcm9wcz86XG4gIHwgRG9ja2VyTGFtYmRhQ3VzdG9tUHJvcHNcbiAgfCB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIE9wdGlvbmFsLiBBbGxvd3MgdG8gcHJvdmlkZSBjdXN0b20gbGFtYmRhIGNvZGUgZm9yIGdlbmVyYXRpbmcgdGhlIHF1ZXJ5LlxuICAgKiBJZiBub3QgcHJvdmlkZWQsIGRlZmF1bHQgY29kZSB3aWxsIGJlIHVzZWQuXG4gICAqXG4gICAqL1xuICByZWFkb25seSBjdXN0b21RdWVyeUdlbmVyYXRvckxhbWJkYVByb3BzPzpcbiAgfCBEb2NrZXJMYW1iZGFDdXN0b21Qcm9wc1xuICB8IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogT3B0aW9uYWwuIEFsbG93cyB0byBwcm92aWRlIGN1c3RvbSBsYW1iZGEgY29kZSBmb3IgZXhlY3V0aW5nIHRoZSBxdWVyeS5cbiAgICogSWYgbm90IHByb3ZpZGVkLCBkZWZhdWx0IGNvZGUgd2lsbCBiZSB1c2VkLlxuICAgKlxuICAgKi9cbiAgcmVhZG9ubHkgY3VzdG9tUXVlcnlFeGVjdXRvckxhbWJkYVByb3BzPzogRG9ja2VyTGFtYmRhQ3VzdG9tUHJvcHMgfCB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIFRoZSBzb3VyY2Ugb2YgbWV0YXRkYXRhLiBUaGlzIG1ldGFkYXRhIGlzIHJlcXVpcmVkIHRvIHJlZHVjZSB0aGUgbmF0dWFsIGxhbmd1YWdlIGFtYmlndWl0eVxuICAgKiBpbiBvcmRlciB0byBnZW5lcmF0ZSB0aGUgY29ycmVjdCBzcWwgcXVlcnkuIEEga25vd2xlZGdlIGxheWVyIGlzIHVzZWQgdG8gbWFwIHRoZSBuYXR1cmFsIGxhbmd1YWdlXG4gICAqIHRvIHRoZSBkYXRhYmFzZSBzY2hlbWEuXG4gICAqIFR3byBtZXRhdGRhdGEgc291cmNlIGFyZSBzdXBwb3J0ZWQ6XG4gICAqIDE6IGNvbmZpZ19maWxlIC0gQSBsb2NhbCBqc29uIGZpbGUgY29udGFpbmluZyB0aGUga25vd2xlZGdlIGxheWVyIGtleSB2YWx1ZSBwYWlyLlxuICAgKiAyOiBLbm93bGVkZ2UgYmFzZSAtIFNlbWFudGljIHNlYXJjaCBpcyB1c2VkIHRvIGZldGNoIHRoZSBrbm93bGVkZ2UgbGF5ZXIgZnJvbSBBV1Mga25vd2xlZGdlIGJhc2VcbiAgICogQGRlZmF1bHQgLSBjb25maWdfZmlsZVxuICAgKi9cbiAgcmVhZG9ubHkgbWV0YWRhdGFTb3VyY2U6IHN0cmluZztcblxuICAvKipcbiAgICogT3B0aW9uYWwuIFVzZXIgcHJvdmlkZWQgcHJvcHMgdG8gb3ZlcnJpZGUgdGhlIGRlZmF1bHQgcHJvcHMgZm9yIHRoZSBTMyBCdWNrZXQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gRGVmYXVsdCBwcm9wcyBhcmUgdXNlZFxuICAgKi9cbiAgcmVhZG9ubHkgY29uZmlnQXNzZXRzQnVja2V0UHJvcHM/OiBzMy5CdWNrZXRQcm9wcztcblxuICAvKipcbiAgICogT3B0aW9uYWwuIEV4aXN0aW5nIHMzIEJ1Y2tldCB0byBzdG9yZSB0aGUgY29uZmlnIGZpbGVzLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIE5vbmVcbiAgICovXG4gIHJlYWRvbmx5IGV4aXN0aW5nY29uZmlnQXNzZXRzQnVja2V0T2JqPzogczMuSUJ1Y2tldDtcblxuICAvKipcbiAgICogT3B0aW9uYWwuIEV4aXN0aW5nIGluc3RhbmNlIG9mIGV2ZW50IGJ1cywgcHJvdmlkaW5nIGJvdGggdGhpcyBhbmQgYGV2ZW50QnVzUHJvcHNgIHdpbGwgY2F1c2UgYW4gZXJyb3IuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm9uZS5cbiAgICovXG4gIHJlYWRvbmx5IGV4aXN0aW5nRXZlbnRCdXNJbnRlcmZhY2U/OiBldmVudHMuSUV2ZW50QnVzO1xuXG4gIC8qKlxuICAgKiBPcHRpb25hbCB1c2VyIHByb3ZpZGVkIGV2ZW50IGJ1cyBwcm9wc1xuICAgKlxuICAgKiBAZGVmYXVsdCAtIERlZmF1bHQgcHJvcHMgYXJlIHVzZWQuXG4gICAqL1xuICByZWFkb25seSBldmVudEJ1c1Byb3BzPzogZXZlbnRzLkV2ZW50QnVzUHJvcHM7XG59XG5cbmV4cG9ydCBjbGFzcyBUZXh0VG9TcWwgZXh0ZW5kcyBCYXNlQ2xhc3Mge1xuICAvKipcbiAgICogUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2YgZWMyLklWcGMgdXNlZCBieSB0aGUgY29uc3RydWN0XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdnBjOiBlYzIuSVZwYztcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2Ygc3VibmV0IGdyb3VwIHVzZWQgYnkgdGhlIGNvbnN0cnVjdFxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHN1Ym5ldEdyb3VwOiByZHMuU3VibmV0R3JvdXA7XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGluc3RhbmNlIG9mIGVjMi5JU2VjdXJpdHlHcm91cCB1c2VkIGJ5IHRoZSBjb25zdHJ1Y3RcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBsYW1iZGFTZWN1cml0eUdyb3VwOiBlYzIuU2VjdXJpdHlHcm91cDtcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2YgZWMyLklTZWN1cml0eUdyb3VwIHVzZWQgYnkgdGhlIGNvbnN0cnVjdFxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGRiU2VjdXJpdHlHcm91cCE6IGVjMi5TZWN1cml0eUdyb3VwO1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiBzMy5JQnVja2V0IHVzZWQgYnkgdGhlIGNvbnN0cnVjdFxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGNvbmZpZ0Fzc2V0QnVja2V0ITogczMuSUJ1Y2tldDtcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2YgRXZlbnRCdXMgdXNlZCBieSB0aGUgY29uc3RydWN0XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZXZlbnRCdXM/OiBldmVudHMuSUV2ZW50QnVzO1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiBFdmVudEJ1cyB1c2VkIGJ5IHRoZSBjb25zdHJ1Y3RcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBldmVudHNSdWxlPzogZXZlbnRzLlJ1bGU7XG5cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2YgZmVlZGJhY2sgUXVldWUgIHVzZWQgYnkgdGhlIGNvbnN0cnVjdFxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGZlZWRiYWNrUXVldWU6IHNxcy5RdWV1ZTtcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2Ygb3V0cHV0IFF1ZXVlIHVzZWQgYnkgdGhlIGNvbnN0cnVjdFxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IG91dHB1dFF1ZXVlOiBzcXMuUXVldWU7XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIEluc3RhbmNlIG9mIHN0ZXBmdW5jdGlvbiBjcmVhdGVkIGJ5IHRoZSBjb25zdHJ1Y3RcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBzdGVwRnVuY3Rpb24/OiBzdGVwZnVuY3Rpb25zLlN0YXRlTWFjaGluZTtcblxuICAvKipcbiAgICogQ29uc3RydWN0cyBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgVGV4dFRvU3FsIGNsYXNzLlxuICAgKiBAcGFyYW0ge0NvbnN0cnVjdH0gc2NvcGUgLSByZXByZXNlbnRzIHRoZSBzY29wZSBmb3IgYWxsIHRoZSByZXNvdXJjZXMuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIHRoaXMgaXMgYSBhIHNjb3BlLXVuaXF1ZSBpZC5cbiAgICogQHBhcmFtIHtUZXh0VG9TcWxQcm9wc30gcHJvcHMgLSB1c2VyIHByb3ZpZGVkIHByb3BzIGZvciB0aGUgY29uc3RydWN0LlxuICAgKiBAc2luY2UgMC4wLjBcbiAgICogQHB1YmxpY1xuICAgKi9cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IFRleHRUb1NxbFByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIGNvbnN0IGJhc2VQcm9wczogQmFzZUNsYXNzUHJvcHMgPSB7XG4gICAgICBzdGFnZTogcHJvcHMuc3RhZ2UsXG4gICAgICBjb25zdHJ1Y3ROYW1lOiBDb25zdHJ1Y3ROYW1lLkFXU1RFWFRUT1NRTCxcbiAgICAgIGNvbnN0cnVjdElkOiBpZCxcbiAgICAgIG9ic2VydmFiaWxpdHk6IHByb3BzLm9ic2VydmFiaWxpdHksXG4gICAgfTtcblxuICAgIHZwY0hlbHBlci5DaGVja1ZwY1Byb3BzKHByb3BzKTtcbiAgICBzM0J1Y2tldEhlbHBlci5DaGVja1MzUHJvcHMoe1xuICAgICAgZXhpc3RpbmdCdWNrZXRPYmo6IHByb3BzLmV4aXN0aW5nY29uZmlnQXNzZXRzQnVja2V0T2JqLFxuICAgICAgYnVja2V0UHJvcHM6IHByb3BzLmNvbmZpZ0Fzc2V0c0J1Y2tldFByb3BzLFxuICAgIH0pO1xuICAgIGV2ZW50QnJpZGdlSGVscGVyLkNoZWNrRXZlbnRCcmlkZ2VQcm9wcyhwcm9wcyk7XG5cbiAgICB0aGlzLnVwZGF0ZUVudlN1ZmZpeChiYXNlUHJvcHMpO1xuICAgIHRoaXMuYWRkT2JzZXJ2YWJpbGl0eVRvQ29uc3RydWN0KGJhc2VQcm9wcyk7XG5cbiAgICAvLyB2cGNcbiAgICBpZiAocHJvcHM/LmV4aXN0aW5nVnBjICYmIHByb3BzPy5leGlzdGluZ1N1Ym5ldEdyb3VwKSB7XG4gICAgICB0aGlzLnZwYyA9IHByb3BzLmV4aXN0aW5nVnBjO1xuICAgICAgdGhpcy5zdWJuZXRHcm91cCA9IHByb3BzLmV4aXN0aW5nU3VibmV0R3JvdXA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudnBjID0gbmV3IGVjMi5WcGModGhpcywgJ1ZwYycsIHByb3BzLnZwY1Byb3BzKTtcbiAgICAgIHRoaXMuc3VibmV0R3JvdXAgPSBuZXcgcmRzLlN1Ym5ldEdyb3VwKHRoaXMsICdTdWJuZXRHcm91cCcsIHtcbiAgICAgICAgdnBjOiB0aGlzLnZwYyxcbiAgICAgICAgdnBjU3VibmV0czogeyBzdWJuZXRUeXBlOiBlYzIuU3VibmV0VHlwZS5QUklWQVRFX1dJVEhfRUdSRVNTIH0sXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnU3VibmV0IGdyb3VwIGZvciBBdXJvcmEgU2VydmVybGVzcycsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBhZGQgVlBDIGVuZHBvaW50cyBmb3IgdGhlIGNvbXB1dGUgZW52aXJvbm1lbnRcbiAgICB2cGNIZWxwZXIuQWRkQXdzU2VydmljZUVuZHBvaW50KFxuICAgICAgdGhpcyxcbiAgICAgIHRoaXMudnBjLFxuICAgICAgU2VydmljZUVuZHBvaW50VHlwZUVudW0uRVZFTlRTLFxuICAgICk7XG4gICAgdnBjSGVscGVyLkFkZEF3c1NlcnZpY2VFbmRwb2ludChcbiAgICAgIHRoaXMsXG4gICAgICB0aGlzLnZwYyxcbiAgICAgIFNlcnZpY2VFbmRwb2ludFR5cGVFbnVtLlNURVBfRlVOQ1RJT05TLFxuICAgICk7XG4gICAgdnBjSGVscGVyLkFkZEF3c1NlcnZpY2VFbmRwb2ludCh0aGlzLCB0aGlzLnZwYywgU2VydmljZUVuZHBvaW50VHlwZUVudW0uUzMpO1xuXG4gICAgY29uc3QgZGJQb3J0ID0gcHJvcHMuZGJQb3J0ID8gcHJvcHMuZGJQb3J0IDogMTUzNDtcblxuICAgIC8vIFNlY3VyaXR5IGdyb3VwXG4gICAgaWYgKHByb3BzPy5leGlzdGluZ0xhbWJkYVNlY3VyaXR5R3JvdXApIHtcbiAgICAgIHRoaXMubGFtYmRhU2VjdXJpdHlHcm91cCA9IHByb3BzLmV4aXN0aW5nTGFtYmRhU2VjdXJpdHlHcm91cDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5sYW1iZGFTZWN1cml0eUdyb3VwID0gbmV3IGVjMi5TZWN1cml0eUdyb3VwKFxuICAgICAgICB0aGlzLFxuICAgICAgICAnbGFtYmRhU2VjdXJpdHlHcm91cCcsXG4gICAgICAgIHtcbiAgICAgICAgICB2cGM6IHRoaXMudnBjLFxuICAgICAgICAgIGFsbG93QWxsT3V0Ym91bmQ6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAocHJvcHM/LmV4aXN0aW5nREJTZWN1cml0eUdyb3VwKSB7XG4gICAgICB0aGlzLmRiU2VjdXJpdHlHcm91cCA9IHByb3BzLmV4aXN0aW5nREJTZWN1cml0eUdyb3VwO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRiU2VjdXJpdHlHcm91cCA9IG5ldyBlYzIuU2VjdXJpdHlHcm91cCh0aGlzLCAnREJTZWN1cml0eUdyb3VwJywge1xuICAgICAgICB2cGM6IHRoaXMudnBjLFxuICAgICAgfSk7XG4gICAgICAvLyBBZGQgYW4gaW5ib3VuZCBydWxlIHRvIGFsbG93IHRyYWZmaWMgZnJvbSB0aGUgTGFtYmRhIHNlY3VyaXR5IGdyb3VwXG4gICAgICB0aGlzLmRiU2VjdXJpdHlHcm91cC5hZGRJbmdyZXNzUnVsZShcbiAgICAgICAgZWMyLlBlZXIuc2VjdXJpdHlHcm91cElkKHRoaXMubGFtYmRhU2VjdXJpdHlHcm91cC5zZWN1cml0eUdyb3VwSWQpLFxuICAgICAgICBlYzIuUG9ydC50Y3AoZGJQb3J0KSwgLy8gQXNzdW1pbmcgTXlTUUwgaXMgcnVubmluZyBvbiBwb3J0IDMzMDZcbiAgICAgICAgJ0FsbG93IExhbWJkYSBmdW5jdGlvbiB0byBhY2Nlc3MgdGhlIGRhdGFiYXNlJyxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gdnBjIGZsb3dsb2dncm91cFxuICAgIGNvbnN0IGxvZ0dyb3VwID0gbmV3IGxvZ3MuTG9nR3JvdXAodGhpcywgJ3RleHRUb1NxbENvbnN0cnVjdFZQQ0dyb3VwJyk7XG4gICAgY29uc3QgdnBjRmxvd0xvZ3JvbGUgPSBuZXcgaWFtLlJvbGUodGhpcywgJ3RleHRUb1NxbENvbnN0cnVjdFJvbGUnLCB7XG4gICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uU2VydmljZVByaW5jaXBhbCgndnBjLWZsb3ctbG9ncy5hbWF6b25hd3MuY29tJyksXG4gICAgfSk7XG5cbiAgICAvLyB2cGMgZmxvd2xvZ3NcbiAgICBuZXcgZWMyLkZsb3dMb2codGhpcywgJ0Zsb3dMb2cnLCB7XG4gICAgICByZXNvdXJjZVR5cGU6IGVjMi5GbG93TG9nUmVzb3VyY2VUeXBlLmZyb21WcGModGhpcy52cGMpLFxuICAgICAgZGVzdGluYXRpb246IGVjMi5GbG93TG9nRGVzdGluYXRpb24udG9DbG91ZFdhdGNoTG9ncyhcbiAgICAgICAgbG9nR3JvdXAsXG4gICAgICAgIHZwY0Zsb3dMb2dyb2xlLFxuICAgICAgKSxcbiAgICB9KTtcblxuICAgIC8vIGJ1Y2tldCBmb3Igc3RvcmluZyBzZXJ2ZXIgYWNjZXNzIGxvZ2dpbmdcbiAgICBjb25zdCBzZXJ2ZXJBY2Nlc3NMb2dCdWNrZXQgPSBuZXcgczMuQnVja2V0KFxuICAgICAgdGhpcyxcbiAgICAgICdzZXJ2ZXJBY2Nlc3NMb2dCdWNrZXQnICsgdGhpcy5zdGFnZSxcbiAgICAgIHtcbiAgICAgICAgYmxvY2tQdWJsaWNBY2Nlc3M6IHMzLkJsb2NrUHVibGljQWNjZXNzLkJMT0NLX0FMTCxcbiAgICAgICAgZW5jcnlwdGlvbjogczMuQnVja2V0RW5jcnlwdGlvbi5TM19NQU5BR0VELFxuICAgICAgICBlbmZvcmNlU1NMOiB0cnVlLFxuICAgICAgICB2ZXJzaW9uZWQ6IHRydWUsXG4gICAgICAgIGxpZmVjeWNsZVJ1bGVzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZXhwaXJhdGlvbjogY2RrLkR1cmF0aW9uLmRheXMoOTApLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9LFxuICAgICk7XG5cbiAgICAvLyBjb25maWcgYXNzZXQgYnVja2V0XG4gICAgaWYgKHByb3BzPy5leGlzdGluZ2NvbmZpZ0Fzc2V0c0J1Y2tldE9iaikge1xuICAgICAgdGhpcy5jb25maWdBc3NldEJ1Y2tldCA9IHByb3BzLmV4aXN0aW5nY29uZmlnQXNzZXRzQnVja2V0T2JqO1xuICAgIH0gZWxzZSBpZiAocHJvcHM/LmNvbmZpZ0Fzc2V0c0J1Y2tldFByb3BzKSB7XG4gICAgICB0aGlzLmNvbmZpZ0Fzc2V0QnVja2V0ID0gbmV3IHMzLkJ1Y2tldChcbiAgICAgICAgdGhpcyxcbiAgICAgICAgJ2NvbmZpZ2Fzc2V0JyArIHRoaXMuc3RhZ2UsXG4gICAgICAgIHByb3BzLmNvbmZpZ0Fzc2V0c0J1Y2tldFByb3BzLFxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jb25maWdBc3NldEJ1Y2tldCA9IG5ldyBzMy5CdWNrZXQoXG4gICAgICAgIHRoaXMsXG4gICAgICAgICdjb25maWdhc3NldCcgKyB0aGlzLnN0YWdlLFxuICAgICAgICB7XG4gICAgICAgICAgYWNjZXNzQ29udHJvbDogczMuQnVja2V0QWNjZXNzQ29udHJvbC5QUklWQVRFLFxuICAgICAgICAgIGJsb2NrUHVibGljQWNjZXNzOiBzMy5CbG9ja1B1YmxpY0FjY2Vzcy5CTE9DS19BTEwsXG4gICAgICAgICAgZW5jcnlwdGlvbjogczMuQnVja2V0RW5jcnlwdGlvbi5TM19NQU5BR0VELFxuICAgICAgICAgIGJ1Y2tldE5hbWU6XG4gICAgICAgICAgICAnY29uZmlnYXNzZXQnICtcbiAgICAgICAgICAgIHRoaXMuc3RhZ2UudG9Mb3dlckNhc2UoKSArXG4gICAgICAgICAgICAnLScgK1xuICAgICAgICAgICAgY2RrLkF3cy5SRUdJT04gK1xuICAgICAgICAgICAgJy0nICtcbiAgICAgICAgICAgIGNkay5Bd3MuQUNDT1VOVF9JRCxcbiAgICAgICAgICBzZXJ2ZXJBY2Nlc3NMb2dzQnVja2V0OiBzZXJ2ZXJBY2Nlc3NMb2dCdWNrZXQsXG4gICAgICAgICAgZW5mb3JjZVNTTDogdHJ1ZSxcbiAgICAgICAgICB2ZXJzaW9uZWQ6IHRydWUsXG4gICAgICAgICAgbGlmZWN5Y2xlUnVsZXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZXhwaXJhdGlvbjogY2RrLkR1cmF0aW9uLmRheXMoOTApLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb25maWdGaWxlUGF0aCA9IHBhdGguam9pbihcbiAgICAgIF9fZGlybmFtZSxcbiAgICAgICcuLi8uLi8uLi8uLi9yZXNvdXJjZXMvZ2VuLWFpL2F3cy10ZXh0LXRvLXNxbCcsXG4gICAgKTtcblxuICAgIGNvbnN0IHRleHRUb1NRTEZ1bmN0aW9uUm9sZSA9IG5ldyBpYW0uUm9sZShcbiAgICAgIHRoaXMsXG4gICAgICAncXVlcnlDb25maWdGdW5jdGlvblJvbGUnLFxuICAgICAge1xuICAgICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uU2VydmljZVByaW5jaXBhbCgnbGFtYmRhLmFtYXpvbmF3cy5jb20nKSxcbiAgICAgICAgaW5saW5lUG9saWNpZXM6IHtcbiAgICAgICAgICBMYW1iZGFGdW5jdGlvblNlcnZpY2VSb2xlUG9saWN5OiBuZXcgaWFtLlBvbGljeURvY3VtZW50KHtcbiAgICAgICAgICAgIHN0YXRlbWVudHM6IFtcbiAgICAgICAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICAgICAgICAgICdsb2dzOkNyZWF0ZUxvZ0dyb3VwJyxcbiAgICAgICAgICAgICAgICAgICdsb2dzOkNyZWF0ZUxvZ1N0cmVhbScsXG4gICAgICAgICAgICAgICAgICAnbG9nczpQdXRMb2dFdmVudHMnLFxuICAgICAgICAgICAgICAgICAgJ2JlZHJvY2s6SW52b2tlTW9kZWwnLFxuICAgICAgICAgICAgICAgICAgJ2JlZHJvY2s6SW52b2tlTW9kZWxXaXRoUmVzcG9uc2VTdHJlYW0nLFxuICAgICAgICAgICAgICAgICAgJ3MzOkdldE9iamVjdCcsXG4gICAgICAgICAgICAgICAgICAnczM6R2V0QnVja2V0TG9jYXRpb24nLFxuICAgICAgICAgICAgICAgICAgJ3MzOkxpc3RCdWNrZXQnLFxuICAgICAgICAgICAgICAgICAgJ3MzOlB1dE9iamVjdCcsXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICByZXNvdXJjZXM6IFtcbiAgICAgICAgICAgICAgICAgIGBhcm46JHtBd3MuUEFSVElUSU9OfTpsb2dzOiR7QXdzLlJFR0lPTn06JHtBd3MuQUNDT1VOVF9JRH06bG9nLWdyb3VwOi9hd3MvbGFtYmRhLypgLFxuICAgICAgICAgICAgICAgICAgJ2FybjonICtcbiAgICAgICAgICAgICAgICAgICAgQXdzLlBBUlRJVElPTiArXG4gICAgICAgICAgICAgICAgICAgICc6czM6OjonICtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWdBc3NldEJ1Y2tldC5idWNrZXROYW1lICtcbiAgICAgICAgICAgICAgICAgICAgJy8qJyxcbiAgICAgICAgICAgICAgICAgIGBhcm46JHtBd3MuUEFSVElUSU9OfTpsb2dzOiR7QXdzLlJFR0lPTn06JHtBd3MuQUNDT1VOVF9JRH06bG9nLWdyb3VwOi9hd3MvbGFtYmRhLypgLFxuICAgICAgICAgICAgICAgICAgJ2FybjonICtcbiAgICAgICAgICAgICAgICAgICAgQXdzLlBBUlRJVElPTiArXG4gICAgICAgICAgICAgICAgICAgICc6YmVkcm9jazonICtcbiAgICAgICAgICAgICAgICAgICAgQXdzLlJFR0lPTiArXG4gICAgICAgICAgICAgICAgICAgICc6OmZvdW5kYXRpb24tbW9kZWwvKicsXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICApO1xuXG4gICAgLy8gTWluaW11bSBwZXJtaXNzaW9ucyBmb3IgYSBMYW1iZGEgZnVuY3Rpb24gdG8gZXhlY3V0ZSB3aGlsZSBhY2Nlc3NpbmcgYSByZXNvdXJjZSB3aXRoaW4gYSBWUENcbiAgICB0ZXh0VG9TUUxGdW5jdGlvblJvbGUuYWRkVG9Qb2xpY3koXG4gICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgIGVmZmVjdDogaWFtLkVmZmVjdC5BTExPVyxcbiAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICdlYzI6Q3JlYXRlTmV0d29ya0ludGVyZmFjZScsXG4gICAgICAgICAgJ2VjMjpEZWxldGVOZXR3b3JrSW50ZXJmYWNlJyxcbiAgICAgICAgICAnZWMyOkFzc2lnblByaXZhdGVJcEFkZHJlc3NlcycsXG4gICAgICAgICAgJ2VjMjpVbmFzc2lnblByaXZhdGVJcEFkZHJlc3NlcycsXG4gICAgICAgIF0sXG4gICAgICAgIHJlc291cmNlczogW1xuICAgICAgICAgICdhcm46JyArXG4gICAgICAgICAgICBBd3MuUEFSVElUSU9OICtcbiAgICAgICAgICAgICc6ZWMyOicgK1xuICAgICAgICAgICAgQXdzLlJFR0lPTiArXG4gICAgICAgICAgICAnOicgK1xuICAgICAgICAgICAgQXdzLkFDQ09VTlRfSUQgK1xuICAgICAgICAgICAgJzoqLyonLFxuICAgICAgICBdLFxuICAgICAgfSksXG4gICAgKTtcblxuICAgIHRleHRUb1NRTEZ1bmN0aW9uUm9sZS5hZGRUb1BvbGljeShcbiAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgZWZmZWN0OiBpYW0uRWZmZWN0LkFMTE9XLFxuICAgICAgICBhY3Rpb25zOiBbJ2VjMjpEZXNjcmliZU5ldHdvcmtJbnRlcmZhY2VzJ10sXG4gICAgICAgIHJlc291cmNlczogWycqJ10sXG4gICAgICB9KSxcbiAgICApO1xuXG4gICAgdGV4dFRvU1FMRnVuY3Rpb25Sb2xlLmFkZFRvUG9saWN5KFxuICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICBlZmZlY3Q6IGlhbS5FZmZlY3QuQUxMT1csXG4gICAgICAgIGFjdGlvbnM6IFsnczM6TGlzdEJ1Y2tldCddLFxuICAgICAgICByZXNvdXJjZXM6IFtcbiAgICAgICAgICAnYXJuOicgKyBBd3MuUEFSVElUSU9OICsgJzpzMzo6OicgKyB0aGlzLmNvbmZpZ0Fzc2V0QnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICAgIF0sXG4gICAgICB9KSxcbiAgICApO1xuXG4gICAgY29uc3QgY29uZmlnTG9hZGVyUG9saWN5ID0gbmV3IGlhbS5NYW5hZ2VkUG9saWN5KHRoaXMsICdBdXJvcmFQZ1BvbGljeScsIHtcbiAgICAgIG1hbmFnZWRQb2xpY3lOYW1lOiBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKHRoaXMsICdjb25maWdMb2FkZXJQb2xpY3knLCB7XG4gICAgICAgIG1heExlbmd0aDogMzIsXG4gICAgICAgIGxvd2VyOiB0cnVlLFxuICAgICAgfSksXG4gICAgICBzdGF0ZW1lbnRzOiBbXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgICAnZWMyOkRlc2NyaWJlSW5zdGFuY2VzJyxcbiAgICAgICAgICAgICdlYzI6Q3JlYXRlTmV0d29ya0ludGVyZmFjZScsXG4gICAgICAgICAgICAnZWMyOkF0dGFjaE5ldHdvcmtJbnRlcmZhY2UnLFxuICAgICAgICAgICAgJ2VjMjpEZXNjcmliZU5ldHdvcmtJbnRlcmZhY2VzJyxcbiAgICAgICAgICAgICdhdXRvc2NhbGluZzpDb21wbGV0ZUxpZmVjeWNsZUFjdGlvbicsXG4gICAgICAgICAgICAnZWMyOkRlbGV0ZU5ldHdvcmtJbnRlcmZhY2UnLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbJyonXSxcbiAgICAgICAgfSksXG5cbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICAgICdsb2dzOkNyZWF0ZUxvZ0dyb3VwJyxcbiAgICAgICAgICAgICdsb2dzOkNyZWF0ZUxvZ1N0cmVhbScsXG4gICAgICAgICAgICAnbG9nczpQdXRMb2dFdmVudHMnLFxuICAgICAgICAgICAgJ2JlZHJvY2s6SW52b2tlTW9kZWwnLFxuICAgICAgICAgICAgJ2JlZHJvY2s6SW52b2tlTW9kZWxXaXRoUmVzcG9uc2VTdHJlYW0nLFxuICAgICAgICAgICAgJ3MzOkdldE9iamVjdCcsXG4gICAgICAgICAgICAnczM6R2V0QnVja2V0TG9jYXRpb24nLFxuICAgICAgICAgICAgJ3MzOkxpc3RCdWNrZXQnLFxuICAgICAgICAgICAgJ3MzOlB1dE9iamVjdCcsXG4gICAgICAgICAgXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFtcbiAgICAgICAgICAgIGBhcm46JHtBd3MuUEFSVElUSU9OfTpsb2dzOiR7QXdzLlJFR0lPTn06JHtBd3MuQUNDT1VOVF9JRH06bG9nLWdyb3VwOi9hd3MvbGFtYmRhLypgLFxuICAgICAgICAgICAgJ2FybjonICtcbiAgICAgICAgICAgICAgQXdzLlBBUlRJVElPTiArXG4gICAgICAgICAgICAgICc6czM6OjonICtcbiAgICAgICAgICAgICAgdGhpcy5jb25maWdBc3NldEJ1Y2tldC5idWNrZXROYW1lICtcbiAgICAgICAgICAgICAgJy8qJyxcbiAgICAgICAgICAgIGBhcm46JHtBd3MuUEFSVElUSU9OfTpsb2dzOiR7QXdzLlJFR0lPTn06JHtBd3MuQUNDT1VOVF9JRH06bG9nLWdyb3VwOi9hd3MvbGFtYmRhLypgLFxuICAgICAgICAgICAgJ2FybjonICtcbiAgICAgICAgICAgICAgQXdzLlBBUlRJVElPTiArXG4gICAgICAgICAgICAgICc6YmVkcm9jazonICtcbiAgICAgICAgICAgICAgQXdzLlJFR0lPTiArXG4gICAgICAgICAgICAgICc6OmZvdW5kYXRpb24tbW9kZWwvKicsXG4gICAgICAgICAgXSxcbiAgICAgICAgfSksXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgY29uc3QgY3VzdG9tUmVzb3VyY2UgPSBidWlsZEN1c3RvbVJlc291cmNlUHJvdmlkZXIoe1xuICAgICAgcHJvdmlkZXJOYW1lOiAnQ29uZmlnRmlsZUxvYWRlckNSUHJvdmlkZXInLFxuICAgICAgdnBjOiB0aGlzLnZwYyxcbiAgICAgIHNlY3VyaXR5R3JvdXA6IHRoaXMubGFtYmRhU2VjdXJpdHlHcm91cCxcbiAgICAgIGNvZGVQYXRoOiBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vLi4vLi4vbGFtYmRhL2F3cy10ZXh0LXRvLXNxbCcpLFxuICAgICAgaGFuZGxlcjogJ2N1c3RvbV9yZXNvdXJjZXMub25fZXZlbnQnLFxuICAgICAgcnVudGltZTogY2RrLmF3c19sYW1iZGEuUnVudGltZS5QWVRIT05fM18xMixcbiAgICB9KTtcblxuICAgIGNvbnN0IGNyUHJvdmlkZXIgPSBjdXN0b21SZXNvdXJjZS5nZXRQcm92aWRlcih0aGlzKTtcbiAgICBjclByb3ZpZGVyLnJvbGUuYWRkTWFuYWdlZFBvbGljeShjb25maWdMb2FkZXJQb2xpY3kpO1xuXG4gICAgY29uc3QgY29uZmlnRmlsZUxvYWRlciA9IG5ldyBjZGsuQ3VzdG9tUmVzb3VyY2UodGhpcywgJ0NvbmZpZ0ZpbGVMb2FkZXInLCB7XG4gICAgICByZXNvdXJjZVR5cGU6ICdDdXN0b206OkNvbmZpZ0ZpbGVMb2FkZXInLFxuICAgICAgc2VydmljZVRva2VuOiBjclByb3ZpZGVyLnNlcnZpY2VUb2tlbixcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgY29uZmlnQnVja2V0OiB0aGlzLmNvbmZpZ0Fzc2V0QnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICAgIGNvbmZpZ0ZpbGVQYXRoOiBjb25maWdGaWxlUGF0aCxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25maWdGaWxlTG9hZGVyLm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLmNvbmZpZ0Fzc2V0QnVja2V0KTtcbiAgICAvL2NyUHJvdmlkZXIucm9sZS5ub2RlLmFkZERlcGVuZGVuY3koY29uZmlnTG9hZGVyUG9saWN5KTtcblxuICAgIE5hZ1N1cHByZXNzaW9ucy5hZGRSZXNvdXJjZVN1cHByZXNzaW9ucyhcbiAgICAgIHRleHRUb1NRTEZ1bmN0aW9uUm9sZSxcbiAgICAgIFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnQXdzU29sdXRpb25zLUlBTTUnLFxuICAgICAgICAgIHJlYXNvbjogJ0FXU0xhbWJkYUJhc2ljRXhlY3V0aW9uUm9sZSBpcyB1c2VkLicsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgdHJ1ZSxcbiAgICApO1xuXG4gICAgY29uc3QgcmVmb3JtdWxhdGVRdWVzdGlvbkZ1bmN0aW9uTmFtZSA9IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIoXG4gICAgICB0aGlzLFxuICAgICAgJ3JlZm9ybXVsYXRlUXVlc3Rpb25GdW5jdGlvbicgKyB0aGlzLnN0YWdlLFxuICAgICAgeyBtYXhMZW5ndGg6IDYzLCBsb3dlcjogdHJ1ZSB9LFxuICAgICk7XG5cbiAgICBjb25zdCByZWZvcm11bGF0ZVF1ZXN0aW9uRnVuY3Rpb25Qcm9wcyA9IHtcbiAgICAgIGZ1bmN0aW9uTmFtZTogcmVmb3JtdWxhdGVRdWVzdGlvbkZ1bmN0aW9uTmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiAnTGFtYmRhIGZ1bmN0aW9uIHRvIHJlZm9ybXVsYXRlIHVzZXIgcXVlc3Rpb24nLFxuICAgICAgY29kZTogbGFtYmRhLkRvY2tlckltYWdlQ29kZS5mcm9tSW1hZ2VBc3NldChcbiAgICAgICAgcGF0aC5qb2luKFxuICAgICAgICAgIF9fZGlybmFtZSxcbiAgICAgICAgICAnLi4vLi4vLi4vLi4vbGFtYmRhL2F3cy10ZXh0LXRvLXNxbC9yZWZvcm11bGF0ZV9xdWVzdGlvbicsXG4gICAgICAgICksXG4gICAgICApLFxuICAgICAgdnBjOiB0aGlzLnZwYyxcbiAgICAgIHZwY1N1Ym5ldHM6IHsgc3VibmV0VHlwZTogZWMyLlN1Ym5ldFR5cGUuUFJJVkFURV9XSVRIX0VHUkVTUyB9LFxuICAgICAgc2VjdXJpdHlHcm91cHM6IFt0aGlzLmxhbWJkYVNlY3VyaXR5R3JvdXBdLFxuICAgICAgbWVtb3J5U2l6ZTogbGFtYmRhTWVtb3J5U2l6ZUxpbWl0ZXIodGhpcywgMV83NjkgKiA0KSxcbiAgICAgIHRpbWVvdXQ6IER1cmF0aW9uLm1pbnV0ZXMoMTApLFxuICAgICAgdHJhY2luZzogdGhpcy5sYW1iZGFUcmFjaW5nLFxuICAgICAgcm9sZTogdGV4dFRvU1FMRnVuY3Rpb25Sb2xlLFxuICAgICAgZW52aXJvbm1lbnQ6IHtcbiAgICAgICAgREJfTkFNRTogcHJvcHMuZGJOYW1lLFxuICAgICAgICBNRVRBREFUQV9TT1VSQ0U6IHByb3BzLm1ldGFkYXRhU291cmNlLFxuICAgICAgICBDT05GSUdfQlVDS0VUOiB0aGlzLmNvbmZpZ0Fzc2V0QnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICAvLyBMYW1iZGEgZnVuY3Rpb24gdG8gbG9hZCAgdGhlIGNvbmZpZyBhbmQgZG8gYWxsIHByZSBzdGVwcyBiZWZvcmUgcXVlcnkgZ2VuZXJhdGlvbi5cbiAgICBjb25zdCByZWZvcm11bGF0ZVF1ZXN0aW9uRnVuY3Rpb24gPSBidWlsZERvY2tlckxhbWJkYUZ1bmN0aW9uKFxuICAgICAgdGhpcyxcbiAgICAgICdyZWZvcm11bGF0ZVF1ZXN0aW9uRnVuY3Rpb24nICsgdGhpcy5zdGFnZSxcbiAgICAgIHJlZm9ybXVsYXRlUXVlc3Rpb25GdW5jdGlvblByb3BzLFxuICAgICAgcHJvcHMuY3VzdG9tUXVlcnlDb25maWd1cmVyTGFtYmRhUHJvcHMsXG4gICAgKTtcblxuICAgIGNvbnN0IHF1ZXJ5R2VuZXJhdG9yRnVuY3Rpb25OYW1lID0gZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMihcbiAgICAgIHRoaXMsXG4gICAgICAncXVlcnlHZW5lcmF0b3JGdW5jdGlvbicgKyB0aGlzLnN0YWdlLFxuICAgICAgeyBtYXhMZW5ndGg6IDYzLCBsb3dlcjogdHJ1ZSB9LFxuICAgICk7XG5cbiAgICBjb25zdCBxdWVyeUdlbmVyYXRvckZ1bmN0aW9uUHJvcHMgPSB7XG4gICAgICBmdW5jdGlvbk5hbWU6IHF1ZXJ5R2VuZXJhdG9yRnVuY3Rpb25OYW1lLFxuICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICdMYW1iZGEgZnVuY3Rpb24gdG8gZ2VuZXJhdGUgdGhlIHF1ZXJ5IGJhc2VkIG9uIHVzZXIgcXVlc3Rpb24uJyxcbiAgICAgIGNvZGU6IGxhbWJkYS5Eb2NrZXJJbWFnZUNvZGUuZnJvbUltYWdlQXNzZXQoXG4gICAgICAgIHBhdGguam9pbihcbiAgICAgICAgICBfX2Rpcm5hbWUsXG4gICAgICAgICAgJy4uLy4uLy4uLy4uL2xhbWJkYS9hd3MtdGV4dC10by1zcWwvcXVlcnlfZ2VuZXJhdG9yJyxcbiAgICAgICAgKSxcbiAgICAgICksXG4gICAgICB2cGM6IHRoaXMudnBjLFxuICAgICAgdnBjU3VibmV0czogeyBzdWJuZXRUeXBlOiBlYzIuU3VibmV0VHlwZS5QUklWQVRFX1dJVEhfRUdSRVNTIH0sXG4gICAgICBzZWN1cml0eUdyb3VwczogW3RoaXMubGFtYmRhU2VjdXJpdHlHcm91cF0sXG4gICAgICBtZW1vcnlTaXplOiBsYW1iZGFNZW1vcnlTaXplTGltaXRlcih0aGlzLCAxXzc2OSAqIDQpLFxuICAgICAgdGltZW91dDogRHVyYXRpb24ubWludXRlcygxMCksXG4gICAgICB0cmFjaW5nOiB0aGlzLmxhbWJkYVRyYWNpbmcsXG4gICAgICByb2xlOiB0ZXh0VG9TUUxGdW5jdGlvblJvbGUsXG4gICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICBEQl9OQU1FOiBwcm9wcy5kYk5hbWUsXG4gICAgICAgIENPTkZJR19CVUNLRVQ6IHRoaXMuY29uZmlnQXNzZXRCdWNrZXQuYnVja2V0TmFtZSxcbiAgICAgICAgU0VDUkVUX0FSTjogcHJvcHMuZGF0YWJhc2VTZWNyZXRBUk4sXG4gICAgICB9LFxuICAgIH07XG5cbiAgICAvLyBMYW1iZGEgZnVuY3Rpb24gdXNlZCB0byBnZW5lcmF0ZSB0aGUgcXVlcnlcbiAgICBjb25zdCBxdWVyeUdlbmVyYXRvckZ1bmN0aW9uID0gYnVpbGREb2NrZXJMYW1iZGFGdW5jdGlvbihcbiAgICAgIHRoaXMsXG4gICAgICAncXVlcnlHZW5lcmF0b3JGdW5jdGlvbicgKyB0aGlzLnN0YWdlLFxuICAgICAgcXVlcnlHZW5lcmF0b3JGdW5jdGlvblByb3BzLFxuICAgICAgcHJvcHMuY3VzdG9tUXVlcnlHZW5lcmF0b3JMYW1iZGFQcm9wcyxcbiAgICApO1xuXG4gICAgLy8gTGFtYmRhIGZ1bmN0aW9uIHVzZWQgdG8gZXhlY3V0ZSB0aGUgcXVlcnlcblxuICAgIGNvbnN0IHF1ZXJ5RXhlY3V0b3JGdW5jdGlvbk5hbWUgPSBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKFxuICAgICAgdGhpcyxcbiAgICAgICdxdWVyeUV4ZWN1dG9yRnVuY3Rpb25OYW1lJyArIHRoaXMuc3RhZ2UsXG4gICAgICB7IG1heExlbmd0aDogNjMsIGxvd2VyOiB0cnVlIH0sXG4gICAgKTtcblxuICAgIGNvbnN0IHF1ZXJ5RXhlY3V0b3JGdW5jdGlvblByb3BzID0ge1xuICAgICAgZnVuY3Rpb25OYW1lOiBxdWVyeUV4ZWN1dG9yRnVuY3Rpb25OYW1lLFxuICAgICAgZGVzY3JpcHRpb246ICdMYW1iZGEgZnVuY3Rpb24gdG8gZXhlY3V0ZSB0aGUgcXVlcnkuJyxcbiAgICAgIGNvZGU6IGxhbWJkYS5Eb2NrZXJJbWFnZUNvZGUuZnJvbUltYWdlQXNzZXQoXG4gICAgICAgIHBhdGguam9pbihcbiAgICAgICAgICBfX2Rpcm5hbWUsXG4gICAgICAgICAgJy4uLy4uLy4uLy4uL2xhbWJkYS9hd3MtdGV4dC10by1zcWwvcXVlcnlfZXhlY3V0b3InLFxuICAgICAgICApLFxuICAgICAgKSxcbiAgICAgIHZwYzogdGhpcy52cGMsXG4gICAgICB2cGNTdWJuZXRzOiB7IHN1Ym5ldFR5cGU6IGVjMi5TdWJuZXRUeXBlLlBSSVZBVEVfV0lUSF9FR1JFU1MgfSxcbiAgICAgIHNlY3VyaXR5R3JvdXBzOiBbdGhpcy5sYW1iZGFTZWN1cml0eUdyb3VwXSxcbiAgICAgIG1lbW9yeVNpemU6IGxhbWJkYU1lbW9yeVNpemVMaW1pdGVyKHRoaXMsIDFfNzY5ICogNCksXG4gICAgICB0aW1lb3V0OiBEdXJhdGlvbi5taW51dGVzKDEwKSxcbiAgICAgIHRyYWNpbmc6IHRoaXMubGFtYmRhVHJhY2luZyxcbiAgICAgIHJvbGU6IHRleHRUb1NRTEZ1bmN0aW9uUm9sZSxcbiAgICAgIGVudmlyb25tZW50OiB7XG4gICAgICAgIERCX05BTUU6IHByb3BzLmRiTmFtZSxcbiAgICAgICAgQ09ORklHX0JVQ0tFVDogdGhpcy5jb25maWdBc3NldEJ1Y2tldC5idWNrZXROYW1lLFxuICAgICAgICBTRUNSRVRfQVJOOiBwcm9wcy5kYXRhYmFzZVNlY3JldEFSTixcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIC8vIExhbWJkYSBmdW5jdGlvbiB1c2VkIHRvIGdlbmVyYXRlIHRoZSBxdWVyeVxuICAgIGNvbnN0IHF1ZXJ5RXhlY3V0b3JGdW5jdGlvbiA9IGJ1aWxkRG9ja2VyTGFtYmRhRnVuY3Rpb24oXG4gICAgICB0aGlzLFxuICAgICAgJ3F1ZXJ5RXhlY3V0b3JGdW5jdGlvbk5hbWUnICsgdGhpcy5zdGFnZSxcbiAgICAgIHF1ZXJ5RXhlY3V0b3JGdW5jdGlvblByb3BzLFxuICAgICAgcHJvcHMuY3VzdG9tUXVlcnlFeGVjdXRvckxhbWJkYVByb3BzLFxuICAgICk7XG5cbiAgICAvLyBsYW1iZGEgZnVuY3Rpb24gZm9yIGF1dG9jb3JyZWN0IGxvb3BcblxuICAgIGNvbnN0IGF1dG9jb3JyZWN0UXVlcnlGdW5jdGlvbk5hbWUgPSBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKFxuICAgICAgdGhpcyxcbiAgICAgICdhdXRvY29ycmVjdFF1ZXJ5RnVuY3Rpb24nICsgdGhpcy5zdGFnZSxcbiAgICAgIHsgbWF4TGVuZ3RoOiA2MywgbG93ZXI6IHRydWUgfSxcbiAgICApO1xuXG4gICAgY29uc3QgYXV0b2NvcnJlY3RRdWVyeUZ1bmN0aW9uUHJvcHMgPSB7XG4gICAgICBmdW5jdGlvbk5hbWU6IGF1dG9jb3JyZWN0UXVlcnlGdW5jdGlvbk5hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogJ0xhbWJkYSBmdW5jdGlvbiB0byBrZWVwIHRoZSBjb3VudCBvZiBhdXRvY29ycmVjdCBsb29wLicsXG4gICAgICBjb2RlOiBsYW1iZGEuRG9ja2VySW1hZ2VDb2RlLmZyb21JbWFnZUFzc2V0KFxuICAgICAgICBwYXRoLmpvaW4oXG4gICAgICAgICAgX19kaXJuYW1lLFxuICAgICAgICAgICcuLi8uLi8uLi8uLi9sYW1iZGEvYXdzLXRleHQtdG8tc3FsL3F1ZXJ5X2F1dG9jb3JyZWN0JyxcbiAgICAgICAgKSxcbiAgICAgICksXG4gICAgICB2cGM6IHRoaXMudnBjLFxuICAgICAgdnBjU3VibmV0czogeyBzdWJuZXRUeXBlOiBlYzIuU3VibmV0VHlwZS5QUklWQVRFX1dJVEhfRUdSRVNTIH0sXG4gICAgICBzZWN1cml0eUdyb3VwczogW3RoaXMubGFtYmRhU2VjdXJpdHlHcm91cF0sXG4gICAgICBtZW1vcnlTaXplOiBsYW1iZGFNZW1vcnlTaXplTGltaXRlcih0aGlzLCAxXzc2OSAqIDQpLFxuICAgICAgdGltZW91dDogRHVyYXRpb24ubWludXRlcygxMCksXG4gICAgICB0cmFjaW5nOiB0aGlzLmxhbWJkYVRyYWNpbmcsXG4gICAgICByb2xlOiB0ZXh0VG9TUUxGdW5jdGlvblJvbGUsXG4gICAgfTtcblxuICAgIGNvbnN0IGF1dG9jb3JyZWN0UXVlcnlGdW5jdGlvbiA9IGJ1aWxkRG9ja2VyTGFtYmRhRnVuY3Rpb24oXG4gICAgICB0aGlzLFxuICAgICAgJ2F1dG9jb3JyZWN0UXVlcnlGdW5jdGlvbicgKyB0aGlzLnN0YWdlLFxuICAgICAgYXV0b2NvcnJlY3RRdWVyeUZ1bmN0aW9uUHJvcHMsXG4gICAgICB1bmRlZmluZWQsXG4gICAgKTtcblxuICAgIGNvbnN0IGZlZWRiYWNrUXVldWVOYW1lID0gZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMihcbiAgICAgIHRoaXMsXG4gICAgICAnZmVlZGJhY2tRdWV1ZScgKyB0aGlzLnN0YWdlLFxuICAgICAgeyBtYXhMZW5ndGg6IDYzLCBsb3dlcjogdHJ1ZSB9LFxuICAgICk7XG5cbiAgICBjb25zdCBxdWV1ZSA9IG5ldyBzcXMuUXVldWUodGhpcywgJ3VzZXJGZWVkYmFja1F1ZXVlJywge1xuICAgICAgcXVldWVOYW1lOiBmZWVkYmFja1F1ZXVlTmFtZSxcbiAgICAgIHZpc2liaWxpdHlUaW1lb3V0OiBEdXJhdGlvbi5zZWNvbmRzKDM2MDApLFxuICAgIH0pO1xuXG4gICAgcXVldWUuYWRkVG9SZXNvdXJjZVBvbGljeShcbiAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgZWZmZWN0OiBpYW0uRWZmZWN0LkRFTlksXG4gICAgICAgIHByaW5jaXBhbHM6IFtuZXcgaWFtLkFueVByaW5jaXBhbCgpXSxcbiAgICAgICAgYWN0aW9uczogWydzcXM6KiddLFxuICAgICAgICByZXNvdXJjZXM6IFtxdWV1ZS5xdWV1ZUFybl0sXG4gICAgICAgIGNvbmRpdGlvbnM6IHtcbiAgICAgICAgICBCb29sOiB7XG4gICAgICAgICAgICAnYXdzOlNlY3VyZVRyYW5zcG9ydCc6ICdmYWxzZScsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgICk7XG4gICAgdGhpcy5mZWVkYmFja1F1ZXVlID0gcXVldWU7XG5cbiAgICBjb25zdCBvdXRwdXRRdWV1ZU5hbWUgPSBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKFxuICAgICAgdGhpcyxcbiAgICAgICdvdXRwdXRRdWV1ZScgKyB0aGlzLnN0YWdlLFxuICAgICAgeyBtYXhMZW5ndGg6IDYzLCBsb3dlcjogdHJ1ZSB9LFxuICAgICk7XG5cbiAgICBjb25zdCBvdXRwdXRRdWV1ZSA9IG5ldyBzcXMuUXVldWUodGhpcywgJ291dHB1dFF1ZXVlJywge1xuICAgICAgcXVldWVOYW1lOiBvdXRwdXRRdWV1ZU5hbWUsXG4gICAgICB2aXNpYmlsaXR5VGltZW91dDogRHVyYXRpb24uc2Vjb25kcygzNjAwKSxcbiAgICB9KTtcblxuICAgIG91dHB1dFF1ZXVlLmFkZFRvUmVzb3VyY2VQb2xpY3koXG4gICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgIGVmZmVjdDogaWFtLkVmZmVjdC5ERU5ZLFxuICAgICAgICBwcmluY2lwYWxzOiBbbmV3IGlhbS5BbnlQcmluY2lwYWwoKV0sXG4gICAgICAgIGFjdGlvbnM6IFsnc3FzOionXSxcbiAgICAgICAgcmVzb3VyY2VzOiBbb3V0cHV0UXVldWUucXVldWVBcm5dLFxuICAgICAgICBjb25kaXRpb25zOiB7XG4gICAgICAgICAgQm9vbDoge1xuICAgICAgICAgICAgJ2F3czpTZWN1cmVUcmFuc3BvcnQnOiAnZmFsc2UnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICApO1xuICAgIHRoaXMub3V0cHV0UXVldWUgPSBvdXRwdXRRdWV1ZTtcblxuXG4gICAgY29uc3QgZGJzZWNyZXQgPSBzZWNyZXRzbWFuYWdlci5TZWNyZXQuZnJvbVNlY3JldENvbXBsZXRlQXJuKHRoaXMsICdkYnNlY3JldCcsIHByb3BzLmRhdGFiYXNlU2VjcmV0QVJOKTtcbiAgICBkYnNlY3JldC5ncmFudFJlYWQocXVlcnlHZW5lcmF0b3JGdW5jdGlvbik7XG4gICAgZGJzZWNyZXQuZ3JhbnRSZWFkKHF1ZXJ5RXhlY3V0b3JGdW5jdGlvbik7XG5cblxuICAgIGNvbnN0IHJlZm9ybXVsYXRlUXVlc3Rpb25TdGF0ZSA9IG5ldyB0YXNrcy5MYW1iZGFJbnZva2UoXG4gICAgICB0aGlzLFxuICAgICAgJ3JlZm9ybXVsYXRlX3F1ZXN0aW9uJyxcbiAgICAgIHtcbiAgICAgICAgbGFtYmRhRnVuY3Rpb246IHJlZm9ybXVsYXRlUXVlc3Rpb25GdW5jdGlvbixcbiAgICAgICAgaW5wdXRQYXRoOiAnJC5kZXRhaWwnLFxuICAgICAgICByZXN1bHRQYXRoOiAnJC5xdWVyeUNvbmZpZycsXG4gICAgICB9LFxuICAgICk7XG5cbiAgICBjb25zdCByZWZvcm11bGF0ZWRRdWVzdGlvbkZlZWRiYWNrU3RhdGUgPSBuZXcgdGFza3MuU3FzU2VuZE1lc3NhZ2UoXG4gICAgICB0aGlzLFxuICAgICAgJ2dldF9mZWVkYmFja19vbl9yZWZvcm11bGF0ZWRfcXVlc3Rpb24nLFxuICAgICAge1xuICAgICAgICBxdWV1ZSxcbiAgICAgICAgbWVzc2FnZUJvZHk6IHN0ZXBmdW5jdGlvbnMuVGFza0lucHV0LmZyb21PYmplY3Qoe1xuICAgICAgICAgIG1lc3NhZ2U6XG4gICAgICAgICAgICAnRm9sbG93aW5nIGlzIHRoZSByZWZvcm11bGF0ZWQgcXVlc3Rpb24uIERvIHlvdSBhZ3JlZSB3aXRoIHRoZSBuZXcgcXVlc3Rpb24/JyxcbiAgICAgICAgICByZWZvcm11YWx0ZWRfcXVlc3Rpb246IHN0ZXBmdW5jdGlvbnMuVGFza0lucHV0LmZyb21Kc29uUGF0aEF0KFxuICAgICAgICAgICAgJyQucmVmb3JtdWxhdGVkX3VzZXJfcXVlc3Rpb24nLFxuICAgICAgICAgICksXG4gICAgICAgICAgdXNlcl9xdWVzdGlvbjpcbiAgICAgICAgICAgIHN0ZXBmdW5jdGlvbnMuVGFza0lucHV0LmZyb21Kc29uUGF0aEF0KCckLnVzZXJfcXVlc3Rpb24nKSxcbiAgICAgICAgICBxdWVzdGlvbl91bmlxdWVfaWQ6IHN0ZXBmdW5jdGlvbnMuVGFza0lucHV0LmZyb21Kc29uUGF0aEF0KFxuICAgICAgICAgICAgJyQucXVlc3Rpb25fdW5pcXVlX2lkJyxcbiAgICAgICAgICApLFxuICAgICAgICAgIGV4ZWN1dGVfc3FsX3N0cmF0ZWd5OiBzdGVwZnVuY3Rpb25zLlRhc2tJbnB1dC5mcm9tSnNvblBhdGhBdChcbiAgICAgICAgICAgICckLmV4ZWN1dGVfc3FsX3N0cmF0ZWd5JyxcbiAgICAgICAgICApLFxuICAgICAgICAgIGV4ZWN1dGlvbl9zdGFydF90aW1lOiBzdGVwZnVuY3Rpb25zLlRhc2tJbnB1dC5mcm9tSnNvblBhdGhBdChcbiAgICAgICAgICAgICckLmV4ZWN1dGlvbl9zdGFydF90aW1lJyxcbiAgICAgICAgICApLFxuICAgICAgICAgIFRhc2tUb2tlbjogc3RlcGZ1bmN0aW9ucy5Kc29uUGF0aC50YXNrVG9rZW4sXG4gICAgICAgIH0pLFxuICAgICAgICBpbnRlZ3JhdGlvblBhdHRlcm46XG4gICAgICAgICAgc3RlcGZ1bmN0aW9ucy5JbnRlZ3JhdGlvblBhdHRlcm4uV0FJVF9GT1JfVEFTS19UT0tFTixcbiAgICAgIH0sXG4gICAgKTtcbiAgICBjb25zdCBhbHRlcm5hdGVRdWVyeUdlbmVyYXRvclN0YXRlID0gbmV3IHRhc2tzLkxhbWJkYUludm9rZShcbiAgICAgIHRoaXMsXG4gICAgICAnZ2VuZXJhdGVfYWx0ZXJuYXRlX3F1ZXJ5JyxcbiAgICAgIHtcbiAgICAgICAgbGFtYmRhRnVuY3Rpb246IHF1ZXJ5R2VuZXJhdG9yRnVuY3Rpb24sXG4gICAgICAgIHJlc3VsdFBhdGg6ICckLnF1ZXJ5Q29uZmlnJyxcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIC8vIFNGIGxvZ2dyb3VwXG4gICAgY29uc3Qgc2Zsb2dHcm91cCA9IG5ldyBsb2dzLkxvZ0dyb3VwKHRoaXMsICdUZXh0VG9TcWxTdGVwRnVuY3Rpb25Mb2dHcm91cCcsIHtcbiAgICAgIGxvZ0dyb3VwTmFtZTogJy9hd3MvdmVuZGVkbG9ncy9zdGF0ZXMvVGV4dFRvU3FsU3RlcEZ1bmN0aW9uJyxcbiAgICAgIHJlbW92YWxQb2xpY3k6IGNkay5SZW1vdmFsUG9saWN5LkRFU1RST1ksXG4gICAgfSk7XG5cblxuICAgIGNvbnN0IGF1dG9jb3JyZWN0Q2hvaWNlU3RhdGUgPSBuZXcgc3RlcGZ1bmN0aW9ucy5DaG9pY2UoXG4gICAgICB0aGlzLFxuICAgICAgJ2lzX2F1dG9jb3JyZWN0X3JlcXVpcmVkPycsXG4gICAgICB7XG4gICAgICB9LFxuICAgICk7XG5cbiAgICBjb25zdCBjb25maWd1cmVDb3VudFN0YXRlID0gbmV3IHN0ZXBmdW5jdGlvbnMuUGFzcyhcbiAgICAgIHRoaXMsXG4gICAgICAnY29uZmlndXJlX2NvdW50JyxcbiAgICAgIHtcbiAgICAgICAgcmVzdWx0OiBzdGVwZnVuY3Rpb25zLlJlc3VsdC5mcm9tT2JqZWN0KHtcbiAgICAgICAgICBjb3VudDogMyxcbiAgICAgICAgICBpbmRleDogMCxcbiAgICAgICAgICBzdGVwOiAxLFxuICAgICAgICB9KSxcbiAgICAgICAgcmVzdWx0UGF0aDogJyQuaXRlcmF0b3InLFxuICAgICAgfSxcbiAgICApO1xuXG4gICAgY29uc3QgaXRlcmF0b3JTdGF0ZSA9IG5ldyB0YXNrcy5MYW1iZGFJbnZva2UodGhpcywgJ2l0ZXJhdG9yJywge1xuICAgICAgbGFtYmRhRnVuY3Rpb246IGF1dG9jb3JyZWN0UXVlcnlGdW5jdGlvbixcbiAgICAgIHJlc3VsdFBhdGg6ICckLml0ZXJhdG9yJyxcbiAgICB9KTtcblxuICAgIGNvbnN0IGlzQ291bnRSZWFjaGVkU3RhdGUgPSBuZXcgc3RlcGZ1bmN0aW9ucy5DaG9pY2UoXG4gICAgICB0aGlzLFxuICAgICAgJ2lzX2NvdW50X3JlYWNoZWQnLFxuICAgICAge1xuICAgICAgICAvL2lucHV0UGF0aDogJyQuaXRlcmF0b3InLFxuICAgICAgfSxcbiAgICApO1xuXG4gICAgLy8gY29uc3QgcXVlcnlHZW5lcmF0b3JUd29TdGF0ZSA9IG5ldyB0YXNrcy5MYW1iZGFJbnZva2UoXG4gICAgLy8gICB0aGlzLFxuICAgIC8vICAgJ2dlbmVyYXRlX3F1ZXJ5X3BhdGhfdHdvJyxcbiAgICAvLyAgIHtcbiAgICAvLyAgICAgbGFtYmRhRnVuY3Rpb246IHF1ZXJ5R2VuZXJhdG9yRnVuY3Rpb24sXG4gICAgLy8gICAgIHJlc3VsdFBhdGg6ICckLnF1ZXJ5Q29uZmlnJyxcbiAgICAvLyAgIH0sXG4gICAgLy8gKTtcblxuICAgIGNvbnN0IG91dHB1dFN0YXRlID0gbmV3IHRhc2tzLlNxc1NlbmRNZXNzYWdlKHRoaXMsICdwdWJsaXNoX3F1ZXJ5X3Jlc3VsdCcsIHtcbiAgICAgIHF1ZXVlOiBvdXRwdXRRdWV1ZSxcbiAgICAgIG1lc3NhZ2VCb2R5OiBzdGVwZnVuY3Rpb25zLlRhc2tJbnB1dC5mcm9tT2JqZWN0KHtcbiAgICAgICAgcmVzdWx0OiBzdGVwZnVuY3Rpb25zLlRhc2tJbnB1dC5mcm9tSnNvblBhdGhBdChcbiAgICAgICAgICAnJC5xdWVyeUNvbmZpZy5QYXlsb2FkLnJlc3VsdCcsXG4gICAgICAgICksXG4gICAgICAgIHVzZXJfcXVlc3Rpb246XG4gICAgICAgICAgc3RlcGZ1bmN0aW9ucy5UYXNrSW5wdXQuZnJvbUpzb25QYXRoQXQoJyQudXNlcl9xdWVzdGlvbicpLFxuICAgICAgICBxdWVzdGlvbl91bmlxdWVfaWQ6IHN0ZXBmdW5jdGlvbnMuVGFza0lucHV0LmZyb21Kc29uUGF0aEF0KFxuICAgICAgICAgICckLnF1ZXN0aW9uX3VuaXF1ZV9pZCcsXG4gICAgICAgICksXG4gICAgICB9KSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGFsdGVybmF0ZVF1ZXJ5Q29ycmVjdENob2ljZVN0YXRlID0gbmV3IHN0ZXBmdW5jdGlvbnMuQ2hvaWNlKFxuICAgICAgdGhpcyxcbiAgICAgICdpc19hbHRlcm5hdGVfcXVlcnlfY29ycmVjdD8nLFxuICAgICAge1xuICAgICAgICAvL2lucHV0UGF0aDogJyQucXVlcnlDb25maWcuUGF5bG9hZCcsXG4gICAgICB9LFxuICAgICk7XG4gICAgY29uc3QgYWx0ZXJuYXRlUXVlcnlFeGVjdXRvclN0YXRlID0gbmV3IHRhc2tzLkxhbWJkYUludm9rZShcbiAgICAgIHRoaXMsXG4gICAgICAnZXhlY3V0ZV9hbHRlcm5hdGVfcXVlcnknLFxuICAgICAge1xuICAgICAgICBsYW1iZGFGdW5jdGlvbjogcXVlcnlFeGVjdXRvckZ1bmN0aW9uLFxuICAgICAgICByZXN1bHRQYXRoOiAnJC5xdWVyeUNvbmZpZycsXG4gICAgICB9LFxuICAgICkubmV4dChcbiAgICAgIGFsdGVybmF0ZVF1ZXJ5Q29ycmVjdENob2ljZVN0YXRlXG4gICAgICAgIC53aGVuKFxuICAgICAgICAgIHN0ZXBmdW5jdGlvbnMuQ29uZGl0aW9uLnN0cmluZ0VxdWFscyhcbiAgICAgICAgICAgICckLnF1ZXJ5Q29uZmlnLlBheWxvYWQuc3RhdHVzJyxcbiAgICAgICAgICAgICdRVUVSWV9FUlJPUicsXG4gICAgICAgICAgKSxcbiAgICAgICAgICBpdGVyYXRvclN0YXRlLFxuICAgICAgICApXG4gICAgICAgIC5vdGhlcndpc2Uob3V0cHV0U3RhdGUpLFxuICAgICk7XG5cbiAgICBjb25zdCBxdWVyeUV4ZWN1dG9yU3RhdGUgPSBuZXcgdGFza3MuTGFtYmRhSW52b2tlKHRoaXMsICdleGVjdXRlX3F1ZXJ5Jywge1xuICAgICAgbGFtYmRhRnVuY3Rpb246IHF1ZXJ5RXhlY3V0b3JGdW5jdGlvbixcbiAgICAgIHJlc3VsdFBhdGg6ICckLnF1ZXJ5Q29uZmlnJyxcbiAgICB9KS5uZXh0KFxuICAgICAgYXV0b2NvcnJlY3RDaG9pY2VTdGF0ZVxuICAgICAgICAud2hlbihcbiAgICAgICAgICBzdGVwZnVuY3Rpb25zLkNvbmRpdGlvbi5zdHJpbmdFcXVhbHMoXG4gICAgICAgICAgICAnJC5xdWVyeUNvbmZpZy5QYXlsb2FkLnN0YXR1cycsXG4gICAgICAgICAgICAnUVVFUllfRVJST1InLFxuICAgICAgICAgICksXG4gICAgICAgICAgY29uZmlndXJlQ291bnRTdGF0ZVxuICAgICAgICAgICAgLm5leHQoaXRlcmF0b3JTdGF0ZSlcbiAgICAgICAgICAgIC5uZXh0KFxuICAgICAgICAgICAgICBpc0NvdW50UmVhY2hlZFN0YXRlXG4gICAgICAgICAgICAgICAgLndoZW4oXG4gICAgICAgICAgICAgICAgICBzdGVwZnVuY3Rpb25zLkNvbmRpdGlvbi5ib29sZWFuRXF1YWxzKFxuICAgICAgICAgICAgICAgICAgICAnJC5pdGVyYXRvci5QYXlsb2FkLmNvbnRpbnVlJyxcbiAgICAgICAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICBhbHRlcm5hdGVRdWVyeUdlbmVyYXRvclN0YXRlLm5leHQoYWx0ZXJuYXRlUXVlcnlFeGVjdXRvclN0YXRlKSxcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgLm90aGVyd2lzZShvdXRwdXRTdGF0ZSksXG4gICAgICAgICAgICApLFxuICAgICAgICApXG4gICAgICAgIC5vdGhlcndpc2Uob3V0cHV0U3RhdGUpLFxuICAgICk7XG5cbiAgICBjb25zdCBmZWVkYmFja0Nob2ljZVN0YXRlT25lID0gbmV3IHN0ZXBmdW5jdGlvbnMuQ2hvaWNlKFxuICAgICAgdGhpcyxcbiAgICAgICdpc19mZWVkYmFja19yZXFfb25fcmVmb3JtdWFsdGVkX3F1ZXN0aW9uPycsXG4gICAgICB7XG4gICAgICAgIGlucHV0UGF0aDogJyQucXVlcnlDb25maWcuUGF5bG9hZCcsXG4gICAgICB9LFxuICAgICk7XG4gICAgLy8gY29uc3QgZmVlZGJhY2tDaG9pY2VTdGF0ZVR3byA9IG5ldyBzdGVwZnVuY3Rpb25zLkNob2ljZShcbiAgICAvLyAgIHRoaXMsXG4gICAgLy8gICAnaXNfZmVlZGJhY2tfcmVxX29uX2dlbmVyYXRlZF9xdWVyeV9wYXRoX3R3bz8nLFxuICAgIC8vICAge30sXG4gICAgLy8gKTtcblxuICAgIGNvbnN0IGV4ZWN1dGVRdWVyeUNob2ljZVN0YXRlID0gbmV3IHN0ZXBmdW5jdGlvbnMuQ2hvaWNlKFxuICAgICAgdGhpcyxcbiAgICAgICdpc19xdWVyeV9leGVjdXRpb25fcmVxPycsXG4gICAgICB7fSxcbiAgICApXG4gICAgICAud2hlbihcbiAgICAgICAgc3RlcGZ1bmN0aW9ucy5Db25kaXRpb24uc3RyaW5nRXF1YWxzKFxuICAgICAgICAgICckLmV4ZWN1dGVfc3FsX3N0cmF0ZWd5JyxcbiAgICAgICAgICAnZGlzYWJsZWQnLFxuICAgICAgICApLFxuICAgICAgICBvdXRwdXRTdGF0ZSxcbiAgICAgIClcbiAgICAgIC5vdGhlcndpc2UocXVlcnlFeGVjdXRvclN0YXRlKTtcblxuICAgIGNvbnN0IGdlbmVyYXRlZFF1ZXJ5RmVlZGJhY2tTdGF0ZSA9IG5ldyB0YXNrcy5TcXNTZW5kTWVzc2FnZShcbiAgICAgIHRoaXMsXG4gICAgICAnZ2V0X2ZlZWRiYWNrX29uX2dlbmVyYXRlZF9xdWVyeScsXG4gICAgICB7XG4gICAgICAgIHF1ZXVlLFxuICAgICAgICBtZXNzYWdlQm9keTogc3RlcGZ1bmN0aW9ucy5UYXNrSW5wdXQuZnJvbU9iamVjdCh7XG4gICAgICAgICAgbWVzc2FnZTpcbiAgICAgICAgICAgICdGb2xsb3dpbmcgaXMgdGhlIGdlbmVyYXRlZCBxdWVyeS4gRG8geW91IGFncmVlIHdpdGggaXQgb3Igd2FudCB0byBvdmVycmlkZT8nLFxuICAgICAgICAgIGdlbmVyYXRlZF9xdWVyeTogc3RlcGZ1bmN0aW9ucy5Kc29uUGF0aC5zdHJpbmdBdChcbiAgICAgICAgICAgICckLnF1ZXJ5Q29uZmlnLlBheWxvYWQucmVzdWx0JyxcbiAgICAgICAgICApLFxuICAgICAgICAgIGV4ZWN1dGVfc3FsX3N0cmF0ZWd5OiBzdGVwZnVuY3Rpb25zLlRhc2tJbnB1dC5mcm9tSnNvblBhdGhBdChcbiAgICAgICAgICAgICckLmV4ZWN1dGVfc3FsX3N0cmF0ZWd5JyxcbiAgICAgICAgICApLFxuICAgICAgICAgIGV4ZWN1dGlvbl9zdGFydF90aW1lOiBzdGVwZnVuY3Rpb25zLlRhc2tJbnB1dC5mcm9tSnNvblBhdGhBdChcbiAgICAgICAgICAgICckLmV4ZWN1dGlvbl9zdGFydF90aW1lJyxcbiAgICAgICAgICApLFxuXG4gICAgICAgICAgcmVmb3JtdWFsdGVkX3F1ZXN0aW9uOiBzdGVwZnVuY3Rpb25zLlRhc2tJbnB1dC5mcm9tSnNvblBhdGhBdChcbiAgICAgICAgICAgICckLnJlZm9ybXVsYXRlZF91c2VyX3F1ZXN0aW9uJyxcbiAgICAgICAgICApLFxuICAgICAgICAgIHVzZXJfcXVlc3Rpb246XG4gICAgICAgICAgICBzdGVwZnVuY3Rpb25zLlRhc2tJbnB1dC5mcm9tSnNvblBhdGhBdCgnJC51c2VyX3F1ZXN0aW9uJyksXG4gICAgICAgICAgcXVlc3Rpb25fdW5pcXVlX2lkOiBzdGVwZnVuY3Rpb25zLlRhc2tJbnB1dC5mcm9tSnNvblBhdGhBdChcbiAgICAgICAgICAgICckLnF1ZXN0aW9uX3VuaXF1ZV9pZCcsXG4gICAgICAgICAgKSxcblxuICAgICAgICAgIFRhc2tUb2tlbjogc3RlcGZ1bmN0aW9ucy5Kc29uUGF0aC50YXNrVG9rZW4sXG4gICAgICAgIH0pLFxuICAgICAgICBpbnRlZ3JhdGlvblBhdHRlcm46XG4gICAgICAgICAgc3RlcGZ1bmN0aW9ucy5JbnRlZ3JhdGlvblBhdHRlcm4uV0FJVF9GT1JfVEFTS19UT0tFTixcbiAgICAgIH0sXG4gICAgKS5uZXh0KGV4ZWN1dGVRdWVyeUNob2ljZVN0YXRlKTtcblxuICAgIGNvbnN0IGdlbmVyYXRlUXVlcnlmZWVkYmFja0Nob2ljZVN0YXRlID0gbmV3IHN0ZXBmdW5jdGlvbnMuQ2hvaWNlKFxuICAgICAgdGhpcyxcbiAgICAgICdpc19mZWVkYmFja19yZXFfb25fZ2VuZXJhdGVkX3F1ZXJ5ID8nLFxuICAgICAge30sXG4gICAgKVxuICAgICAgLndoZW4oXG4gICAgICAgIHN0ZXBmdW5jdGlvbnMuQ29uZGl0aW9uLnN0cmluZ0VxdWFscyhcbiAgICAgICAgICAnJC5xdWVyeUNvbmZpZy5QYXlsb2FkLnNxbF92YWxpZGF0aW9uX3N0cmF0ZWd5JyxcbiAgICAgICAgICAnaHVtYW4nLFxuICAgICAgICApLFxuICAgICAgICBnZW5lcmF0ZWRRdWVyeUZlZWRiYWNrU3RhdGUsXG4gICAgICApXG4gICAgICAub3RoZXJ3aXNlKGV4ZWN1dGVRdWVyeUNob2ljZVN0YXRlKTtcblxuICAgIGNvbnN0IHF1ZXJ5R2VuZXJhdG9yU3RhdGUgPSBuZXcgdGFza3MuTGFtYmRhSW52b2tlKHRoaXMsICdnZW5lcmF0ZV9xdWVyeScsIHtcbiAgICAgIGxhbWJkYUZ1bmN0aW9uOiBxdWVyeUdlbmVyYXRvckZ1bmN0aW9uLFxuICAgICAgcmVzdWx0UGF0aDogJyQucXVlcnlDb25maWcnLFxuICAgIH0pLm5leHQoZ2VuZXJhdGVRdWVyeWZlZWRiYWNrQ2hvaWNlU3RhdGUpO1xuXG4gICAgLy8gZXZlbnQgYnJpZGdlXG4gICAgLy8gQ3JlYXRlIGFuIElBTSByb2xlIGZvciBFdmVudHMgdG8gc3RhcnQgdGhlIFN0YXRlIE1hY2hpbmVcbiAgICBjb25zdCBldmVudHNSb2xlID0gbmV3IGlhbS5Sb2xlKHRoaXMsICdFdmVudHNSdWxlUm9sZScsIHtcbiAgICAgIGFzc3VtZWRCeTogbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdldmVudHMuYW1hem9uYXdzLmNvbScpLFxuICAgIH0pO1xuXG4gICAgaWYgKHByb3BzPy5leGlzdGluZ0V2ZW50QnVzSW50ZXJmYWNlKSB7XG4gICAgICB0aGlzLmV2ZW50QnVzID0gcHJvcHMuZXhpc3RpbmdFdmVudEJ1c0ludGVyZmFjZTtcbiAgICB9IGVsc2UgaWYgKHByb3BzPy5ldmVudEJ1c1Byb3BzKSB7XG4gICAgICB0aGlzLmV2ZW50QnVzID0gZXZlbnRCcmlkZ2VIZWxwZXIuYnVpbGRFdmVudEJ1cyh0aGlzLCB7XG4gICAgICAgIGV2ZW50QnVzUHJvcHM6IHByb3BzLmV2ZW50QnVzUHJvcHMsXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5ldmVudEJ1cyA9IG5ldyBldmVudHMuRXZlbnRCdXMoXG4gICAgICAgIHRoaXMsXG4gICAgICAgICd0ZXh0VG9TcWxCdXMnICsgcHJvcHMuc3RhZ2UsXG4gICAgICAgIHtcbiAgICAgICAgICBldmVudEJ1c05hbWU6IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIoXG4gICAgICAgICAgICB0aGlzLFxuICAgICAgICAgICAgJ3RleHRUb1NxbCcgKyB0aGlzLnN0YWdlLFxuICAgICAgICAgICAgeyBtYXhMZW5ndGg6IDYzLCBsb3dlcjogdHJ1ZSB9LFxuICAgICAgICAgICksXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMuc3RlcEZ1bmN0aW9uID0gbmV3IHN0ZXBmdW5jdGlvbnMuU3RhdGVNYWNoaW5lKFxuICAgICAgdGhpcyxcbiAgICAgICd0ZXh0VG9TcWxTdGVwRnVuY3Rpb24nICsgcHJvcHMuc3RhZ2UsXG4gICAgICB7XG4gICAgICAgIGRlZmluaXRpb246IHJlZm9ybXVsYXRlUXVlc3Rpb25TdGF0ZS5uZXh0KFxuICAgICAgICAgIGZlZWRiYWNrQ2hvaWNlU3RhdGVPbmVcbiAgICAgICAgICAgIC53aGVuKFxuICAgICAgICAgICAgICBzdGVwZnVuY3Rpb25zLkNvbmRpdGlvbi5zdHJpbmdFcXVhbHMoXG4gICAgICAgICAgICAgICAgJyQuc2VtYW50aWNfbGF5ZXJfc3RyYXRlZ3knLFxuICAgICAgICAgICAgICAgICdodW1hbicsXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIHJlZm9ybXVsYXRlZFF1ZXN0aW9uRmVlZGJhY2tTdGF0ZS5uZXh0KHF1ZXJ5R2VuZXJhdG9yU3RhdGUpLFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLm90aGVyd2lzZShxdWVyeUdlbmVyYXRvclN0YXRlKSxcbiAgICAgICAgKSxcbiAgICAgICAgbG9nczoge1xuICAgICAgICAgIGRlc3RpbmF0aW9uOiBzZmxvZ0dyb3VwLFxuICAgICAgICAgIGxldmVsOiBzdGVwZnVuY3Rpb25zLkxvZ0xldmVsLkFMTCxcbiAgICAgICAgfSxcbiAgICAgICAgdHJhY2luZ0VuYWJsZWQ6IHRydWUsXG4gICAgICAgIHRpbWVvdXQ6IER1cmF0aW9uLmRheXMoOTApLFxuXG4gICAgICB9LFxuXG4gICAgKTtcblxuXG4gICAgdGhpcy5ldmVudHNSdWxlID0gbmV3IGV2ZW50cy5SdWxlKHRoaXMsICdFdmVudHNSdWxlJywge1xuICAgICAgZXZlbnRCdXM6IHRoaXMuZXZlbnRCdXMsXG4gICAgICB0YXJnZXRzOiBbbmV3IGV2ZW50c1RhcmdldC5TZm5TdGF0ZU1hY2hpbmUoXG4gICAgICAgIHRoaXMuc3RlcEZ1bmN0aW9uLCB7XG4gICAgICAgICAgcm9sZTogZXZlbnRzUm9sZSxcbiAgICAgICAgfSxcbiAgICAgICldLFxuICAgICAgZXZlbnRQYXR0ZXJuOiB7XG4gICAgICAgIHNvdXJjZTogWyd3ZWJjbGllbnQnXSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB0aGlzLmV2ZW50QnVzLmdyYW50UHV0RXZlbnRzVG8odGhpcy5zdGVwRnVuY3Rpb24pO1xuXG4gICAgLy8gR3JhbnQgdGhlIHN0YXJ0IGV4ZWN1dGlvbiBwZXJtaXNzaW9uIHRvIHRoZSBFdmVudHMgc2VydmljZVxuICAgIHRoaXMuc3RlcEZ1bmN0aW9uLmdyYW50U3RhcnRFeGVjdXRpb24oZXZlbnRzUm9sZSk7XG4gIH0gLy8gZW5kIGNvbnN0cnVjdFxuXG5cbn1cbiJdfQ==