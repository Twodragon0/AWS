"use strict";
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.Prompt = exports.PromptVariant = exports.PromptTemplateType = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
const constructs_1 = require("constructs");
var PromptTemplateType;
(function (PromptTemplateType) {
    PromptTemplateType["TEXT"] = "TEXT";
})(PromptTemplateType || (exports.PromptTemplateType = PromptTemplateType = {}));
/**
 * Variants are specific sets of inputs that guide FMs on Amazon Bedrock to
 * generate an appropriate response or output for a given task or instruction.
 * You can optimize the prompt for specific use cases and models.
 */
class PromptVariant {
    // ------------------------------------------------------
    // Static Methods
    // ------------------------------------------------------
    /**
     * Static method to create a text template
     */
    static text(props) {
        return {
            name: props.variantName,
            templateType: PromptTemplateType.TEXT,
            modelId: props.model.modelArn,
            inferenceConfiguration: {
                text: { ...props.inferenceConfiguration },
            },
            templateConfiguration: {
                text: { ...props.templateConfiguration },
            },
        };
    }
    // ------------------------------------------------------
    // Constructor
    // ------------------------------------------------------
    constructor() { }
}
exports.PromptVariant = PromptVariant;
_a = JSII_RTTI_SYMBOL_1;
PromptVariant[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.PromptVariant", version: "0.1.264" };
/**
 * Prompts are a specific set of inputs that guide FMs on Amazon Bedrock to
 * generate an appropriate response or output for a given task or instruction.
 * You can optimize the prompt for specific use cases and models.
 * @resource AWS::Bedrock::Prompt
 * @see https://docs.aws.amazon.com/bedrock/latest/userguide/prompt-management.html
 */
class Prompt extends constructs_1.Construct {
    // ------------------------------------------------------
    // Import Methods
    // ------------------------------------------------------
    static fromPromptArn(promptArn) {
        const formattedArn = aws_cdk_lib_1.Arn.split(promptArn, aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME);
        return {
            promptArn: promptArn,
            promptId: formattedArn.resourceName,
        };
    }
    // ------------------------------------------------------
    // Constructor
    // ------------------------------------------------------
    constructor(scope, id, props) {
        super(scope, id);
        // ------------------------------------------------------
        // Set properties or defaults
        // ------------------------------------------------------
        this.promptName = props.promptName;
        this.encryptionKey = props.encryptionKey;
        this.variants = props.variants ?? [];
        // ------------------------------------------------------
        // Validation
        // ------------------------------------------------------
        this.node.addValidation({ validate: () => this.validatePromptName() });
        this.node.addValidation({ validate: () => this.validatePromptVariants() });
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        this._resource = new aws_cdk_lib_1.aws_bedrock.CfnPrompt(this, 'Prompt', {
            customerEncryptionKeyArn: this.encryptionKey?.keyArn,
            defaultVariant: props.defaultVariant?.name,
            description: props.description,
            name: props.promptName,
            variants: aws_cdk_lib_1.Lazy.any({
                produce: () => (this.variants),
            }),
        });
        this.promptArn = this._resource.attrArn;
        this.promptId = this._resource.attrId;
    }
    // ------------------------------------------------------
    // Validation Methods
    // ------------------------------------------------------
    /**
     * Validates whether the prompt name is valid according to the specification.
     * @see https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-bedrock-prompt.html#cfn-bedrock-prompt-name
     */
    validatePromptName() {
        const errors = [];
        const matchesPattern = /^([0-9a-zA-Z][_-]?){1,100}$/.test(this.promptName);
        if (!matchesPattern) {
            errors.push('Valid characters are a-z, A-Z, 0-9, _ (underscore) and - (hyphen). And must not begin with a hyphen');
        }
        if (errors.length > 0) {
            errors.unshift(`Invalid prompt name (value: ${this.promptName})`);
        }
        return errors;
    }
    /**
     * Validates whether the number of prompt variants is respected.
     */
    validatePromptVariants() {
        const errors = [];
        if (this.variants.length > 3) {
            errors.push(`Error: Too many variants specified. The maximum allowed is 3, but you have provided ${this.variants.length} variants.`);
        }
        return errors;
    }
    // ------------------------------------------------------
    // Helper Methods
    // ------------------------------------------------------
    /**
     * Creates a prompt version, a static snapshot of your prompt that can be
     * deployed to production.
     */
    createVersion(description) {
        new aws_cdk_lib_1.aws_bedrock.CfnPromptVersion(this, `PromptVersion-${description}`, {
            promptArn: this.promptArn,
            description,
        });
    }
    /**
     * Adds a prompt variant.
     */
    addVariant(variant) {
        this.variants.push(variant);
    }
}
exports.Prompt = Prompt;
_b = JSII_RTTI_SYMBOL_1;
Prompt[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.Prompt", version: "0.1.264" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvbXB0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2Nkay1saWIvYmVkcm9jay9wcm9tcHQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7R0FXRztBQUVILDZDQUEyRjtBQUczRiwyQ0FBdUM7QUFFdkMsSUFBWSxrQkFFWDtBQUZELFdBQVksa0JBQWtCO0lBQzVCLG1DQUFhLENBQUE7QUFDZixDQUFDLEVBRlcsa0JBQWtCLGtDQUFsQixrQkFBa0IsUUFFN0I7QUEyQkQ7Ozs7R0FJRztBQUNILE1BQXNCLGFBQWE7SUFDakMseURBQXlEO0lBQ3pELGlCQUFpQjtJQUNqQix5REFBeUQ7SUFDekQ7O09BRUc7SUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQTZCO1FBQzlDLE9BQU87WUFDTCxJQUFJLEVBQUUsS0FBSyxDQUFDLFdBQVc7WUFDdkIsWUFBWSxFQUFFLGtCQUFrQixDQUFDLElBQUk7WUFDckMsT0FBTyxFQUFFLEtBQUssQ0FBQyxLQUFLLENBQUMsUUFBUTtZQUM3QixzQkFBc0IsRUFBRTtnQkFDdEIsSUFBSSxFQUFFLEVBQUUsR0FBRyxLQUFLLENBQUMsc0JBQXNCLEVBQUU7YUFDMUM7WUFDRCxxQkFBcUIsRUFBRTtnQkFDckIsSUFBSSxFQUFFLEVBQUUsR0FBRyxLQUFLLENBQUMscUJBQXFCLEVBQUU7YUFDekM7U0FDRixDQUFDO0lBQ0osQ0FBQztJQXlCRCx5REFBeUQ7SUFDekQsY0FBYztJQUNkLHlEQUF5RDtJQUN6RCxnQkFBMEIsQ0FBQzs7QUEvQzdCLHNDQWlEQzs7O0FBZ0REOzs7Ozs7R0FNRztBQUNILE1BQWEsTUFBTyxTQUFRLHNCQUFTO0lBQ25DLHlEQUF5RDtJQUN6RCxpQkFBaUI7SUFDakIseURBQXlEO0lBQ2xELE1BQU0sQ0FBQyxhQUFhLENBQUMsU0FBaUI7UUFDM0MsTUFBTSxZQUFZLEdBQUcsaUJBQUcsQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLHVCQUFT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Qix5REFBeUQ7SUFDekQ7OztPQUdHO0lBQ0ksYUFBYSxDQUFDLFdBQW9CO1FBQ3ZDLElBQUkseUJBQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsaUJBQWlCLFdBQVcsRUFBRSxFQUFFO1lBQ2pFLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztZQUN6QixXQUFXO1NBQ1osQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOztPQUVHO0lBQ0ksVUFBVSxDQUFDLE9BQXNCO1FBQ3RDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzlCLENBQUM7O0FBOUhILHdCQStIQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIENvcHlyaWdodCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiAgd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFU1xuICogIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXG4gKiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEFybiwgQXJuRm9ybWF0LCBhd3Nfa21zIGFzIGttcywgTGF6eSwgYXdzX2JlZHJvY2sgYXMgYmVkcm9jayB9IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7IElNb2RlbCB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1iZWRyb2NrJztcbmltcG9ydCB7IElLZXkgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3Mta21zJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuXG5leHBvcnQgZW51bSBQcm9tcHRUZW1wbGF0ZVR5cGUge1xuICBURVhUID0gJ1RFWFQnLFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbW1vblByb21wdFZhcmlhbnRQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgcHJvbXB0IHZhcmlhbnQuXG4gICAqL1xuICByZWFkb25seSB2YXJpYW50TmFtZTogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIG1vZGVsIHdoaWNoIGlzIHVzZWQgdG8gcnVuIHRoZSBwcm9tcHQuIFRoZSBtb2RlbCBjb3VsZCBiZSBhIGZvdW5kYXRpb25cbiAgICogbW9kZWwsIGEgY3VzdG9tIG1vZGVsLCBvciBhIHByb3Zpc2lvbmVkIG1vZGVsLlxuICAgKi9cbiAgcmVhZG9ubHkgbW9kZWw6IElNb2RlbDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUZXh0UHJvbXB0VmFyaWFudFByb3BzIGV4dGVuZHMgQ29tbW9uUHJvbXB0VmFyaWFudFByb3BzIHtcbiAgLyoqXG4gICAqIEluZmVyZW5jZSBjb25maWd1cmF0aW9uIGZvciB0aGUgVGV4dCBQcm9tcHRcbiAgICovXG4gIHJlYWRvbmx5IGluZmVyZW5jZUNvbmZpZ3VyYXRpb24/OiBiZWRyb2NrLkNmblByb21wdC5Qcm9tcHRNb2RlbEluZmVyZW5jZUNvbmZpZ3VyYXRpb25Qcm9wZXJ0eTtcblxuICAvKipcbiAgICogVGVtcGxhdGUgQ29uZmlndXJhdGlvbiBmb3IgdGhlIHRleHQgcHJvbXB0XG4gICAqL1xuICByZWFkb25seSB0ZW1wbGF0ZUNvbmZpZ3VyYXRpb24/OiBiZWRyb2NrLkNmblByb21wdC5UZXh0UHJvbXB0VGVtcGxhdGVDb25maWd1cmF0aW9uUHJvcGVydHk7XG59XG5cblxuLyoqXG4gKiBWYXJpYW50cyBhcmUgc3BlY2lmaWMgc2V0cyBvZiBpbnB1dHMgdGhhdCBndWlkZSBGTXMgb24gQW1hem9uIEJlZHJvY2sgdG9cbiAqIGdlbmVyYXRlIGFuIGFwcHJvcHJpYXRlIHJlc3BvbnNlIG9yIG91dHB1dCBmb3IgYSBnaXZlbiB0YXNrIG9yIGluc3RydWN0aW9uLlxuICogWW91IGNhbiBvcHRpbWl6ZSB0aGUgcHJvbXB0IGZvciBzcGVjaWZpYyB1c2UgY2FzZXMgYW5kIG1vZGVscy5cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFByb21wdFZhcmlhbnQge1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gU3RhdGljIE1ldGhvZHNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBTdGF0aWMgbWV0aG9kIHRvIGNyZWF0ZSBhIHRleHQgdGVtcGxhdGVcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgdGV4dChwcm9wczogVGV4dFByb21wdFZhcmlhbnRQcm9wcyk6IFByb21wdFZhcmlhbnQge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBwcm9wcy52YXJpYW50TmFtZSxcbiAgICAgIHRlbXBsYXRlVHlwZTogUHJvbXB0VGVtcGxhdGVUeXBlLlRFWFQsXG4gICAgICBtb2RlbElkOiBwcm9wcy5tb2RlbC5tb2RlbEFybixcbiAgICAgIGluZmVyZW5jZUNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgdGV4dDogeyAuLi5wcm9wcy5pbmZlcmVuY2VDb25maWd1cmF0aW9uIH0sXG4gICAgICB9LFxuICAgICAgdGVtcGxhdGVDb25maWd1cmF0aW9uOiB7XG4gICAgICAgIHRleHQ6IHsgLi4ucHJvcHMudGVtcGxhdGVDb25maWd1cmF0aW9uIH0sXG4gICAgICB9LFxuICAgIH07XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFByb3BlcnRpZXNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgcHJvbXB0IHZhcmlhbnQuXG4gICAqL1xuICBwdWJsaWMgYWJzdHJhY3QgbmFtZTogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHR5cGUgb2YgcHJvbXB0IHRlbXBsYXRlLlxuICAgKi9cbiAgcHVibGljIGFic3RyYWN0IHRlbXBsYXRlVHlwZTogUHJvbXB0VGVtcGxhdGVUeXBlO1xuICAvKipcbiAgICogVGhlIGluZmVyZW5jZSBjb25maWd1cmF0aW9uLlxuICAgKi9cbiAgcHVibGljIGFic3RyYWN0IGluZmVyZW5jZUNvbmZpZ3VyYXRpb24/OiBiZWRyb2NrLkNmblByb21wdC5Qcm9tcHRJbmZlcmVuY2VDb25maWd1cmF0aW9uUHJvcGVydHk7XG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIG1vZGVsIHdpdGggd2hpY2ggdG8gcnVuIGluZmVyZW5jZSBvbiB0aGUgcHJvbXB0LlxuICAgKi9cbiAgcHVibGljIGFic3RyYWN0IG1vZGVsSWQ/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdGVtcGxhdGUgY29uZmlndXJhdGlvbi5cbiAgICovXG4gIHB1YmxpYyBhYnN0cmFjdCB0ZW1wbGF0ZUNvbmZpZ3VyYXRpb24/OiBiZWRyb2NrLkNmblByb21wdC5Qcm9tcHRUZW1wbGF0ZUNvbmZpZ3VyYXRpb25Qcm9wZXJ0eTtcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQ29uc3RydWN0b3JcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIHByb3RlY3RlZCBjb25zdHJ1Y3RvcigpIHsgfVxuXG59XG5cbi8qKlxuICogUmVwcmVzZW50cyBhIFByb21wdCwgZWl0aGVyIGNyZWF0ZWQgd2l0aCBDREsgb3IgaW1wb3J0ZWQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSVByb21wdCB7XG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBwcm9tcHQuXG4gICAqIEBleGFtcGxlIFwiYXJuOmF3czpiZWRyb2NrOnVzLWVhc3QtMToxMjM0NTY3ODkwMTI6cHJvbXB0L1BST01QVDEyMzQ1XCJcbiAgICovXG4gIHJlYWRvbmx5IHByb21wdEFybjogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIElEIG9mIHRoZSBwcm9tcHQuXG4gICAqIEBleGFtcGxlIFwiUFJPTVBUMTIzNDVcIlxuICAgKi9cbiAgcmVhZG9ubHkgcHJvbXB0SWQ6IHN0cmluZztcbn1cblxuXG5leHBvcnQgaW50ZXJmYWNlIFByb21wdFByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBwcm9tcHQuXG4gICAqL1xuICByZWFkb25seSBwcm9tcHROYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBBIGRlc2NyaXB0aW9uIG9mIHdoYXQgdGhlIHByb21wdCBkb2VzLlxuICAgKiBAZGVmYXVsdCAtIE5vIGRlc2NyaXB0aW9uIHByb3ZpZGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgS01TIGtleSB0aGF0IHRoZSBwcm9tcHQgaXMgZW5jcnlwdGVkIHdpdGguXG4gICAqIEBkZWZhdWx0IC0gQVdTIG93bmVkIGFuZCBtYW5hZ2VkIGtleS5cbiAgICovXG4gIHJlYWRvbmx5IGVuY3J5cHRpb25LZXk/OiBrbXMuSUtleTtcbiAgLyoqXG4gICAqIFRoZSBQcm9tcHQgVmFyaWFudCB0aGF0IHdpbGwgYmUgdXNlZCBieSBkZWZhdWx0LlxuICAgKiBAZGVmYXVsdCAtIE5vIGRlZmF1bHQgdmFyaWFudCBwcm92aWRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGRlZmF1bHRWYXJpYW50PzogUHJvbXB0VmFyaWFudDtcbiAgLyoqXG4gICAqIFRoZSB2YXJpYW50cyBvZiB5b3VyIHByb21wdC4gVmFyaWFudHMgY2FuIHVzZSBkaWZmZXJlbnQgbWVzc2FnZXMsIG1vZGVscyxcbiAgICogb3IgY29uZmlndXJhdGlvbnMgc28gdGhhdCB5b3UgY2FuIGNvbXBhcmUgdGhlaXIgb3V0cHV0cyB0byBkZWNpZGUgdGhlIGJlc3RcbiAgICogdmFyaWFudCBmb3IgeW91ciB1c2UgY2FzZS4gTWF4aW11bSBvZiAzIHZhcmlhbnRzLlxuICAgKi9cbiAgcmVhZG9ubHkgdmFyaWFudHM/OiBQcm9tcHRWYXJpYW50W107XG5cbn1cblxuLyoqXG4gKiBQcm9tcHRzIGFyZSBhIHNwZWNpZmljIHNldCBvZiBpbnB1dHMgdGhhdCBndWlkZSBGTXMgb24gQW1hem9uIEJlZHJvY2sgdG9cbiAqIGdlbmVyYXRlIGFuIGFwcHJvcHJpYXRlIHJlc3BvbnNlIG9yIG91dHB1dCBmb3IgYSBnaXZlbiB0YXNrIG9yIGluc3RydWN0aW9uLlxuICogWW91IGNhbiBvcHRpbWl6ZSB0aGUgcHJvbXB0IGZvciBzcGVjaWZpYyB1c2UgY2FzZXMgYW5kIG1vZGVscy5cbiAqIEByZXNvdXJjZSBBV1M6OkJlZHJvY2s6OlByb21wdFxuICogQHNlZSBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vYmVkcm9jay9sYXRlc3QvdXNlcmd1aWRlL3Byb21wdC1tYW5hZ2VtZW50Lmh0bWxcbiAqL1xuZXhwb3J0IGNsYXNzIFByb21wdCBleHRlbmRzIENvbnN0cnVjdCBpbXBsZW1lbnRzIElQcm9tcHQge1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gSW1wb3J0IE1ldGhvZHNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIHB1YmxpYyBzdGF0aWMgZnJvbVByb21wdEFybihwcm9tcHRBcm46IHN0cmluZyk6IElQcm9tcHQge1xuICAgIGNvbnN0IGZvcm1hdHRlZEFybiA9IEFybi5zcGxpdChwcm9tcHRBcm4sIEFybkZvcm1hdC5TTEFTSF9SRVNPVVJDRV9OQU1FKTtcbiAgICByZXR1cm4ge1xuICAgICAgcHJvbXB0QXJuOiBwcm9tcHRBcm4sXG4gICAgICBwcm9tcHRJZDogZm9ybWF0dGVkQXJuLnJlc291cmNlTmFtZSEsXG4gICAgfTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQXR0cmlidXRlc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBwcm9tcHQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgcHJvbXB0TmFtZTogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIEtNUyBrZXkgdGhhdCB0aGUgcHJvbXB0IGlzIGVuY3J5cHRlZCB3aXRoLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGVuY3J5cHRpb25LZXk/OiBJS2V5O1xuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgcHJvbXB0LlxuICAgKiBAZXhhbXBsZSBcImFybjphd3M6YmVkcm9jazp1cy1lYXN0LTE6MTIzNDU2Nzg5MDEyOnByb21wdC9QUk9NUFQxMjM0NVwiXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgcHJvbXB0QXJuOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIHByb21wdC5cbiAgICogQGV4YW1wbGUgXCJQUk9NUFQxMjM0NVwiXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgcHJvbXB0SWQ6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSB2YXJpYW50cyBvZiB0aGUgcHJvbXB0LlxuICAgKi9cbiAgcmVhZG9ubHkgdmFyaWFudHM6IFByb21wdFZhcmlhbnRbXTtcbiAgLyoqXG4gICAqIEwxIHJlc291cmNlXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9yZXNvdXJjZTogYmVkcm9jay5DZm5Qcm9tcHQ7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIENvbnN0cnVjdG9yXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogUHJvbXB0UHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFNldCBwcm9wZXJ0aWVzIG9yIGRlZmF1bHRzXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5wcm9tcHROYW1lID0gcHJvcHMucHJvbXB0TmFtZTtcbiAgICB0aGlzLmVuY3J5cHRpb25LZXkgPSBwcm9wcy5lbmNyeXB0aW9uS2V5O1xuICAgIHRoaXMudmFyaWFudHMgPSBwcm9wcy52YXJpYW50cyA/PyBbXTtcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFZhbGlkYXRpb25cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICB0aGlzLm5vZGUuYWRkVmFsaWRhdGlvbih7IHZhbGlkYXRlOiAoKSA9PiB0aGlzLnZhbGlkYXRlUHJvbXB0TmFtZSgpIH0pO1xuICAgIHRoaXMubm9kZS5hZGRWYWxpZGF0aW9uKHsgdmFsaWRhdGU6ICgpID0+IHRoaXMudmFsaWRhdGVQcm9tcHRWYXJpYW50cygpIH0pO1xuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gTDEgSW5zdGFudGlhdGlvblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMuX3Jlc291cmNlID0gbmV3IGJlZHJvY2suQ2ZuUHJvbXB0KHRoaXMsICdQcm9tcHQnLCB7XG4gICAgICBjdXN0b21lckVuY3J5cHRpb25LZXlBcm46IHRoaXMuZW5jcnlwdGlvbktleT8ua2V5QXJuLFxuICAgICAgZGVmYXVsdFZhcmlhbnQ6IHByb3BzLmRlZmF1bHRWYXJpYW50Py5uYW1lLFxuICAgICAgZGVzY3JpcHRpb246IHByb3BzLmRlc2NyaXB0aW9uLFxuICAgICAgbmFtZTogcHJvcHMucHJvbXB0TmFtZSxcbiAgICAgIHZhcmlhbnRzOiBMYXp5LmFueSh7XG4gICAgICAgIHByb2R1Y2U6ICgpID0+ICh0aGlzLnZhcmlhbnRzKSxcbiAgICAgIH0pLFxuICAgIH0pO1xuXG4gICAgdGhpcy5wcm9tcHRBcm4gPSB0aGlzLl9yZXNvdXJjZS5hdHRyQXJuO1xuICAgIHRoaXMucHJvbXB0SWQgPSB0aGlzLl9yZXNvdXJjZS5hdHRySWQ7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gVmFsaWRhdGlvbiBNZXRob2RzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVmFsaWRhdGVzIHdoZXRoZXIgdGhlIHByb21wdCBuYW1lIGlzIHZhbGlkIGFjY29yZGluZyB0byB0aGUgc3BlY2lmaWNhdGlvbi5cbiAgICogQHNlZSBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vQVdTQ2xvdWRGb3JtYXRpb24vbGF0ZXN0L1VzZXJHdWlkZS9hd3MtcmVzb3VyY2UtYmVkcm9jay1wcm9tcHQuaHRtbCNjZm4tYmVkcm9jay1wcm9tcHQtbmFtZVxuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZVByb21wdE5hbWUoKSB7XG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgY29uc3QgbWF0Y2hlc1BhdHRlcm4gPSAvXihbMC05YS16QS1aXVtfLV0/KXsxLDEwMH0kLy50ZXN0KHRoaXMucHJvbXB0TmFtZSk7XG4gICAgaWYgKCFtYXRjaGVzUGF0dGVybikge1xuICAgICAgZXJyb3JzLnB1c2goJ1ZhbGlkIGNoYXJhY3RlcnMgYXJlIGEteiwgQS1aLCAwLTksIF8gKHVuZGVyc2NvcmUpIGFuZCAtIChoeXBoZW4pLiBBbmQgbXVzdCBub3QgYmVnaW4gd2l0aCBhIGh5cGhlbicpO1xuICAgIH1cbiAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgIGVycm9ycy51bnNoaWZ0KGBJbnZhbGlkIHByb21wdCBuYW1lICh2YWx1ZTogJHt0aGlzLnByb21wdE5hbWV9KWApO1xuICAgIH1cbiAgICByZXR1cm4gZXJyb3JzO1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlcyB3aGV0aGVyIHRoZSBudW1iZXIgb2YgcHJvbXB0IHZhcmlhbnRzIGlzIHJlc3BlY3RlZC5cbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVQcm9tcHRWYXJpYW50cygpIHtcbiAgICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gICAgaWYgKHRoaXMudmFyaWFudHMubGVuZ3RoID4gMykge1xuICAgICAgZXJyb3JzLnB1c2goYEVycm9yOiBUb28gbWFueSB2YXJpYW50cyBzcGVjaWZpZWQuIFRoZSBtYXhpbXVtIGFsbG93ZWQgaXMgMywgYnV0IHlvdSBoYXZlIHByb3ZpZGVkICR7dGhpcy52YXJpYW50cy5sZW5ndGh9IHZhcmlhbnRzLmApO1xuICAgIH1cbiAgICByZXR1cm4gZXJyb3JzO1xuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEhlbHBlciBNZXRob2RzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogQ3JlYXRlcyBhIHByb21wdCB2ZXJzaW9uLCBhIHN0YXRpYyBzbmFwc2hvdCBvZiB5b3VyIHByb21wdCB0aGF0IGNhbiBiZVxuICAgKiBkZXBsb3llZCB0byBwcm9kdWN0aW9uLlxuICAgKi9cbiAgcHVibGljIGNyZWF0ZVZlcnNpb24oZGVzY3JpcHRpb24/OiBzdHJpbmcpIHtcbiAgICBuZXcgYmVkcm9jay5DZm5Qcm9tcHRWZXJzaW9uKHRoaXMsIGBQcm9tcHRWZXJzaW9uLSR7ZGVzY3JpcHRpb259YCwge1xuICAgICAgcHJvbXB0QXJuOiB0aGlzLnByb21wdEFybixcbiAgICAgIGRlc2NyaXB0aW9uLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYSBwcm9tcHQgdmFyaWFudC5cbiAgICovXG4gIHB1YmxpYyBhZGRWYXJpYW50KHZhcmlhbnQ6IFByb21wdFZhcmlhbnQpIHtcbiAgICB0aGlzLnZhcmlhbnRzLnB1c2godmFyaWFudCk7XG4gIH1cbn0iXX0=