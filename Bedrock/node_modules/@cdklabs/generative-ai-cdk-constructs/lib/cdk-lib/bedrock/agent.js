"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.validatePromptOverrideConfiguration = exports.validateInferenceConfiguration = exports.Agent = exports.PromptState = exports.PromptCreationMode = exports.ParserMode = exports.PromptType = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const cdk = require("aws-cdk-lib");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const iam = require("aws-cdk-lib/aws-iam");
const constructs_1 = require("constructs");
const agent_action_group_1 = require("./agent-action-group");
const agent_alias_1 = require("./agent-alias");
const utils_1 = require("../../common/helpers/utils");
/**
 * The step in the agent sequence that this prompt configuration applies to.
 */
var PromptType;
(function (PromptType) {
    PromptType["PRE_PROCESSING"] = "PRE_PROCESSING";
    PromptType["ORCHESTRATION"] = "ORCHESTRATION";
    PromptType["POST_PROCESSING"] = "POST_PROCESSING";
    PromptType["KNOWLEDGE_BASE_RESPONSE_GENERATION"] = "KNOWLEDGE_BASE_RESPONSE_GENERATION";
})(PromptType || (exports.PromptType = PromptType = {}));
/**
 * Specifies whether to override the default parser Lambda function when
 * parsing the raw foundation model output in the part of the agent sequence
 * defined by the promptType. If you set the field as OVERRIDEN, the
 * overrideLambda field in the PromptOverrideConfiguration must be specified
 * with the ARN of a Lambda function.
 */
var ParserMode;
(function (ParserMode) {
    ParserMode["DEFAULT"] = "DEFAULT";
    ParserMode["OVERRIDDEN"] = "OVERRIDDEN";
})(ParserMode || (exports.ParserMode = ParserMode = {}));
/**
 * Specifies whether to override the default prompt template for this
 * promptType. Set this value to OVERRIDDEN to use the prompt that you
 * provide in the basePromptTemplate. If you leave it as DEFAULT, the agent
 * uses a default prompt template.
 */
var PromptCreationMode;
(function (PromptCreationMode) {
    PromptCreationMode["DEFAULT"] = "DEFAULT";
    PromptCreationMode["OVERRIDDEN"] = "OVERRIDDEN";
})(PromptCreationMode || (exports.PromptCreationMode = PromptCreationMode = {}));
/**
 * Specifies whether to allow the agent to carry out the step specified in the
 * promptType. If you set this value to DISABLED, the agent skips that step.
 * The default state for each promptType is as follows.
 *
 *     PRE_PROCESSING – ENABLED
 *     ORCHESTRATION – ENABLED
 *     KNOWLEDGE_BASE_RESPONSE_GENERATION – ENABLED
 *     POST_PROCESSING – DISABLED
 */
var PromptState;
(function (PromptState) {
    PromptState["ENABLED"] = "ENABLED";
    PromptState["DISABLED"] = "DISABLED";
})(PromptState || (exports.PromptState = PromptState = {}));
/**
 * Deploy a Bedrock Agent.
 */
class Agent extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        /**
         * A list of values to indicate if PrepareAgent or an Alias needs to be updated.
         * @private
         */
        this.resourceUpdates = [];
        /**
         * A list of action groups associated with the agent
         * @private
         */
        this.actionGroups = [];
        /**
         * A list of KnowledgeBases associated with the agent.
         *
         * @default - No knowledge base is used.
         */
        this.knowledgeBases = [];
        validatePromptOverrideConfiguration(props.promptOverrideConfiguration);
        validateModel(props.foundationModel);
        this.name = props.name ?? (0, utils_1.generatePhysicalNameV2)(this, 'bedrock-agent', { maxLength: 32, lower: true, separator: '-' });
        if (props.existingRole) {
            this.role = props.existingRole;
        }
        else {
            this.role = new iam.Role(this, 'Role', {
                assumedBy: new iam.ServicePrincipal('bedrock.amazonaws.com'),
                roleName: (0, utils_1.generatePhysicalNameV2)(this, 'AmazonBedrockExecutionRoleForAgents_', { maxLength: 64, lower: false }),
            });
            this.role.assumeRolePolicy.addStatements(new iam.PolicyStatement({
                actions: ['sts:AssumeRole'],
                principals: [new iam.ServicePrincipal('bedrock.amazonaws.com')],
                conditions: {
                    StringEquals: {
                        'aws:SourceAccount': cdk.Stack.of(this).account,
                    },
                    ArnLike: {
                        'aws:SourceArn': cdk.Stack.of(this).formatArn({
                            service: 'bedrock',
                            resource: 'agent',
                            resourceName: '*',
                            arnFormat: cdk.ArnFormat.SLASH_RESOURCE_NAME,
                        }),
                    },
                },
            }));
            new iam.Policy(this, 'AgentFMPolicy', {
                roles: [this.role],
                statements: [
                    new iam.PolicyStatement({
                        actions: ['bedrock:InvokeModel'],
                        resources: [props.foundationModel.asArn(this)],
                    }),
                ],
            });
        }
        const agent = new aws_cdk_lib_1.aws_bedrock.CfnAgent(this, 'Agent', {
            agentName: this.name,
            foundationModel: String(props.foundationModel),
            instruction: props.instruction,
            description: props.description,
            idleSessionTtlInSeconds: props.idleSessionTTL?.toSeconds(),
            agentResourceRoleArn: this.role.roleArn,
            customerEncryptionKeyArn: props.encryptionKey?.keyArn,
            tags: props.tags,
            promptOverrideConfiguration: props.promptOverrideConfiguration,
            autoPrepare: props.shouldPrepareAgent,
        });
        this.agentInstance = agent;
        this.agentId = agent.attrAgentId;
        this.agentArn = agent.attrAgentArn;
        this.agentversion = agent.attrAgentVersion;
        if (props.guardrailConfiguration) {
            this.agentInstance.guardrailConfiguration = {
                guardrailIdentifier: props.guardrailConfiguration?.guardrailId,
                guardrailVersion: props.guardrailConfiguration?.guardrailVersion,
            };
        }
        this._addAliasDependency(agent.attrUpdatedAt);
        if (props.aliasName) {
            const alias = this.addAlias({
                aliasName: props.aliasName,
            });
            this.aliasId = alias.aliasId;
            this.aliasArn = alias.aliasArn;
            this.aliasName = alias.aliasName;
        }
        if (props.knowledgeBases) {
            this.addKnowledgeBases(props.knowledgeBases);
        }
        if (props.actionGroups) {
            this.addActionGroups(props.actionGroups);
        }
        // To allow your agent to request the user for additional information
        // when trying to complete a task, add this action group
        this.addActionGroup(new agent_action_group_1.AgentActionGroup(this, 'userInputEnabledActionGroup', {
            actionGroupName: 'UserInputAction',
            parentActionGroupSignature: 'AMAZON.UserInput',
            actionGroupState: props.enableUserInput ? 'ENABLED' : 'DISABLED',
        }));
    }
    /**
     * Add an alias to the agent.
     */
    addAlias(props) {
        const alias = new agent_alias_1.AgentAlias(this, `AgentAlias-${props.aliasName}`, {
            agentId: this.agentId,
            agentVersion: props.agentVersion,
            resourceUpdates: cdk.Lazy.list({ produce: () => this.resourceUpdates }),
            aliasName: props.aliasName,
            description: props.description,
        });
        return alias;
    }
    /**
     * Add knowledge bases to the agent.
     */
    addKnowledgeBases(knowledgeBases) {
        for (const kb of knowledgeBases) {
            this.addKnowledgeBase(kb);
        }
    }
    /**
     * Add knowledge base to the agent.
     */
    addKnowledgeBase(knowledgeBase) {
        if (!knowledgeBase.instruction) {
            throw new Error('Agent Knowledge Bases require instructions.');
        }
        new iam.Policy(this, `AgentKBPolicy-${knowledgeBase.name}`, {
            roles: [this.role],
            statements: [
                new iam.PolicyStatement({
                    actions: [
                        'bedrock:UpdateKnowledgeBase',
                        'bedrock:Retrieve',
                    ],
                    resources: [knowledgeBase.knowledgeBaseArn],
                }),
            ],
        });
        const agentKnowledgeBaseProperty = {
            description: knowledgeBase.instruction, // known issue: wrong parameter mapping in Cfn. Workaround: pass instruction through description
            knowledgeBaseId: knowledgeBase.knowledgeBaseId,
            knowledgeBaseState: knowledgeBase.knowledgeBaseState,
        };
        if (!this.agentInstance.knowledgeBases || !Array.isArray(this.agentInstance.knowledgeBases)) {
            this.agentInstance.knowledgeBases = [agentKnowledgeBaseProperty];
        }
        else {
            this.agentInstance.knowledgeBases.push(agentKnowledgeBaseProperty);
        }
    }
    /**
     * Add action group to the agent.
     */
    addActionGroup(actionGroup) {
        actionGroup.actionGroupExecutor?.lambda?.addPermission('AgentLambdaInvocationPolicy', {
            principal: new iam.ServicePrincipal('bedrock.amazonaws.com'),
            sourceArn: this.agentArn,
            sourceAccount: cdk.Stack.of(this).account,
        });
        if (!this.agentInstance.actionGroups || !Array.isArray(this.agentInstance.actionGroups)) {
            this.agentInstance.actionGroups = [actionGroup.actionGroupProperty];
        }
        else {
            this.agentInstance.actionGroups.push(actionGroup.actionGroupProperty);
        }
    }
    /**
     * Add action groups to the agent.
     */
    addActionGroups(actionGroups) {
        for (const actionGroup of actionGroups) {
            this.addActionGroup(actionGroup);
        }
    }
    /**
     * Add guardrail to the agent.
     */
    addGuardrail(guardrail) {
        new iam.Policy(this, `AgentGuardrailPolicy-${guardrail.name}`, {
            roles: [this.role],
            statements: [
                new iam.PolicyStatement({
                    actions: [
                        'bedrock:ApplyGuardrail',
                    ],
                    resources: [`arn:${cdk.Aws.PARTITION}:bedrock:${cdk.Aws.REGION}:${cdk.Aws.ACCOUNT_ID}:guardrail/${guardrail.guardrailId}`],
                }),
                new iam.PolicyStatement({
                    actions: [
                        'kms:Decrypt',
                    ],
                    resources: [guardrail.kmsKeyArn],
                    conditions: {
                        StringEquals: {
                            'aws:ResourceAccount': cdk.Aws.ACCOUNT_ID,
                        },
                    },
                }),
            ],
        });
        this.agentInstance.guardrailConfiguration = {
            guardrailIdentifier: guardrail.guardrailId,
            guardrailVersion: guardrail.guardrailVersion,
        };
    }
    /**
     * Register a dependency for aliases.
     *
     * @param updatedAt - The updatedAt of the resource that will be registered as a dependency.
     *
     * @internal This is an internal core function and should not be called directly.
     */
    _addAliasDependency(updatedAt) {
        if (updatedAt) {
            this.resourceUpdates.push(updatedAt);
        }
    }
}
exports.Agent = Agent;
_a = JSII_RTTI_SYMBOL_1;
Agent[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.Agent", version: "0.1.264" };
/**
 * Validate that Bedrock Agents can use the selected model.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateModel(foundationModel) {
    if (!foundationModel.supportsAgents) {
        throw new Error(`The model ${foundationModel} is not supported by Bedrock Agents.`);
    }
}
/**
 * Validate the inferenceConfiguration of a prompt override.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateInferenceConfiguration(inferenceConfiguration) {
    if (inferenceConfiguration.topK < 0 || inferenceConfiguration.topK > 500) {
        throw new Error('topK must be between 0 and 500');
    }
    if (!Number.isInteger(inferenceConfiguration.topK)) {
        throw new Error('topK must be an integer');
    }
    if (inferenceConfiguration.stopSequences.length > 4) {
        throw new Error('stopSequences cannot contain more than 4 elements');
    }
    if (inferenceConfiguration.maximumLength < 0 || inferenceConfiguration.maximumLength > 4096) {
        throw new Error('maximumLength must be between 0 and 4096');
    }
    if (!Number.isInteger(inferenceConfiguration.maximumLength)) {
        throw new Error('maximumLength must be an integer');
    }
    if (inferenceConfiguration.topP < 0 || inferenceConfiguration.topP > 1) {
        throw new Error('topP must be between 0 and 1');
    }
    if (inferenceConfiguration.temperature < 0 || inferenceConfiguration.temperature > 1) {
        throw new Error('temperature must be between 0 and 1');
    }
}
exports.validateInferenceConfiguration = validateInferenceConfiguration;
/**
 * Validate the promptOverrideConfiguration.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validatePromptOverrideConfiguration(promptOverrideConfiguration) {
    if (!promptOverrideConfiguration) {
        return;
    }
    if (promptOverrideConfiguration.overrideLambda &&
        promptOverrideConfiguration.promptConfigurations.some(pc => pc.parserMode !== ParserMode.OVERRIDDEN)) {
        throw new Error('overrideLambda can only be used if all promptConfigurations have a parserMode value of OVERRIDDEN');
    }
    if (!promptOverrideConfiguration.overrideLambda &&
        promptOverrideConfiguration.promptConfigurations.some(pc => pc.parserMode === ParserMode.OVERRIDDEN)) {
        throw new Error('At least one promptConfiguration has a parserMode value of OVERRIDDEN, but no overrideLambda is specified');
    }
    // check inferenceConfiguration number types
    Object.values(promptOverrideConfiguration.promptConfigurations).forEach(pc => {
        validateInferenceConfiguration(pc.inferenceConfiguration);
    });
    return;
}
exports.validatePromptOverrideConfiguration = validatePromptOverrideConfiguration;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWdlbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY2RrLWxpYi9iZWRyb2NrL2FnZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFFSCxtQ0FBbUM7QUFDbkMsNkNBQXFEO0FBQ3JELDJDQUEyQztBQUUzQywyQ0FBdUM7QUFFdkMsNkRBQXdEO0FBQ3hELCtDQUEyQztBQUszQyxzREFBb0U7QUFHcEU7O0dBRUc7QUFDSCxJQUFZLFVBS1g7QUFMRCxXQUFZLFVBQVU7SUFDcEIsK0NBQWlDLENBQUE7SUFDakMsNkNBQStCLENBQUE7SUFDL0IsaURBQW1DLENBQUE7SUFDbkMsdUZBQXlFLENBQUE7QUFDM0UsQ0FBQyxFQUxXLFVBQVUsMEJBQVYsVUFBVSxRQUtyQjtBQUVEOzs7Ozs7R0FNRztBQUNILElBQVksVUFHWDtBQUhELFdBQVksVUFBVTtJQUNwQixpQ0FBbUIsQ0FBQTtJQUNuQix1Q0FBeUIsQ0FBQTtBQUMzQixDQUFDLEVBSFcsVUFBVSwwQkFBVixVQUFVLFFBR3JCO0FBRUQ7Ozs7O0dBS0c7QUFDSCxJQUFZLGtCQUdYO0FBSEQsV0FBWSxrQkFBa0I7SUFDNUIseUNBQW1CLENBQUE7SUFDbkIsK0NBQXlCLENBQUE7QUFDM0IsQ0FBQyxFQUhXLGtCQUFrQixrQ0FBbEIsa0JBQWtCLFFBRzdCO0FBRUQ7Ozs7Ozs7OztHQVNHO0FBQ0gsSUFBWSxXQUdYO0FBSEQsV0FBWSxXQUFXO0lBQ3JCLGtDQUFtQixDQUFBO0lBQ25CLG9DQUFxQixDQUFBO0FBQ3ZCLENBQUMsRUFIVyxXQUFXLDJCQUFYLFdBQVcsUUFHdEI7QUFrUUQ7O0dBRUc7QUFDSCxNQUFhLEtBQU0sU0FBUSxzQkFBUztJQXdEbEMsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUFpQjtRQUN6RCxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBcEJuQjs7O1dBR0c7UUFDSyxvQkFBZSxH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QUNULENBQUM7SUFFRCxJQUNFLDJCQUEyQixDQUFDLGNBQWM7UUFDMUMsMkJBQTJCLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUNuRCxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEtBQUssVUFBVSxDQUFDLFVBQVUsQ0FDOUMsRUFBRSxDQUFDO1FBQ0osTUFBTSxJQUFJLEtBQUssQ0FBQyxtR0FBbUcsQ0FBQyxDQUFDO0lBQ3ZILENBQUM7SUFFRCxJQUNFLENBQUMsMkJBQTJCLENBQUMsY0FBYztRQUMzQywyQkFBMkIsQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQ25ELEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLFVBQVUsS0FBSyxVQUFVLENBQUMsVUFBVSxDQUM5QyxFQUFFLENBQUM7UUFDSixNQUFNLElBQUksS0FBSyxDQUFDLDJHQUEyRyxDQUFDLENBQUM7SUFDL0gsQ0FBQztJQUVELDRDQUE0QztJQUM1QyxNQUFNLENBQUMsTUFBTSxDQUFDLDJCQUEyQixDQUFDLG9CQUFvQixDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxFQUFFO1FBQzNFLDhCQUE4QixDQUFDLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0lBQzVELENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTztBQUNULENBQUM7QUEzQkQsa0ZBMkJDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiAgQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqICB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogIG9yIGluIHRoZSAnbGljZW5zZScgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWQgb24gYW4gJ0FTIElTJyBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTXG4gKiAgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcbiAqICBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7IGF3c19iZWRyb2NrIGFzIGJlZHJvY2sgfSBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgKiBhcyBrbXMgZnJvbSAnYXdzLWNkay1saWIvYXdzLWttcyc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcblxuaW1wb3J0IHsgQWdlbnRBY3Rpb25Hcm91cCB9IGZyb20gJy4vYWdlbnQtYWN0aW9uLWdyb3VwJztcbmltcG9ydCB7IEFnZW50QWxpYXMgfSBmcm9tICcuL2FnZW50LWFsaWFzJztcbmltcG9ydCB7IEd1YXJkcmFpbCB9IGZyb20gJy4vZ3VhcmRyYWlscyc7XG5pbXBvcnQgeyBLbm93bGVkZ2VCYXNlIH0gZnJvbSAnLi9rbm93bGVkZ2UtYmFzZSc7XG5pbXBvcnQgeyBCZWRyb2NrRm91bmRhdGlvbk1vZGVsIH0gZnJvbSAnLi9tb2RlbHMnO1xuXG5pbXBvcnQgeyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyIH0gZnJvbSAnLi4vLi4vY29tbW9uL2hlbHBlcnMvdXRpbHMnO1xuXG5cbi8qKlxuICogVGhlIHN0ZXAgaW4gdGhlIGFnZW50IHNlcXVlbmNlIHRoYXQgdGhpcyBwcm9tcHQgY29uZmlndXJhdGlvbiBhcHBsaWVzIHRvLlxuICovXG5leHBvcnQgZW51bSBQcm9tcHRUeXBlIHtcbiAgUFJFX1BST0NFU1NJTkcgPSAnUFJFX1BST0NFU1NJTkcnLFxuICBPUkNIRVNUUkFUSU9OID0gJ09SQ0hFU1RSQVRJT04nLFxuICBQT1NUX1BST0NFU1NJTkcgPSAnUE9TVF9QUk9DRVNTSU5HJyxcbiAgS05PV0xFREdFX0JBU0VfUkVTUE9OU0VfR0VORVJBVElPTiA9ICdLTk9XTEVER0VfQkFTRV9SRVNQT05TRV9HRU5FUkFUSU9OJ1xufVxuXG4vKipcbiAqIFNwZWNpZmllcyB3aGV0aGVyIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IHBhcnNlciBMYW1iZGEgZnVuY3Rpb24gd2hlblxuICogcGFyc2luZyB0aGUgcmF3IGZvdW5kYXRpb24gbW9kZWwgb3V0cHV0IGluIHRoZSBwYXJ0IG9mIHRoZSBhZ2VudCBzZXF1ZW5jZVxuICogZGVmaW5lZCBieSB0aGUgcHJvbXB0VHlwZS4gSWYgeW91IHNldCB0aGUgZmllbGQgYXMgT1ZFUlJJREVOLCB0aGVcbiAqIG92ZXJyaWRlTGFtYmRhIGZpZWxkIGluIHRoZSBQcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24gbXVzdCBiZSBzcGVjaWZpZWRcbiAqIHdpdGggdGhlIEFSTiBvZiBhIExhbWJkYSBmdW5jdGlvbi5cbiAqL1xuZXhwb3J0IGVudW0gUGFyc2VyTW9kZSB7XG4gIERFRkFVTFQgPSAnREVGQVVMVCcsXG4gIE9WRVJSSURERU4gPSAnT1ZFUlJJRERFTidcbn1cblxuLyoqXG4gKiBTcGVjaWZpZXMgd2hldGhlciB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBwcm9tcHQgdGVtcGxhdGUgZm9yIHRoaXNcbiAqIHByb21wdFR5cGUuIFNldCB0aGlzIHZhbHVlIHRvIE9WRVJSSURERU4gdG8gdXNlIHRoZSBwcm9tcHQgdGhhdCB5b3VcbiAqIHByb3ZpZGUgaW4gdGhlIGJhc2VQcm9tcHRUZW1wbGF0ZS4gSWYgeW91IGxlYXZlIGl0IGFzIERFRkFVTFQsIHRoZSBhZ2VudFxuICogdXNlcyBhIGRlZmF1bHQgcHJvbXB0IHRlbXBsYXRlLlxuICovXG5leHBvcnQgZW51bSBQcm9tcHRDcmVhdGlvbk1vZGUge1xuICBERUZBVUxUID0gJ0RFRkFVTFQnLFxuICBPVkVSUklEREVOID0gJ09WRVJSSURERU4nXG59XG5cbi8qKlxuICogU3BlY2lmaWVzIHdoZXRoZXIgdG8gYWxsb3cgdGhlIGFnZW50IHRvIGNhcnJ5IG91dCB0aGUgc3RlcCBzcGVjaWZpZWQgaW4gdGhlXG4gKiBwcm9tcHRUeXBlLiBJZiB5b3Ugc2V0IHRoaXMgdmFsdWUgdG8gRElTQUJMRUQsIHRoZSBhZ2VudCBza2lwcyB0aGF0IHN0ZXAuXG4gKiBUaGUgZGVmYXVsdCBzdGF0ZSBmb3IgZWFjaCBwcm9tcHRUeXBlIGlzIGFzIGZvbGxvd3MuXG4gKlxuICogICAgIFBSRV9QUk9DRVNTSU5HIOKAkyBFTkFCTEVEXG4gKiAgICAgT1JDSEVTVFJBVElPTiDigJMgRU5BQkxFRFxuICogICAgIEtOT1dMRURHRV9CQVNFX1JFU1BPTlNFX0dFTkVSQVRJT04g4oCTIEVOQUJMRURcbiAqICAgICBQT1NUX1BST0NFU1NJTkcg4oCTIERJU0FCTEVEXG4gKi9cbmV4cG9ydCBlbnVtIFByb21wdFN0YXRlIHtcbiAgRU5BQkxFRCA9ICdFTkFCTEVEJyxcbiAgRElTQUJMRUQgPSAnRElTQUJMRUQnXG59XG5cbi8qKiBEZXRhaWxzIGFib3V0IHRoZSBndWFyZHJhaWwgYXNzb2NpYXRlZCB3aXRoIHRoZSBhZ2VudC4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgR3VhcmRyYWlsQ29uZmlndXJhdGlvbiB7XG4gIC8qVGhlIHZlcnNpb24gb2YgdGhlIGd1YXJkcmFpbC4qL1xuICByZWFkb25seSBndWFyZHJhaWxWZXJzaW9uPzogc3RyaW5nO1xuICAvKlRoZSBpZGVudGlmaWVkIG9mIHRoZSBndWFyZHJhaWwuKi9cbiAgcmVhZG9ubHkgZ3VhcmRyYWlsSWQ/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogTExNIGluZmVyZW5jZSBjb25maWd1cmF0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSW5mZXJlbmNlQ29uZmlndXJhdGlvbiB7XG4gIC8qKlxuICAgKiBUaGUgbGlrZWxpaG9vZCBvZiB0aGUgbW9kZWwgc2VsZWN0aW5nIGhpZ2hlci1wcm9iYWJpbGl0eSBvcHRpb25zIHdoaWxlXG4gICAqIGdlbmVyYXRpbmcgYSByZXNwb25zZS4gQSBsb3dlciB2YWx1ZSBtYWtlcyB0aGUgbW9kZWwgbW9yZSBsaWtlbHkgdG8gY2hvb3NlXG4gICAqIGhpZ2hlci1wcm9iYWJpbGl0eSBvcHRpb25zLCB3aGlsZSBhIGhpZ2hlciB2YWx1ZSBtYWtlcyB0aGUgbW9kZWwgbW9yZVxuICAgKiBsaWtlbHkgdG8gY2hvb3NlIGxvd2VyLXByb2JhYmlsaXR5IG9wdGlvbnMuXG4gICAqXG4gICAqIEZsb2F0aW5nIHBvaW50XG4gICAqXG4gICAqIG1pbiAwXG4gICAqIG1heCAxXG4gICAqL1xuICByZWFkb25seSB0ZW1wZXJhdHVyZTogbnVtYmVyO1xuICAvKipcbiAgICogV2hpbGUgZ2VuZXJhdGluZyBhIHJlc3BvbnNlLCB0aGUgbW9kZWwgZGV0ZXJtaW5lcyB0aGUgcHJvYmFiaWxpdHkgb2YgdGhlXG4gICAqIGZvbGxvd2luZyB0b2tlbiBhdCBlYWNoIHBvaW50IG9mIGdlbmVyYXRpb24uIFRoZSB2YWx1ZSB0aGF0IHlvdSBzZXQgZm9yXG4gICAqIFRvcCBQIGRldGVybWluZXMgdGhlIG51bWJlciBvZiBtb3N0LWxpa2VseSBjYW5kaWRhdGVzIGZyb20gd2hpY2ggdGhlIG1vZGVsXG4gICAqIGNob29zZXMgdGhlIG5leHQgdG9rZW4gaW4gdGhlIHNlcXVlbmNlLiBGb3IgZXhhbXBsZSwgaWYgeW91IHNldCB0b3BQIHRvXG4gICAqIDgwLCB0aGUgbW9kZWwgb25seSBzZWxlY3RzIHRoZSBuZXh0IHRva2VuIGZyb20gdGhlIHRvcCA4MCUgb2YgdGhlXG4gICAqIHByb2JhYmlsaXR5IGRpc3RyaWJ1dGlvbiBvZiBuZXh0IHRva2Vucy5cbiAgICpcbiAgICogRmxvYXRpbmcgcG9pbnRcbiAgICpcbiAgICogbWluIDBcbiAgICogbWF4IDFcbiAgICovXG4gIHJlYWRvbmx5IHRvcFA6IG51bWJlcjtcbiAgLyoqXG4gICAqIFdoaWxlIGdlbmVyYXRpbmcgYSByZXNwb25zZSwgdGhlIG1vZGVsIGRldGVybWluZXMgdGhlIHByb2JhYmlsaXR5IG9mIHRoZVxuICAgKiBmb2xsb3dpbmcgdG9rZW4gYXQgZWFjaCBwb2ludCBvZiBnZW5lcmF0aW9uLiBUaGUgdmFsdWUgdGhhdCB5b3Ugc2V0IGZvclxuICAgKiB0b3BLIGlzIHRoZSBudW1iZXIgb2YgbW9zdC1saWtlbHkgY2FuZGlkYXRlcyBmcm9tIHdoaWNoIHRoZSBtb2RlbCBjaG9vc2VzXG4gICAqIHRoZSBuZXh0IHRva2VuIGluIHRoZSBzZXF1ZW5jZS4gRm9yIGV4YW1wbGUsIGlmIHlvdSBzZXQgdG9wSyB0byA1MCwgdGhlXG4gICAqIG1vZGVsIHNlbGVjdHMgdGhlIG5leHQgdG9rZW4gZnJvbSBhbW9uZyB0aGUgdG9wIDUwIG1vc3QgbGlrZWx5IGNob2ljZXMuXG4gICAqXG4gICAqIEludGVnZXJcbiAgICpcbiAgICogbWluIDBcbiAgICogbWF4IDUwMFxuICAgKi9cbiAgcmVhZG9ubHkgdG9wSzogbnVtYmVyO1xuICAvKipcbiAgICogQSBsaXN0IG9mIHN0b3Agc2VxdWVuY2VzLiBBIHN0b3Agc2VxdWVuY2UgaXMgYSBzZXF1ZW5jZSBvZiBjaGFyYWN0ZXJzIHRoYXRcbiAgICogY2F1c2VzIHRoZSBtb2RlbCB0byBzdG9wIGdlbmVyYXRpbmcgdGhlIHJlc3BvbnNlLlxuICAgKlxuICAgKiBsZW5ndGggMC00XG4gICAqL1xuICByZWFkb25seSBzdG9wU2VxdWVuY2VzOiBzdHJpbmdbXTtcbiAgLyoqXG4gICAqIFRoZSBtYXhpbXVtIG51bWJlciBvZiB0b2tlbnMgdG8gZ2VuZXJhdGUgaW4gdGhlIHJlc3BvbnNlLlxuICAgKlxuICAgKiBJbnRlZ2VyXG4gICAqXG4gICAqIG1pbiAwXG4gICAqIG1heCA0MDk2XG4gICAqL1xuICByZWFkb25seSBtYXhpbXVtTGVuZ3RoOiBudW1iZXI7XG59XG5cbi8qKlxuICogQ29udGFpbnMgY29uZmlndXJhdGlvbnMgdG8gb3ZlcnJpZGUgYSBwcm9tcHQgdGVtcGxhdGUgaW4gb25lIHBhcnQgb2YgYW4gYWdlbnQgc2VxdWVuY2UuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUHJvbXB0Q29uZmlndXJhdGlvbiB7XG4gIC8qKlxuICAgKiBUaGUgc3RlcCBpbiB0aGUgYWdlbnQgc2VxdWVuY2UgdGhhdCB0aGlzIHByb21wdCBjb25maWd1cmF0aW9uIGFwcGxpZXMgdG8uXG4gICAqL1xuICByZWFkb25seSBwcm9tcHRUeXBlOiBQcm9tcHRUeXBlO1xuICAvKipcbiAgICogQ29udGFpbnMgaW5mZXJlbmNlIHBhcmFtZXRlcnMgdG8gdXNlIHdoZW4gdGhlIGFnZW50IGludm9rZXMgYSBmb3VuZGF0aW9uXG4gICAqIG1vZGVsIGluIHRoZSBwYXJ0IG9mIHRoZSBhZ2VudCBzZXF1ZW5jZSBkZWZpbmVkIGJ5IHRoZSBwcm9tcHRUeXBlLlxuICAgKi9cbiAgcmVhZG9ubHkgaW5mZXJlbmNlQ29uZmlndXJhdGlvbjogSW5mZXJlbmNlQ29uZmlndXJhdGlvbjtcbiAgLyoqXG4gICAqIERlZmluZXMgdGhlIHByb21wdCB0ZW1wbGF0ZSB3aXRoIHdoaWNoIHRvIHJlcGxhY2UgdGhlIGRlZmF1bHQgcHJvbXB0IHRlbXBsYXRlLlxuICAgKlxuICAgKiBsZW5ndGggMC0xMDAwMDBcbiAgICovXG4gIHJlYWRvbmx5IGJhc2VQcm9tcHRUZW1wbGF0ZTogc3RyaW5nO1xuICAvKipcbiAgICogU3BlY2lmaWVzIHdoZXRoZXIgdG8gb3ZlcnJpZGUgdGhlIGRlZmF1bHQgcGFyc2VyIExhbWJkYSBmdW5jdGlvbiB3aGVuXG4gICAqIHBhcnNpbmcgdGhlIHJhdyBmb3VuZGF0aW9uIG1vZGVsIG91dHB1dCBpbiB0aGUgcGFydCBvZiB0aGUgYWdlbnQgc2VxdWVuY2VcbiAgICogZGVmaW5lZCBieSB0aGUgcHJvbXB0VHlwZS4gSWYgeW91IHNldCB0aGUgZmllbGQgYXMgT1ZFUlJJREVOLCB0aGVcbiAgICogb3ZlcnJpZGVMYW1iZGEgZmllbGQgaW4gdGhlIFByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbiBtdXN0IGJlIHNwZWNpZmllZFxuICAgKiB3aXRoIHRoZSBBUk4gb2YgYSBMYW1iZGEgZnVuY3Rpb24uXG4gICAqL1xuICByZWFkb25seSBwYXJzZXJNb2RlPzogUGFyc2VyTW9kZTtcbiAgLyoqXG4gICAqIFNwZWNpZmllcyB3aGV0aGVyIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IHByb21wdCB0ZW1wbGF0ZSBmb3IgdGhpc1xuICAgKiBwcm9tcHRUeXBlLiBTZXQgdGhpcyB2YWx1ZSB0byBPVkVSUklEREVOIHRvIHVzZSB0aGUgcHJvbXB0IHRoYXQgeW91XG4gICAqIHByb3ZpZGUgaW4gdGhlIGJhc2VQcm9tcHRUZW1wbGF0ZS4gSWYgeW91IGxlYXZlIGl0IGFzIERFRkFVTFQsIHRoZSBhZ2VudFxuICAgKiB1c2VzIGEgZGVmYXVsdCBwcm9tcHQgdGVtcGxhdGUuXG4gICAqL1xuICByZWFkb25seSBwcm9tcHRDcmVhdGlvbk1vZGU6IFByb21wdENyZWF0aW9uTW9kZTtcbiAgLyoqXG4gICAqIFNwZWNpZmllcyB3aGV0aGVyIHRvIGFsbG93IHRoZSBhZ2VudCB0byBjYXJyeSBvdXQgdGhlIHN0ZXAgc3BlY2lmaWVkIGluXG4gICAqIHRoZSBwcm9tcHRUeXBlLiBJZiB5b3Ugc2V0IHRoaXMgdmFsdWUgdG8gRElTQUJMRUQsIHRoZSBhZ2VudCBza2lwcyB0aGF0XG4gICAqIHN0ZXAuIFRoZSBkZWZhdWx0IHN0YXRlIGZvciBlYWNoIHByb21wdFR5cGUgaXMgYXMgZm9sbG93cy5cbiAgICpcbiAgICogICAgIFBSRV9QUk9DRVNTSU5HIOKAkyBFTkFCTEVEXG4gICAqICAgICBPUkNIRVNUUkFUSU9OIOKAkyBFTkFCTEVEXG4gICAqICAgICBLTk9XTEVER0VfQkFTRV9SRVNQT05TRV9HRU5FUkFUSU9OIOKAkyBFTkFCTEVEXG4gICAqICAgICBQT1NUX1BST0NFU1NJTkcg4oCTIERJU0FCTEVEXG4gICAqL1xuICByZWFkb25seSBwcm9tcHRTdGF0ZTogUHJvbXB0U3RhdGU7XG59XG5cbi8qKlxuICogQ29udGFpbnMgY29uZmlndXJhdGlvbnMgdG8gb3ZlcnJpZGUgcHJvbXB0cyBpbiBkaWZmZXJlbnQgcGFydHMgb2YgYW4gYWdlbnQgc2VxdWVuY2UuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uIHtcbiAgLyoqXG4gICAqIENvbnRhaW5zIGNvbmZpZ3VyYXRpb25zIHRvIG92ZXJyaWRlIGEgcHJvbXB0IHRlbXBsYXRlIGluIG9uZSBwYXJ0IG9mIGFuIGFnZW50IHNlcXVlbmNlLlxuICAgKi9cbiAgcmVhZG9ubHkgcHJvbXB0Q29uZmlndXJhdGlvbnM6IFByb21wdENvbmZpZ3VyYXRpb25bXTtcbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIExhbWJkYSBmdW5jdGlvbiB0byB1c2Ugd2hlbiBwYXJzaW5nIHRoZSByYXcgZm91bmRhdGlvblxuICAgKiBtb2RlbCBvdXRwdXQgaW4gcGFydHMgb2YgdGhlIGFnZW50IHNlcXVlbmNlLiBJZiB5b3Ugc3BlY2lmeSB0aGlzIGZpZWxkLFxuICAgKiBhdCBsZWFzdCBvbmUgb2YgdGhlIHByb21wdENvbmZpZ3VyYXRpb25zIG11c3QgY29udGFpbiBhIHBhcnNlck1vZGUgdmFsdWVcbiAgICogdGhhdCBpcyBzZXQgdG8gT1ZFUlJJRERFTi5cbiAgICovXG4gIHJlYWRvbmx5IG92ZXJyaWRlTGFtYmRhPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIFByb3BlcnRpZXMgZm9yIGEgQmVkcm9jayBBZ2VudC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBZ2VudFByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBCZWRyb2NrIHRleHQgZm91bmRhdGlvbiBtb2RlbCBmb3IgdGhlIGFnZW50IHRvIHVzZS5cbiAgICovXG4gIHJlYWRvbmx5IGZvdW5kYXRpb25Nb2RlbDogQmVkcm9ja0ZvdW5kYXRpb25Nb2RlbDtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBhZ2VudC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBBIG5hbWUgaXMgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQuXG4gICAqL1xuICByZWFkb25seSBuYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZXhpc3RpbmcgSUFNIFJvbGUgZm9yIHRoZSBhZ2VudCB3aXRoIGEgdHJ1c3QgcG9saWN5IHRoYXRcbiAgICogYWxsb3dzIHRoZSBCZWRyb2NrIHNlcnZpY2UgdG8gYXNzdW1lIHRoZSByb2xlLlxuICAgKi9cbiAgcmVhZG9ubHkgZXhpc3RpbmdSb2xlPzogaWFtLlJvbGU7XG5cbiAgLyoqXG4gICAqIEEgbmFycmF0aXZlIGluc3RydWN0aW9uIHRvIHByb3ZpZGUgdGhlIGFnZW50IGFzIGNvbnRleHQuXG4gICAqL1xuICByZWFkb25seSBpbnN0cnVjdGlvbjogc3RyaW5nO1xuICAvKipcbiAgICogQSBkZXNjcmlwdGlvbiBvZiB0aGUgYWdlbnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gZGVzY3JpcHRpb24gaXMgcHJvdmlkZWQuXG4gICAqL1xuICByZWFkb25seSBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgLyoqXG4gICAqIEtub3dsZWRnZSBCYXNlcyB0byBtYWtlIGF2YWlsYWJsZSB0byB0aGUgYWdlbnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8ga25vd2xlZGdlIGJhc2UgaXMgdXNlZC5cbiAgICovXG4gIHJlYWRvbmx5IGtub3dsZWRnZUJhc2VzPzogS25vd2xlZGdlQmFzZVtdO1xuICAvKipcbiAgICogQWdlbnRBY3Rpb25Hcm91cCB0byBtYWtlIGF2YWlsYWJsZSB0byB0aGUgYWdlbnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gQWdlbnRBY3Rpb25Hcm91cCAgaXMgdXNlZC5cbiAgICovXG4gIHJlYWRvbmx5IGFjdGlvbkdyb3Vwcz86IEFnZW50QWN0aW9uR3JvdXBbXTtcblxuICAvKiogR3VhcmRyYWlsIGNvbmZpZ3VyYXRpb25cbiAgICpcbiAgICogV2FybmluZzogSWYgeW91IHByb3ZpZGUgYSBndWFyZHJhaWwgY29uZmlndXJhdGlvbiB0aHJvdWdoIHRoZSBjb25zdHJ1Y3RvcixcbiAgICogeW91IHdpbGwgbmVlZCB0byBwcm92aWRlIHRoZSBjb3JyZWN0IHBlcm1pc3Npb25zIGZvciB5b3VyIGFnZW50IHRvIGFjY2Vzc1xuICAgKiB0aGUgZ3VhcmRyYWlscy4gSWYgeW91IHdhbnQgdGhlIHBlcm1pc3Npb25zIHRvIGJlIGNvbmZpZ3VyZWQgb24geW91ciBiZWhhbGYsXG4gICAqIHVzZSB0aGUgYWRkR3VhcmRyYWlsIG1ldGhvZC5cbiAgICogQGRlZmF1bHQgLSBObyBndWFyZHJhaWxzIGFzc29jaWF0ZWQgdG8gdGhlIGFnZW50LlxuICAqL1xuICByZWFkb25seSBndWFyZHJhaWxDb25maWd1cmF0aW9uPzogR3VhcmRyYWlsQ29uZmlndXJhdGlvbjtcbiAgLyoqXG4gICAqIFNlbGVjdCB3aGV0aGVyIHRoZSBhZ2VudCBjYW4gcHJvbXB0IGFkZGl0aW9uYWxcbiAgICogaW5mb3JtYXRpb24gZnJvbSB0aGUgdXNlciB3aGVuIGl0IGRvZXMgbm90IGhhdmVcbiAgICogZW5vdWdoIGluZm9ybWF0aW9uIHRvIHJlc3BvbmQgdG8gYW4gdXR0ZXJhbmNlXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gRmFsc2VcbiAgICovXG4gIHJlYWRvbmx5IGVuYWJsZVVzZXJJbnB1dD86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEhvdyBsb25nIHNlc3Npb25zIHNob3VsZCBiZSBrZXB0IG9wZW4gZm9yIHRoZSBhZ2VudC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSAxIGhvdXJcbiAgICovXG4gIHJlYWRvbmx5IGlkbGVTZXNzaW9uVFRMPzogY2RrLkR1cmF0aW9uO1xuICAvKipcbiAgICogS01TIGVuY3J5cHRpb24ga2V5IHRvIHVzZSBmb3IgdGhlIGFnZW50LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIEFuIEFXUyBtYW5hZ2VkIGtleSBpcyB1c2VkLlxuICAgKi9cbiAgcmVhZG9ubHkgZW5jcnlwdGlvbktleT86IGttcy5JS2V5O1xuICAvKipcbiAgICogT3ZlcnJpZGVzIGZvciB0aGUgYWdlbnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gb3ZlcnJpZGVzIGFyZSBwcm92aWRlZC5cbiAgICovXG4gIHJlYWRvbmx5IHByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbj86IFByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbjtcbiAgLyoqXG4gICAqIE5hbWUgb2YgdGhlIGFsaWFzIGZvciB0aGUgYWdlbnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gYWxpYXMgaXMgY3JlYXRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGFsaWFzTmFtZT86IHN0cmluZztcbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gcHJlcGFyZSB0aGUgYWdlbnQgZm9yIHVzZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgc2hvdWxkUHJlcGFyZUFnZW50PzogYm9vbGVhbjtcblxuICAvKipcbiAgICogT1BUSU9OQUw6IFRhZyAoS0VZLVZBTFVFKSBiZWRyb2NrIGFnZW50IHJlc291cmNlXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZmFsc2VcbiAgICovXG4gIHJlYWRvbmx5IHRhZ3M/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xufVxuXG4vKipcbiAqIFByb3BlcnRpZXMgdG8gYWRkIGFuIEFsaWFzIHRvIGFuIEFnZW50XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQWRkQWdlbnRBbGlhc1Byb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIGZvciB0aGUgYWdlbnQgYWxpYXMuXG4gICAqL1xuICByZWFkb25seSBhbGlhc05hbWU6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSB2ZXJzaW9uIG9mIHRoZSBhZ2VudCB0byBhc3NvY2lhdGUgd2l0aCB0aGUgYWdlbnQgYWxpYXMuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQ3JlYXRlcyBhIG5ldyB2ZXJzaW9uIG9mIHRoZSBhZ2VudC5cbiAgICovXG4gIHJlYWRvbmx5IGFnZW50VmVyc2lvbj86IHN0cmluZztcblxuICAvKipcbiAgICogRGVzY3JpcHRpb24gZm9yIHRoZSBhZ2VudCBhbGlhcy5cbiAgICpcbiAgICovXG4gIHJlYWRvbmx5IGRlc2NyaXB0aW9uPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIERlcGxveSBhIEJlZHJvY2sgQWdlbnQuXG4gKi9cbmV4cG9ydCBjbGFzcyBBZ2VudCBleHRlbmRzIENvbnN0cnVjdCB7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgbmFtZTogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIElBTSByb2xlIGZvciB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgcm9sZTogaWFtLlJvbGU7XG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGFnZW50SWQ6IHN0cmluZztcbiAgLyoqXG4gICAqIEluc3RhbmNlIG9mIEFnZW50XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgYWdlbnRJbnN0YW5jZTogYmVkcm9jay5DZm5BZ2VudDtcbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGFnZW50QXJuOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGFnZW50IGFsaWFzLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGFsaWFzSWQ/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBhZ2VudCBhbGlhcy5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBhbGlhc0Fybj86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBuYW1lIGZvciB0aGUgYWdlbnQgYWxpYXMuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgYWxpYXNOYW1lPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHZlcnNpb24gZm9yIHRoZSBhZ2VudFxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGFnZW50dmVyc2lvbjogc3RyaW5nO1xuICAvKipcbiAgICogQSBsaXN0IG9mIHZhbHVlcyB0byBpbmRpY2F0ZSBpZiBQcmVwYXJlQWdlbnQgb3IgYW4gQWxpYXMgbmVlZHMgdG8gYmUgdXBkYXRlZC5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByaXZhdGUgcmVzb3VyY2VVcGRhdGVzOiBzdHJpbmdbXSA9IFtdO1xuXG4gIC8qKlxuICAgKiBBIGxpc3Qgb2YgYWN0aW9uIGdyb3VwcyBhc3NvY2lhdGVkIHdpdGggdGhlIGFnZW50XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwdWJsaWMgYWN0aW9uR3JvdXBzOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50QWN0aW9uR3JvdXBQcm9wZXJ0eVtdID0gW107XG4gIC8qKlxuICAgKiBBIGxpc3Qgb2YgS25vd2xlZGdlQmFzZXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBhZ2VudC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBrbm93bGVkZ2UgYmFzZSBpcyB1c2VkLlxuICAgKi9cbiAgcHVibGljIGtub3dsZWRnZUJhc2VzOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50S25vd2xlZGdlQmFzZVByb3BlcnR5W10gPSBbXTtcblxuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBBZ2VudFByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcbiAgICB2YWxpZGF0ZVByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbihwcm9wcy5wcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24pO1xuXG4gICAgdmFsaWRhdGVNb2RlbChwcm9wcy5mb3VuZGF0aW9uTW9kZWwpO1xuXG4gICAgdGhpcy5uYW1lID0gcHJvcHMubmFtZSA/PyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKFxuICAgICAgdGhpcyxcbiAgICAgICdiZWRyb2NrLWFnZW50JyxcbiAgICAgIHsgbWF4TGVuZ3RoOiAzMiwgbG93ZXI6IHRydWUsIHNlcGFyYXRvcjogJy0nIH0pO1xuXG4gICAgaWYgKHByb3BzLmV4aXN0aW5nUm9sZSkge1xuICAgICAgdGhpcy5yb2xlID0gcHJvcHMuZXhpc3RpbmdSb2xlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJvbGUgPSBuZXcgaWFtLlJvbGUodGhpcywgJ1JvbGUnLCB7XG4gICAgICAgIGFzc3VtZWRCeTogbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdiZWRyb2NrLmFtYXpvbmF3cy5jb20nKSxcbiAgICAgICAgcm9sZU5hbWU6IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIoXG4gICAgICAgICAgdGhpcyxcbiAgICAgICAgICAnQW1hem9uQmVkcm9ja0V4ZWN1dGlvblJvbGVGb3JBZ2VudHNfJyxcbiAgICAgICAgICB7IG1heExlbmd0aDogNjQsIGxvd2VyOiBmYWxzZSB9KSxcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnJvbGUuYXNzdW1lUm9sZVBvbGljeSEuYWRkU3RhdGVtZW50cyhcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFsnc3RzOkFzc3VtZVJvbGUnXSxcbiAgICAgICAgICBwcmluY2lwYWxzOiBbbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdiZWRyb2NrLmFtYXpvbmF3cy5jb20nKV0sXG4gICAgICAgICAgY29uZGl0aW9uczoge1xuICAgICAgICAgICAgU3RyaW5nRXF1YWxzOiB7XG4gICAgICAgICAgICAgICdhd3M6U291cmNlQWNjb3VudCc6IGNkay5TdGFjay5vZih0aGlzKS5hY2NvdW50LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIEFybkxpa2U6IHtcbiAgICAgICAgICAgICAgJ2F3czpTb3VyY2VBcm4nOiBjZGsuU3RhY2sub2YodGhpcykuZm9ybWF0QXJuKHtcbiAgICAgICAgICAgICAgICBzZXJ2aWNlOiAnYmVkcm9jaycsXG4gICAgICAgICAgICAgICAgcmVzb3VyY2U6ICdhZ2VudCcsXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VOYW1lOiAnKicsXG4gICAgICAgICAgICAgICAgYXJuRm9ybWF0OiBjZGsuQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUsXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICk7XG5cbiAgICAgIG5ldyBpYW0uUG9saWN5KHRoaXMsICdBZ2VudEZNUG9saWN5Jywge1xuICAgICAgICByb2xlczogW3RoaXMucm9sZV0sXG4gICAgICAgIHN0YXRlbWVudHM6IFtcbiAgICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgICBhY3Rpb25zOiBbJ2JlZHJvY2s6SW52b2tlTW9kZWwnXSxcbiAgICAgICAgICAgIHJlc291cmNlczogW3Byb3BzLmZvdW5kYXRpb25Nb2RlbC5hc0Fybih0aGlzKV0sXG4gICAgICAgICAgfSksXG4gICAgICAgIF0sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBhZ2VudCA9IG5ldyBiZWRyb2NrLkNmbkFnZW50KHRoaXMsICdBZ2VudCcsIHtcblxuICAgICAgYWdlbnROYW1lOiB0aGlzLm5hbWUsXG5cbiAgICAgIGZvdW5kYXRpb25Nb2RlbDogU3RyaW5nKHByb3BzLmZvdW5kYXRpb25Nb2RlbCksXG4gICAgICBpbnN0cnVjdGlvbjogcHJvcHMuaW5zdHJ1Y3Rpb24sXG4gICAgICBkZXNjcmlwdGlvbjogcHJvcHMuZGVzY3JpcHRpb24sXG4gICAgICBpZGxlU2Vzc2lvblR0bEluU2Vjb25kczogcHJvcHMuaWRsZVNlc3Npb25UVEw/LnRvU2Vjb25kcygpLFxuICAgICAgYWdlbnRSZXNvdXJjZVJvbGVBcm46IHRoaXMucm9sZS5yb2xlQXJuLFxuICAgICAgY3VzdG9tZXJFbmNyeXB0aW9uS2V5QXJuOiBwcm9wcy5lbmNyeXB0aW9uS2V5Py5rZXlBcm4sXG4gICAgICB0YWdzOiBwcm9wcy50YWdzLFxuICAgICAgcHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uOiBwcm9wcy5wcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24sXG4gICAgICBhdXRvUHJlcGFyZTogcHJvcHMuc2hvdWxkUHJlcGFyZUFnZW50LFxuICAgIH0pO1xuXG4gICAgdGhpcy5hZ2VudEluc3RhbmNlID0gYWdlbnQ7XG4gICAgdGhpcy5hZ2VudElkID0gYWdlbnQuYXR0ckFnZW50SWQ7XG4gICAgdGhpcy5hZ2VudEFybiA9IGFnZW50LmF0dHJBZ2VudEFybjtcbiAgICB0aGlzLmFnZW50dmVyc2lvbiA9IGFnZW50LmF0dHJBZ2VudFZlcnNpb247XG5cbiAgICBpZiAocHJvcHMuZ3VhcmRyYWlsQ29uZmlndXJhdGlvbikge1xuICAgICAgdGhpcy5hZ2VudEluc3RhbmNlLmd1YXJkcmFpbENvbmZpZ3VyYXRpb24gPSB7XG4gICAgICAgIGd1YXJkcmFpbElkZW50aWZpZXI6IHByb3BzLmd1YXJkcmFpbENvbmZpZ3VyYXRpb24/Lmd1YXJkcmFpbElkLFxuICAgICAgICBndWFyZHJhaWxWZXJzaW9uOiBwcm9wcy5ndWFyZHJhaWxDb25maWd1cmF0aW9uPy5ndWFyZHJhaWxWZXJzaW9uLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICB0aGlzLl9hZGRBbGlhc0RlcGVuZGVuY3koYWdlbnQuYXR0clVwZGF0ZWRBdCk7XG5cbiAgICBpZiAocHJvcHMuYWxpYXNOYW1lKSB7XG4gICAgICBjb25zdCBhbGlhcyA9IHRoaXMuYWRkQWxpYXMoe1xuICAgICAgICBhbGlhc05hbWU6IHByb3BzLmFsaWFzTmFtZSxcbiAgICAgIH0pO1xuICAgICAgdGhpcy5hbGlhc0lkID0gYWxpYXMuYWxpYXNJZDtcbiAgICAgIHRoaXMuYWxpYXNBcm4gPSBhbGlhcy5hbGlhc0FybjtcbiAgICAgIHRoaXMuYWxpYXNOYW1lID0gYWxpYXMuYWxpYXNOYW1lO1xuICAgIH1cblxuICAgIGlmIChwcm9wcy5rbm93bGVkZ2VCYXNlcykge1xuICAgICAgdGhpcy5hZGRLbm93bGVkZ2VCYXNlcyhwcm9wcy5rbm93bGVkZ2VCYXNlcyk7XG4gICAgfVxuXG4gICAgaWYgKHByb3BzLmFjdGlvbkdyb3Vwcykge1xuICAgICAgdGhpcy5hZGRBY3Rpb25Hcm91cHMocHJvcHMuYWN0aW9uR3JvdXBzKTtcbiAgICB9XG4gICAgLy8gVG8gYWxsb3cgeW91ciBhZ2VudCB0byByZXF1ZXN0IHRoZSB1c2VyIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gICAgLy8gd2hlbiB0cnlpbmcgdG8gY29tcGxldGUgYSB0YXNrLCBhZGQgdGhpcyBhY3Rpb24gZ3JvdXBcbiAgICB0aGlzLmFkZEFjdGlvbkdyb3VwKG5ldyBBZ2VudEFjdGlvbkdyb3VwKHRoaXMsICd1c2VySW5wdXRFbmFibGVkQWN0aW9uR3JvdXAnLCB7XG4gICAgICBhY3Rpb25Hcm91cE5hbWU6ICdVc2VySW5wdXRBY3Rpb24nLFxuICAgICAgcGFyZW50QWN0aW9uR3JvdXBTaWduYXR1cmU6ICdBTUFaT04uVXNlcklucHV0JyxcbiAgICAgIGFjdGlvbkdyb3VwU3RhdGU6IHByb3BzLmVuYWJsZVVzZXJJbnB1dCA/ICdFTkFCTEVEJyA6ICdESVNBQkxFRCcsXG4gICAgfSkpO1xuICB9XG5cblxuICAvKipcbiAgICogQWRkIGFuIGFsaWFzIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBhZGRBbGlhcyhwcm9wczogQWRkQWdlbnRBbGlhc1Byb3BzKTogQWdlbnRBbGlhcyB7XG4gICAgY29uc3QgYWxpYXMgPSBuZXcgQWdlbnRBbGlhcyh0aGlzLCBgQWdlbnRBbGlhcy0ke3Byb3BzLmFsaWFzTmFtZX1gLCB7XG4gICAgICBhZ2VudElkOiB0aGlzLmFnZW50SWQsXG4gICAgICBhZ2VudFZlcnNpb246IHByb3BzLmFnZW50VmVyc2lvbixcbiAgICAgIHJlc291cmNlVXBkYXRlczogY2RrLkxhenkubGlzdCh7IHByb2R1Y2U6ICgpID0+IHRoaXMucmVzb3VyY2VVcGRhdGVzIH0pLFxuICAgICAgYWxpYXNOYW1lOiBwcm9wcy5hbGlhc05hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogcHJvcHMuZGVzY3JpcHRpb24sXG4gICAgfSk7XG4gICAgcmV0dXJuIGFsaWFzO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBrbm93bGVkZ2UgYmFzZXMgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFkZEtub3dsZWRnZUJhc2VzKGtub3dsZWRnZUJhc2VzOiBLbm93bGVkZ2VCYXNlW10pIHtcbiAgICBmb3IgKGNvbnN0IGtiIG9mIGtub3dsZWRnZUJhc2VzKSB7XG4gICAgICB0aGlzLmFkZEtub3dsZWRnZUJhc2Uoa2IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQga25vd2xlZGdlIGJhc2UgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFkZEtub3dsZWRnZUJhc2Uoa25vd2xlZGdlQmFzZTogS25vd2xlZGdlQmFzZSkge1xuICAgIGlmICgha25vd2xlZGdlQmFzZS5pbnN0cnVjdGlvbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBZ2VudCBLbm93bGVkZ2UgQmFzZXMgcmVxdWlyZSBpbnN0cnVjdGlvbnMuJyk7XG4gICAgfVxuICAgIG5ldyBpYW0uUG9saWN5KHRoaXMsIGBBZ2VudEtCUG9saWN5LSR7a25vd2xlZGdlQmFzZS5uYW1lfWAsIHtcbiAgICAgIHJvbGVzOiBbdGhpcy5yb2xlXSxcbiAgICAgIHN0YXRlbWVudHM6IFtcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICAgICdiZWRyb2NrOlVwZGF0ZUtub3dsZWRnZUJhc2UnLFxuICAgICAgICAgICAgJ2JlZHJvY2s6UmV0cmlldmUnLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgcmVzb3VyY2VzOiBba25vd2xlZGdlQmFzZS5rbm93bGVkZ2VCYXNlQXJuXSxcbiAgICAgICAgfSksXG4gICAgICBdLFxuICAgIH0pO1xuICAgIGNvbnN0IGFnZW50S25vd2xlZGdlQmFzZVByb3BlcnR5OiBiZWRyb2NrLkNmbkFnZW50LkFnZW50S25vd2xlZGdlQmFzZVByb3BlcnR5ID0ge1xuICAgICAgZGVzY3JpcHRpb246IGtub3dsZWRnZUJhc2UuaW5zdHJ1Y3Rpb24sIC8vIGtub3duIGlzc3VlOiB3cm9uZyBwYXJhbWV0ZXIgbWFwcGluZyBpbiBDZm4uIFdvcmthcm91bmQ6IHBhc3MgaW5zdHJ1Y3Rpb24gdGhyb3VnaCBkZXNjcmlwdGlvblxuICAgICAga25vd2xlZGdlQmFzZUlkOiBrbm93bGVkZ2VCYXNlLmtub3dsZWRnZUJhc2VJZCxcbiAgICAgIGtub3dsZWRnZUJhc2VTdGF0ZToga25vd2xlZGdlQmFzZS5rbm93bGVkZ2VCYXNlU3RhdGUsXG4gICAgfTtcblxuICAgIGlmICghdGhpcy5hZ2VudEluc3RhbmNlLmtub3dsZWRnZUJhc2VzIHx8ICFBcnJheS5pc0FycmF5KHRoaXMuYWdlbnRJbnN0YW5jZS5rbm93bGVkZ2VCYXNlcykpIHtcbiAgICAgIHRoaXMuYWdlbnRJbnN0YW5jZS5rbm93bGVkZ2VCYXNlcyA9IFthZ2VudEtub3dsZWRnZUJhc2VQcm9wZXJ0eV07XG4gICAgfSBlbHNlIHtcbiAgICAgICh0aGlzLmFnZW50SW5zdGFuY2Uua25vd2xlZGdlQmFzZXMgYXMgYW55KS5wdXNoKGFnZW50S25vd2xlZGdlQmFzZVByb3BlcnR5KTtcbiAgICB9XG4gIH1cblxuXG4gIC8qKlxuICAgKiBBZGQgYWN0aW9uIGdyb3VwIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBhZGRBY3Rpb25Hcm91cChhY3Rpb25Hcm91cDogQWdlbnRBY3Rpb25Hcm91cCkge1xuICAgIGFjdGlvbkdyb3VwLmFjdGlvbkdyb3VwRXhlY3V0b3I/LmxhbWJkYT8uYWRkUGVybWlzc2lvbignQWdlbnRMYW1iZGFJbnZvY2F0aW9uUG9saWN5Jywge1xuICAgICAgcHJpbmNpcGFsOiBuZXcgaWFtLlNlcnZpY2VQcmluY2lwYWwoJ2JlZHJvY2suYW1hem9uYXdzLmNvbScpLFxuICAgICAgc291cmNlQXJuOiB0aGlzLmFnZW50QXJuLFxuICAgICAgc291cmNlQWNjb3VudDogY2RrLlN0YWNrLm9mKHRoaXMpLmFjY291bnQsXG4gICAgfSk7XG5cbiAgICBpZiAoIXRoaXMuYWdlbnRJbnN0YW5jZS5hY3Rpb25Hcm91cHMgfHwgIUFycmF5LmlzQXJyYXkodGhpcy5hZ2VudEluc3RhbmNlLmFjdGlvbkdyb3VwcykpIHtcbiAgICAgIHRoaXMuYWdlbnRJbnN0YW5jZS5hY3Rpb25Hcm91cHMgPSBbYWN0aW9uR3JvdXAuYWN0aW9uR3JvdXBQcm9wZXJ0eV07XG4gICAgfSBlbHNlIHtcbiAgICAgICh0aGlzLmFnZW50SW5zdGFuY2UuYWN0aW9uR3JvdXBzIGFzIGFueSkucHVzaChhY3Rpb25Hcm91cC5hY3Rpb25Hcm91cFByb3BlcnR5KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQWRkIGFjdGlvbiBncm91cHMgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFkZEFjdGlvbkdyb3VwcyhhY3Rpb25Hcm91cHM6IEFnZW50QWN0aW9uR3JvdXBbXSkge1xuICAgIGZvciAoY29uc3QgYWN0aW9uR3JvdXAgb2YgYWN0aW9uR3JvdXBzKSB7XG4gICAgICB0aGlzLmFkZEFjdGlvbkdyb3VwKGFjdGlvbkdyb3VwKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQWRkIGd1YXJkcmFpbCB0byB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgYWRkR3VhcmRyYWlsKGd1YXJkcmFpbDogR3VhcmRyYWlsKSB7XG4gICAgbmV3IGlhbS5Qb2xpY3kodGhpcywgYEFnZW50R3VhcmRyYWlsUG9saWN5LSR7Z3VhcmRyYWlsLm5hbWV9YCwge1xuICAgICAgcm9sZXM6IFt0aGlzLnJvbGVdLFxuICAgICAgc3RhdGVtZW50czogW1xuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAgJ2JlZHJvY2s6QXBwbHlHdWFyZHJhaWwnLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbYGFybjoke2Nkay5Bd3MuUEFSVElUSU9OfTpiZWRyb2NrOiR7Y2RrLkF3cy5SRUdJT059OiR7Y2RrLkF3cy5BQ0NPVU5UX0lEfTpndWFyZHJhaWwvJHtndWFyZHJhaWwuZ3VhcmRyYWlsSWR9YF0sXG4gICAgICAgIH0pLFxuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAgJ2ttczpEZWNyeXB0JyxcbiAgICAgICAgICBdLFxuICAgICAgICAgIHJlc291cmNlczogW2d1YXJkcmFpbC5rbXNLZXlBcm5dLFxuICAgICAgICAgIGNvbmRpdGlvbnM6IHtcbiAgICAgICAgICAgIFN0cmluZ0VxdWFsczoge1xuICAgICAgICAgICAgICAnYXdzOlJlc291cmNlQWNjb3VudCc6IGNkay5Bd3MuQUNDT1VOVF9JRCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgdGhpcy5hZ2VudEluc3RhbmNlLmd1YXJkcmFpbENvbmZpZ3VyYXRpb24gPSB7XG4gICAgICBndWFyZHJhaWxJZGVudGlmaWVyOiBndWFyZHJhaWwuZ3VhcmRyYWlsSWQsXG4gICAgICBndWFyZHJhaWxWZXJzaW9uOiBndWFyZHJhaWwuZ3VhcmRyYWlsVmVyc2lvbixcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVyIGEgZGVwZW5kZW5jeSBmb3IgYWxpYXNlcy5cbiAgICpcbiAgICogQHBhcmFtIHVwZGF0ZWRBdCAtIFRoZSB1cGRhdGVkQXQgb2YgdGhlIHJlc291cmNlIHRoYXQgd2lsbCBiZSByZWdpc3RlcmVkIGFzIGEgZGVwZW5kZW5jeS5cbiAgICpcbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwdWJsaWMgX2FkZEFsaWFzRGVwZW5kZW5jeSh1cGRhdGVkQXQ6IHN0cmluZykge1xuICAgIGlmICh1cGRhdGVkQXQpIHtcbiAgICAgIHRoaXMucmVzb3VyY2VVcGRhdGVzLnB1c2godXBkYXRlZEF0KTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSB0aGF0IEJlZHJvY2sgQWdlbnRzIGNhbiB1c2UgdGhlIHNlbGVjdGVkIG1vZGVsLlxuICpcbiAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICovXG5mdW5jdGlvbiB2YWxpZGF0ZU1vZGVsKGZvdW5kYXRpb25Nb2RlbDogQmVkcm9ja0ZvdW5kYXRpb25Nb2RlbCkge1xuICBpZiAoIWZvdW5kYXRpb25Nb2RlbC5zdXBwb3J0c0FnZW50cykge1xuICAgIHRocm93IG5ldyBFcnJvcihgVGhlIG1vZGVsICR7Zm91bmRhdGlvbk1vZGVsfSBpcyBub3Qgc3VwcG9ydGVkIGJ5IEJlZHJvY2sgQWdlbnRzLmApO1xuICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgdGhlIGluZmVyZW5jZUNvbmZpZ3VyYXRpb24gb2YgYSBwcm9tcHQgb3ZlcnJpZGUuXG4gKlxuICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUluZmVyZW5jZUNvbmZpZ3VyYXRpb24oaW5mZXJlbmNlQ29uZmlndXJhdGlvbjogSW5mZXJlbmNlQ29uZmlndXJhdGlvbikge1xuICBpZiAoaW5mZXJlbmNlQ29uZmlndXJhdGlvbi50b3BLIDwgMCB8fCBpbmZlcmVuY2VDb25maWd1cmF0aW9uLnRvcEsgPiA1MDApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3RvcEsgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDUwMCcpO1xuICB9XG5cbiAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGluZmVyZW5jZUNvbmZpZ3VyYXRpb24udG9wSykpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3RvcEsgbXVzdCBiZSBhbiBpbnRlZ2VyJyk7XG4gIH1cblxuICBpZiAoaW5mZXJlbmNlQ29uZmlndXJhdGlvbi5zdG9wU2VxdWVuY2VzLmxlbmd0aCA+IDQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3N0b3BTZXF1ZW5jZXMgY2Fubm90IGNvbnRhaW4gbW9yZSB0aGFuIDQgZWxlbWVudHMnKTtcbiAgfVxuXG4gIGlmIChpbmZlcmVuY2VDb25maWd1cmF0aW9uLm1heGltdW1MZW5ndGggPCAwIHx8IGluZmVyZW5jZUNvbmZpZ3VyYXRpb24ubWF4aW11bUxlbmd0aCA+IDQwOTYpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ21heGltdW1MZW5ndGggbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDQwOTYnKTtcbiAgfVxuXG4gIGlmICghTnVtYmVyLmlzSW50ZWdlcihpbmZlcmVuY2VDb25maWd1cmF0aW9uLm1heGltdW1MZW5ndGgpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdtYXhpbXVtTGVuZ3RoIG11c3QgYmUgYW4gaW50ZWdlcicpO1xuICB9XG5cbiAgaWYgKGluZmVyZW5jZUNvbmZpZ3VyYXRpb24udG9wUCA8IDAgfHwgaW5mZXJlbmNlQ29uZmlndXJhdGlvbi50b3BQID4gMSkge1xuICAgIHRocm93IG5ldyBFcnJvcigndG9wUCBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMScpO1xuICB9XG5cbiAgaWYgKGluZmVyZW5jZUNvbmZpZ3VyYXRpb24udGVtcGVyYXR1cmUgPCAwIHx8IGluZmVyZW5jZUNvbmZpZ3VyYXRpb24udGVtcGVyYXR1cmUgPiAxKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCd0ZW1wZXJhdHVyZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMScpO1xuICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgdGhlIHByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbi5cbiAqXG4gKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlUHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uKHByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbjogUHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uIHwgdW5kZWZpbmVkKSB7XG4gIGlmICghcHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKFxuICAgIHByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbi5vdmVycmlkZUxhbWJkYSAmJlxuICAgIHByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbi5wcm9tcHRDb25maWd1cmF0aW9ucy5zb21lKFxuICAgICAgcGMgPT4gcGMucGFyc2VyTW9kZSAhPT0gUGFyc2VyTW9kZS5PVkVSUklEREVOLFxuICAgICkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ292ZXJyaWRlTGFtYmRhIGNhbiBvbmx5IGJlIHVzZWQgaWYgYWxsIHByb21wdENvbmZpZ3VyYXRpb25zIGhhdmUgYSBwYXJzZXJNb2RlIHZhbHVlIG9mIE9WRVJSSURERU4nKTtcbiAgfVxuXG4gIGlmIChcbiAgICAhcHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uLm92ZXJyaWRlTGFtYmRhICYmXG4gICAgcHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uLnByb21wdENvbmZpZ3VyYXRpb25zLnNvbWUoXG4gICAgICBwYyA9PiBwYy5wYXJzZXJNb2RlID09PSBQYXJzZXJNb2RlLk9WRVJSSURERU4sXG4gICAgKSkge1xuICAgIHRocm93IG5ldyBFcnJvcignQXQgbGVhc3Qgb25lIHByb21wdENvbmZpZ3VyYXRpb24gaGFzIGEgcGFyc2VyTW9kZSB2YWx1ZSBvZiBPVkVSUklEREVOLCBidXQgbm8gb3ZlcnJpZGVMYW1iZGEgaXMgc3BlY2lmaWVkJyk7XG4gIH1cblxuICAvLyBjaGVjayBpbmZlcmVuY2VDb25maWd1cmF0aW9uIG51bWJlciB0eXBlc1xuICBPYmplY3QudmFsdWVzKHByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbi5wcm9tcHRDb25maWd1cmF0aW9ucykuZm9yRWFjaChwYyA9PiB7XG4gICAgdmFsaWRhdGVJbmZlcmVuY2VDb25maWd1cmF0aW9uKHBjLmluZmVyZW5jZUNvbmZpZ3VyYXRpb24pO1xuICB9KTtcblxuICByZXR1cm47XG59XG5cbiJdfQ==