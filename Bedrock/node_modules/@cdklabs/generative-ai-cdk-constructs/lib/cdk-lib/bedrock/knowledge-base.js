"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.KnowledgeBase = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const cdk = require("aws-cdk-lib");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const iam = require("aws-cdk-lib/aws-iam");
const nag_suppressions_1 = require("cdk-nag/lib/nag-suppressions");
const constructs_1 = require("constructs");
const utils_1 = require("../../common/helpers/utils");
const amazonaurora_1 = require("../amazonaurora");
const opensearch_vectorindex_1 = require("../opensearch-vectorindex");
const opensearchserverless_1 = require("../opensearchserverless");
const pinecone_1 = require("../pinecone");
/**
 * Knowledge base can be backed by different vector databases.
 * This enum represents the different vector databases that can be used.
 *
 * `OPENSEARCH_SERVERLESS` is the default vector database.
 * `REDIS_ENTERPRISE_CLOUD` is the vector database for Redis Enterprise Cloud.
 * `PINECONE` is the vector database for Pinecone.
 * `AMAZON_AURORA` is the vector database for Amazon Aurora PostgreSQL.
 */
var VectorStoreType;
(function (VectorStoreType) {
    /**
     * `OPENSEARCH_SERVERLESS` is the vector store for OpenSearch Serverless.
     */
    VectorStoreType["OPENSEARCH_SERVERLESS"] = "OPENSEARCH_SERVERLESS";
    /**
     * `PINECONE` is the vector store for Pinecone.
     */
    VectorStoreType["PINECONE"] = "PINECONE";
    /**
     * `RDS` is the vector store for Amazon Aurora.
     */
    VectorStoreType["AMAZON_AURORA"] = "RDS";
})(VectorStoreType || (VectorStoreType = {}));
/**
 * Deploys a Bedrock Knowledge Base and configures a backend by OpenSearch Serverless,
 * Pinecone, Redis Enterprise Cloud or Amazon Aurora PostgreSQL.
 *
 */
class KnowledgeBase extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        this.instruction = props.instruction;
        const embeddingsModel = props.embeddingsModel;
        const indexName = props.indexName ?? 'bedrock-knowledge-base-default-index';
        const vectorField = props.vectorField ?? 'bedrock-knowledge-base-default-vector';
        const textField = 'AMAZON_BEDROCK_TEXT_CHUNK';
        const metadataField = 'AMAZON_BEDROCK_METADATA';
        this.description = props.description ?? 'CDK deployed Knowledge base'; // even though this prop is optional, if no value is provided it will fail to deploy
        this.knowledgeBaseState = props.knowledgeBaseState ?? 'ENABLED';
        validateModel(embeddingsModel);
        validateVectorIndex(props.vectorStore, props.vectorIndex, props.vectorField, props.indexName);
        if (props.vectorIndex) {
            validateIndexParameters(props.vectorIndex, indexName, vectorField);
        }
        this.name =
            props.name ?? (0, utils_1.generatePhysicalNameV2)(this, 'KB', { maxLength: 32 });
        if (props.existingRole) {
            this.role = props.existingRole;
        }
        else {
            const roleName = (0, utils_1.generatePhysicalNameV2)(this, 'AmazonBedrockExecutionRoleForKnowledgeBase', { maxLength: 64 });
            this.role = new iam.Role(this, 'Role', {
                roleName: roleName,
                assumedBy: new iam.ServicePrincipal('bedrock.amazonaws.com'),
            });
            this.role.assumeRolePolicy.addStatements(new iam.PolicyStatement({
                actions: ['sts:AssumeRole'],
                principals: [new iam.ServicePrincipal('bedrock.amazonaws.com')],
                conditions: {
                    StringEquals: {
                        'aws:SourceAccount': cdk.Stack.of(this).account,
                    },
                    ArnLike: {
                        'aws:SourceArn': cdk.Stack.of(this).formatArn({
                            service: 'bedrock',
                            resource: 'knowledge-base',
                            resourceName: '*',
                            arnFormat: cdk.ArnFormat.SLASH_RESOURCE_NAME,
                        }),
                    },
                },
            }));
            this.role.addToPolicy(new iam.PolicyStatement({
                actions: ['bedrock:InvokeModel'],
                resources: [embeddingsModel.asArn(this)],
            }));
        }
        /**
         * Create the vector store if the vector store was provided by the user.
         * Otherwise check againts all possible vector datastores.
         * If none was provided create default OpenSearch Serverless Collection.
         */
        if (props.vectorStore instanceof opensearchserverless_1.VectorCollection) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleOpenSearchCollection(props));
        }
        else if (props.vectorStore instanceof pinecone_1.PineconeVectorStore) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handlePineconeVectorStore(props));
        }
        else if (props.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleAmazonAuroraVectorStore(props));
        }
        else if (props.vectorStore instanceof amazonaurora_1.AmazonAuroraDefaultVectorStore) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleAmazonAuroraDefaultVectorStore(props));
        }
        else {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleOpenSearchDefaultVectorCollection());
        }
        /**
         * We need to add `secretsmanager:GetSecretValue` to the role
         * of the knowledge base if we use data sources
         * other than OpenSearch Serverless.
         */
        if (!(this.vectorStore instanceof opensearchserverless_1.VectorCollection)) {
            this.role.addToPolicy(new iam.PolicyStatement({
                actions: ['secretsmanager:GetSecretValue'],
                resources: [this.vectorStore.credentialsSecretArn],
            }));
        }
        /**
         * We need to add `rds-data:ExecuteStatement`,
         * `rds-data:BatchExecuteStatement` and
         * `rds:DescribeDBClusters` to the role
         * of the knowledge base if we use Amazon Aurora as
         * a data source.
         */
        if (this.vectorStore instanceof amazonaurora_1.AmazonAuroraDefaultVectorStore ||
            this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore) {
            this.role.addToPolicy(new iam.PolicyStatement({
                actions: [
                    'rds-data:ExecuteStatement',
                    'rds-data:BatchExecuteStatement',
                    'rds:DescribeDBClusters',
                ],
                resources: [this.vectorStore.resourceArn],
            }));
        }
        /**
         * Create the vector index if the vector store is OpenSearch Serverless
         * and it was not provided. Otherwise use the provided vector index.
         */
        if (this.vectorStoreType === VectorStoreType.OPENSEARCH_SERVERLESS) {
            if (!props.vectorIndex) {
                this.vectorIndex = new opensearch_vectorindex_1.VectorIndex(this, 'KBIndex', {
                    collection: this.vectorStore,
                    indexName,
                    vectorField,
                    vectorDimensions: embeddingsModel.vectorDimensions,
                    mappings: [
                        {
                            mappingField: 'AMAZON_BEDROCK_TEXT_CHUNK',
                            dataType: 'text',
                            filterable: true,
                        },
                        {
                            mappingField: 'AMAZON_BEDROCK_METADATA',
                            dataType: 'text',
                            filterable: false,
                        },
                    ],
                });
                this.vectorIndex.node.addDependency(this.vectorStore);
            }
            else {
                this.vectorIndex = props.vectorIndex;
            }
        }
        /**
         * Create storage configuraion. If it is of type of
         * `AmazonAuroraVectorStore` get textField, metadataField,
         * vectorField from the arguments. Otherwise use default values.
         */
        const storageConfiguration = {
            indexName: indexName,
            vectorStore: this.vectorStore,
            vectorStoreType: this.vectorStoreType,
            vectorField: this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore
                ? this.vectorStore.vectorField
                : vectorField,
            textField: this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
                this.vectorStore instanceof pinecone_1.PineconeVectorStore
                ? this.vectorStore.textField
                : textField,
            metadataField: this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
                this.vectorStore instanceof pinecone_1.PineconeVectorStore
                ? this.vectorStore.metadataField
                : metadataField,
        };
        const knowledgeBase = new aws_cdk_lib_1.aws_bedrock.CfnKnowledgeBase(this, 'MyCfnKnowledgeBase', {
            knowledgeBaseConfiguration: {
                type: 'VECTOR',
                vectorKnowledgeBaseConfiguration: {
                    embeddingModelArn: embeddingsModel.asArn(this),
                    // Used this approach as if property is specified on models that do not
                    // support configurable dimensions CloudFormation throws an error at runtime
                    embeddingModelConfiguration: (embeddingsModel.modelId === 'amazon.titan-embed-text-v2:0')
                        ? ({ bedrockEmbeddingModelConfiguration: { dimensions: embeddingsModel.vectorDimensions } })
                        : undefined,
                },
            },
            name: this.name,
            roleArn: this.role.roleArn,
            storageConfiguration: getStorageConfiguration(storageConfiguration),
            description: props.description,
            tags: props.tags,
        });
        this.knowledgeBaseInstance = knowledgeBase;
        const kbCRPolicy = new iam.Policy(this, 'KBCRPolicy', {
            // roles: [crProvider.role],
            roles: [this.role],
            statements: [
                new iam.PolicyStatement({
                    actions: [
                        'bedrock:CreateKnowledgeBase',
                        /**
                         * We need to add `bedrock:AssociateThirdPartyKnowledgeBase` if
                         * we are deploying Redis or Pinecone data sources
                         */
                        //...(this.vectorStoreType === VectorStoreType.REDIS_ENTERPRISE_CLOUD ||
                        ...(this.vectorStoreType === VectorStoreType.PINECONE
                            ? ['bedrock:AssociateThirdPartyKnowledgeBase']
                            : []),
                    ],
                    resources: ['*'],
                }),
                new iam.PolicyStatement({
                    actions: [
                        'bedrock:UpdateKnowledgeBase',
                        'bedrock:DeleteKnowledgeBase',
                        'bedrock:TagResource',
                    ],
                    resources: [
                        cdk.Stack.of(this).formatArn({
                            service: 'bedrock',
                            resource: 'knowledge-base',
                            resourceName: '*',
                            arnFormat: cdk.ArnFormat.SLASH_RESOURCE_NAME,
                        }),
                    ],
                }),
                new iam.PolicyStatement({
                    actions: ['iam:PassRole'],
                    resources: [this.role.roleArn],
                }),
            ],
        });
        knowledgeBase.node.addDependency(this.role);
        knowledgeBase.node.addDependency(kbCRPolicy);
        if (this.vectorStoreType === VectorStoreType.OPENSEARCH_SERVERLESS &&
            this.vectorIndex) {
            knowledgeBase.node.addDependency(this.vectorIndex);
        }
        if (this.vectorStoreType === VectorStoreType.AMAZON_AURORA &&
            this.vectorStore instanceof amazonaurora_1.AmazonAuroraDefaultVectorStore) {
            knowledgeBase.node.addDependency(this.vectorStore);
        }
        nag_suppressions_1.NagSuppressions.addResourceSuppressions(kbCRPolicy, [
            {
                id: 'AwsSolutions-IAM5',
                reason: "Bedrock CreateKnowledgeBase can't be restricted by resource.",
            },
        ], true);
        this.knowledgeBaseArn = knowledgeBase.attrKnowledgeBaseArn;
        this.knowledgeBaseId = knowledgeBase.attrKnowledgeBaseId;
    }
    /**
     * Handle VectorCollection type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of VectorCollection, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleOpenSearchCollection(props) {
        const vectorStore = props.vectorStore;
        vectorStore.grantDataAccess(this.role);
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.OPENSEARCH_SERVERLESS,
        };
    }
    /**
     * Handle PineconeVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of PineconeVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handlePineconeVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.PINECONE,
        };
    }
    /**
     * Handle AmazonAuroraVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of AmazonAuroraVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleAmazonAuroraVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.AMAZON_AURORA,
        };
    }
    /**
     * Handle AmazonAuroraDefaultVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of AmazonAuroraDefaultVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleAmazonAuroraDefaultVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.AMAZON_AURORA,
        };
    }
    /**
     * Handle the default VectorStore type.
     *
     * @returns The instance of VectorCollection, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleOpenSearchDefaultVectorCollection() {
        const vectorStore = new opensearchserverless_1.VectorCollection(this, 'KBVectors');
        vectorStore.grantDataAccess(this.role);
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.OPENSEARCH_SERVERLESS,
        };
    }
    /**
     * Associate knowledge base with an agent
     */
    associateToAgent(agent) {
        const agentKnowledgeBaseProperty = {
            description: this.description,
            knowledgeBaseId: this.knowledgeBaseId,
            knowledgeBaseState: this.knowledgeBaseState,
        };
        agent.knowledgeBases = [agentKnowledgeBaseProperty];
    }
}
exports.KnowledgeBase = KnowledgeBase;
_a = JSII_RTTI_SYMBOL_1;
KnowledgeBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.KnowledgeBase", version: "0.1.264" };
/**
 * Validate that Bedrock Knowledge Base can use the selected model.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateModel(foundationModel) {
    if (!foundationModel.supportsKnowledgeBase) {
        throw new Error(`The model ${foundationModel} is not supported by Bedrock Knowledge Base.`);
    }
}
/**
 * Validate if VectorIndex was provided for a VectorStore of type
 * other than `VectorCollection`.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateVectorIndex(vectorStore, vectorIndex, vectorField, indexName) {
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && vectorIndex) {
        throw new Error('If vectorStore is not of type VectorCollection, vectorIndex should not be provided ' +
            'in KnowledgeBase construct.');
    }
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && indexName) {
        throw new Error('If vectorStore is not of type VectorCollection, indexName should not be provided ' +
            'in KnowledgeBase construct.');
    }
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && vectorField) {
        throw new Error('If vectorStore is not of type VectorCollection, vectorField should not be provided ' +
            'in KnowledgeBase construct.');
    }
}
/**
 * Validate that indexName and vectorField parameters are identical
 * in KnowledgeBase construct if VectorIndex was created manually.
 *
 * By default we assign `vectorIndex` to `bedrock-knowledge-base-default-index`
 * value and if user provides `vectorIndex` manually, we need to make sure
 * they also provide it in KnowledgeBase construct if the value is not
 * `bedrock-knowledge-base-default-index`. Same for vectorField.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateIndexParameters(vectorIndex, indexName, vectorField) {
    if (vectorIndex.indexName !== 'bedrock-knowledge-base-default-index') {
        if (vectorIndex.indexName !== indexName) {
            throw new Error('Default value of indexName is `bedrock-knowledge-base-default-index`.' +
                ' If you create VectorIndex manually and assign vectorIndex to value other than' +
                ' `bedrock-knowledge-base-default-index` then you must provide the same value in KnowledgeBase construct.' +
                ' If you created VectorIndex manually and set it to `bedrock-knowledge-base-default-index`' +
                ' then do not assign indexName in KnowledgeBase construct.');
        }
    }
    if (vectorIndex.vectorField !== 'bedrock-knowledge-base-default-vector') {
        if (vectorIndex.vectorField !== vectorField) {
            throw new Error('Default value of vectorField is `bedrock-knowledge-base-default-vector`.' +
                ' If you create VectorIndex manually and assign vectorField to value other than' +
                ' `bedrock-knowledge-base-default-field` then you must provide the same value in KnowledgeBase construct.' +
                ' If you created VectorIndex manually and set it to `bedrock-knowledge-base-default-vector`' +
                ' then do not assign vectorField in KnowledgeBase construct.');
        }
    }
}
/**
 * Determine storage configuration based on vector store type.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function getStorageConfiguration(params) {
    switch (params.vectorStoreType) {
        case VectorStoreType.OPENSEARCH_SERVERLESS:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.OPENSEARCH_SERVERLESS,
                opensearchServerlessConfiguration: {
                    collectionArn: params.vectorStore.collectionArn,
                    fieldMapping: {
                        vectorField: params.vectorField,
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                    vectorIndexName: params.indexName,
                },
            };
        case VectorStoreType.PINECONE:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.PINECONE,
                pineconeConfiguration: {
                    namespace: params.vectorStore.namespace || undefined,
                    connectionString: params.vectorStore.connectionString,
                    credentialsSecretArn: params.vectorStore.credentialsSecretArn,
                    fieldMapping: {
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                },
            };
        case VectorStoreType.AMAZON_AURORA:
            params.vectorStore =
                params.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore
                    ? params.vectorStore
                    : params.vectorStore;
            return {
                type: VectorStoreType.AMAZON_AURORA,
                rdsConfiguration: {
                    credentialsSecretArn: params.vectorStore.credentialsSecretArn,
                    databaseName: params.vectorStore.databaseName,
                    resourceArn: params.vectorStore.resourceArn,
                    tableName: params.vectorStore.tableName,
                    fieldMapping: {
                        vectorField: params.vectorField.replace(/-/g, '_'),
                        primaryKeyField: params.vectorStore.primaryKeyField,
                        textField: params.textField.toLowerCase(),
                        metadataField: params.metadataField.toLowerCase(),
                    },
                },
            };
        default:
            throw new Error(`Unsupported vector store type: ${params.vectorStoreType}`);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia25vd2xlZGdlLWJhc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY2RrLWxpYi9iZWRyb2NrL2tub3dsZWRnZS1iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFFSCxtQ0FBbUM7QUFDbkMsNkNBQXFEO0FBQ3JELDJDQUEyQztBQUMzQyxtRUFBK0Q7QUFDL0QsMkNBQXVDO0FBR3ZDLHNEQUFvRTtBQUNwRSxrREFHeUI7QUFFekIsc0VBQXdEO0FBQ3hELGtFQUEyRDtBQUMzRCwwQ0FBa0Q7QUFFbEQ7Ozs7Ozs7O0dBUUc7QUFDSCxJQUFLLGVBYUo7QUFiRCxXQUFLLGVBQWU7SUFDbEI7O09BRUc7SUFDSCxrRUFBK0MsQ0FBQTtJQUMvQzs7T0FFRztJQUNILHdDQUFxQixDQUFBO0lBQ3JCOztPQUVHO0lBQ0gsd0NBQXFCLENBQUE7QUFDdkIsQ0FBQyxFQWJJLGVBQWUsS0FBZixlQUFlLFFBYW5CO0FBMElEOzs7O0dBSUc7QUFDSCxNQUFhLGFBQWMsU0FBUSxzQkFBUztJQTZEMUMsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUF5QjtRQUNqRSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDLFdBQVcsQ0FBQztRQUNyQyxNQUFNLGVBQWUsR0FBRyxLQUFLLENBQUMsZUFBZSxDQUFDO1FBQzlDLE1BQU0sU0FBUyxHQUFHLEtBQUssQ0FBQyxTQUFTLElBQUksc0NBQXNDLENBQUM7UUFDNUUsTUFBTSxXQUFXLEdBQ2YsS0FBSyxDQUFDLFdBQVcsSUFBSSx1Q0FBdUMsQ0FBQztRQUMvRCxNQUFNLFNBQVMsR0FBRywyQkFBMkIsQ0FBQztRQUM5QyxNQUFNLGFBQWEsR0FBRyx5QkFBeUIsQ0FBQztRQUVoRCxJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQyxXQUFXLElBQUksNkJBQTZCLENB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Q0FBQyxhQUFhLENBQUMsV0FBVyxFQUFFO3FCQUNsRDtpQkFDRjthQUNGLENBQUM7UUFDSjtZQUNFLE1BQU0sSUFBSSxLQUFLLENBQ2Isa0NBQWtDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsQ0FDM0QsQ0FBQztJQUNOLENBQUM7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiAgQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqICB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogIG9yIGluIHRoZSAnbGljZW5zZScgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWQgb24gYW4gJ0FTIElTJyBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTXG4gKiAgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcbiAqICBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7IGF3c19iZWRyb2NrIGFzIGJlZHJvY2sgfSBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgeyBOYWdTdXBwcmVzc2lvbnMgfSBmcm9tICdjZGstbmFnL2xpYi9uYWctc3VwcHJlc3Npb25zJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgQWdlbnQgfSBmcm9tICcuLy4uL2JlZHJvY2svYWdlbnQnO1xuaW1wb3J0IHsgQmVkcm9ja0ZvdW5kYXRpb25Nb2RlbCB9IGZyb20gJy4vbW9kZWxzJztcbmltcG9ydCB7IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIgfSBmcm9tICcuLi8uLi9jb21tb24vaGVscGVycy91dGlscyc7XG5pbXBvcnQge1xuICBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmUsXG4gIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlLFxufSBmcm9tICcuLi9hbWF6b25hdXJvcmEnO1xuXG5pbXBvcnQgeyBWZWN0b3JJbmRleCB9IGZyb20gJy4uL29wZW5zZWFyY2gtdmVjdG9yaW5kZXgnO1xuaW1wb3J0IHsgVmVjdG9yQ29sbGVjdGlvbiB9IGZyb20gJy4uL29wZW5zZWFyY2hzZXJ2ZXJsZXNzJztcbmltcG9ydCB7IFBpbmVjb25lVmVjdG9yU3RvcmUgfSBmcm9tICcuLi9waW5lY29uZSc7XG5cbi8qKlxuICogS25vd2xlZGdlIGJhc2UgY2FuIGJlIGJhY2tlZCBieSBkaWZmZXJlbnQgdmVjdG9yIGRhdGFiYXNlcy5cbiAqIFRoaXMgZW51bSByZXByZXNlbnRzIHRoZSBkaWZmZXJlbnQgdmVjdG9yIGRhdGFiYXNlcyB0aGF0IGNhbiBiZSB1c2VkLlxuICpcbiAqIGBPUEVOU0VBUkNIX1NFUlZFUkxFU1NgIGlzIHRoZSBkZWZhdWx0IHZlY3RvciBkYXRhYmFzZS5cbiAqIGBSRURJU19FTlRFUlBSSVNFX0NMT1VEYCBpcyB0aGUgdmVjdG9yIGRhdGFiYXNlIGZvciBSZWRpcyBFbnRlcnByaXNlIENsb3VkLlxuICogYFBJTkVDT05FYCBpcyB0aGUgdmVjdG9yIGRhdGFiYXNlIGZvciBQaW5lY29uZS5cbiAqIGBBTUFaT05fQVVST1JBYCBpcyB0aGUgdmVjdG9yIGRhdGFiYXNlIGZvciBBbWF6b24gQXVyb3JhIFBvc3RncmVTUUwuXG4gKi9cbmVudW0gVmVjdG9yU3RvcmVUeXBlIHtcbiAgLyoqXG4gICAqIGBPUEVOU0VBUkNIX1NFUlZFUkxFU1NgIGlzIHRoZSB2ZWN0b3Igc3RvcmUgZm9yIE9wZW5TZWFyY2ggU2VydmVybGVzcy5cbiAgICovXG4gIE9QRU5TRUFSQ0hfU0VSVkVSTEVTUyA9ICdPUEVOU0VBUkNIX1NFUlZFUkxFU1MnLFxuICAvKipcbiAgICogYFBJTkVDT05FYCBpcyB0aGUgdmVjdG9yIHN0b3JlIGZvciBQaW5lY29uZS5cbiAgICovXG4gIFBJTkVDT05FID0gJ1BJTkVDT05FJyxcbiAgLyoqXG4gICAqIGBSRFNgIGlzIHRoZSB2ZWN0b3Igc3RvcmUgZm9yIEFtYXpvbiBBdXJvcmEuXG4gICAqL1xuICBBTUFaT05fQVVST1JBID0gJ1JEUycsXG59XG5cbi8qKlxuICogSW50ZXJmYWNlIGZvciB0aGUgY29uZmlndXJhdGlvbiBvZiB0aGUgc3RvcmFnZSBmb3Iga25vd2xlZGdlIGJhc2UuXG4gKi9cbmludGVyZmFjZSBTdG9yYWdlQ29uZmlndXJhdGlvbiB7XG4gIC8qKlxuICAgKiBUaGUgdmVjdG9yIHN0b3JlLCB3aGljaCBjYW4gYmUgb2YgYFZlY3RvckNvbGxlY3Rpb25gLCBgUGluZWNvbmVWZWN0b3JTdG9yZWAsXG4gICAqIGBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZWAgb3IgYEFtYXpvbkF1cm9yYURlZmF1bHRWZWN0b3JTdG9yZWBcbiAgICogdHlwZXMuXG4gICAqL1xuICB2ZWN0b3JTdG9yZTpcbiAgfCBWZWN0b3JDb2xsZWN0aW9uXG4gIHwgUGluZWNvbmVWZWN0b3JTdG9yZVxuICB8IEFtYXpvbkF1cm9yYURlZmF1bHRWZWN0b3JTdG9yZVxuICB8IEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlO1xuXG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiB0aGUgdmVjdG9yIHN0b3JlLlxuICAgKi9cbiAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBpbmRleC5cbiAgICovXG4gIGluZGV4TmFtZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZmllbGQgb2YgdGhlIHZlY3RvciBmaWVsZCBmb3IgdmVjdG9yIG1hcHBpbmcuXG4gICAqL1xuICB2ZWN0b3JGaWVsZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZmllbGQgb2YgdGhlIHRleHQgZmllbGQgZm9yIHZlY3RvciBtYXBwaW5nLlxuICAgKi9cbiAgdGV4dEZpZWxkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBmaWVsZCBvZiB0aGUgbWV0YWRhdGEuXG4gICAqL1xuICBtZXRhZGF0YUZpZWxkOiBzdHJpbmc7XG59XG5cbi8qKlxuICogUHJvcGVydGllcyBmb3IgYSBrbm93bGVkZ2UgYmFzZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIEtub3dsZWRnZUJhc2VQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgZW1iZWRkaW5ncyBtb2RlbCBmb3IgdGhlIGtub3dsZWRnZSBiYXNlXG4gICAqL1xuICByZWFkb25seSBlbWJlZGRpbmdzTW9kZWw6IEJlZHJvY2tGb3VuZGF0aW9uTW9kZWw7XG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIHJlYWRvbmx5IG5hbWU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBkZXNjcmlwdGlvbiBvZiB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gZGVzY3JpcHRpb24gcHJvdmlkZWQuXG4gICAqL1xuICByZWFkb25seSBkZXNjcmlwdGlvbj86IHN0cmluZztcblxuICAvKipcbiAgICogRXhpc3RpbmcgSUFNIHJvbGUgd2l0aCBhIHBvbGljeSBzdGF0ZW1lbnRcbiAgICogZ3JhbnRpbmcgcGVybWlzc2lvbiB0byBpbnZva2UgdGhlIHNwZWNpZmljIGVtYmVkZGluZ3MgbW9kZWwuXG4gICAqIEFueSBlbnRpdHkgKGUuZy4sIGFuIEFXUyBzZXJ2aWNlIG9yIGFwcGxpY2F0aW9uKSB0aGF0IGFzc3VtZXNcbiAgICogdGhpcyByb2xlIHdpbGwgYmUgYWJsZSB0byBpbnZva2Ugb3IgdXNlIHRoZVxuICAgKiBzcGVjaWZpZWQgZW1iZWRkaW5ncyBtb2RlbCB3aXRoaW4gdGhlIEJlZHJvY2sgc2VydmljZS5cbiAgICovXG4gIHJlYWRvbmx5IGV4aXN0aW5nUm9sZT86IGlhbS5Sb2xlO1xuXG4gIC8qKlxuICAgKiBBIG5hcnJhdGl2ZSBkZXNjcmlwdGlvbiBvZiB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqXG4gICAqIEEgQmVkcm9jayBBZ2VudCBjYW4gdXNlIHRoaXMgaW5zdHJ1Y3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGl0IHNob3VsZFxuICAgKiBxdWVyeSB0aGlzIEtub3dsZWRnZSBCYXNlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIE5vIGRlc2NyaXB0aW9uIHByb3ZpZGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgaW5zdHJ1Y3Rpb24/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSB2ZWN0b3IgaW5kZXguXG4gICAqIElmIHZlY3RvclN0b3JlIGlzIG5vdCBvZiB0eXBlIGBWZWN0b3JDb2xsZWN0aW9uYCxcbiAgICogZG8gbm90IGluY2x1ZGUgdGhpcyBwcm9wZXJ0eSBhcyBpdCB3aWxsIHRocm93IGVycm9yLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtICdiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtaW5kZXgnXG4gICAqL1xuICByZWFkb25seSBpbmRleE5hbWU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBmaWVsZCBpbiB0aGUgdmVjdG9yIGluZGV4LlxuICAgKiBJZiB2ZWN0b3JTdG9yZSBpcyBub3Qgb2YgdHlwZSBgVmVjdG9yQ29sbGVjdGlvbmAsXG4gICAqIGRvIG5vdCBpbmNsdWRlIHRoaXMgcHJvcGVydHkgYXMgaXQgd2lsbCB0aHJvdyBlcnJvci5cbiAgICpcbiAgICogQGRlZmF1bHQgLSAnYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LXZlY3RvcidcbiAgICovXG4gIHJlYWRvbmx5IHZlY3RvckZpZWxkPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgdmVjdG9yIHN0b3JlIGZvciB0aGUga25vd2xlZGdlIGJhc2UuIE11c3QgYmUgZWl0aGVyIG9mXG4gICAqIHR5cGUgYFZlY3RvckNvbGxlY3Rpb25gLCBgUmVkaXNFbnRlcnByaXNlVmVjdG9yU3RvcmVgLFxuICAgKiBgUGluZWNvbmVWZWN0b3JTdG9yZWAsIGBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZWAgb3JcbiAgICogYEFtYXpvbkF1cm9yYURlZmF1bHRWZWN0b3JTdG9yZWAuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQSBuZXcgT3BlblNlYXJjaCBTZXJ2ZXJsZXNzIHZlY3RvciBjb2xsZWN0aW9uIGlzIGNyZWF0ZWQuXG4gICAqL1xuICByZWFkb25seSB2ZWN0b3JTdG9yZT86XG4gIHwgVmVjdG9yQ29sbGVjdGlvblxuICB8IFBpbmVjb25lVmVjdG9yU3RvcmVcbiAgfCBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVxuICB8IEFtYXpvbkF1cm9yYURlZmF1bHRWZWN0b3JTdG9yZTtcblxuICAvKipcbiAgICogVGhlIHZlY3RvciBpbmRleCBmb3IgdGhlIE9wZW5TZWFyY2ggU2VydmVybGVzcyBiYWNrZWQga25vd2xlZGdlIGJhc2UuXG4gICAqIElmIHZlY3RvclN0b3JlIGlzIG5vdCBvZiB0eXBlIGBWZWN0b3JDb2xsZWN0aW9uYCwgZG8gbm90IGluY2x1ZGVcbiAgICogdGhpcyBwcm9wZXJ0eSBhcyBpdCB3aWxsIHRocm93IGVycm9yLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIEEgbmV3IHZlY3RvciBpbmRleCBpcyBjcmVhdGVkIG9uIHRoZSBWZWN0b3IgQ29sbGVjdGlvblxuICAgKiBpZiB2ZWN0b3Igc3RvcmUgaXMgb2YgYFZlY3RvckNvbGxlY3Rpb25gIHR5cGUuXG4gICAqL1xuICByZWFkb25seSB2ZWN0b3JJbmRleD86IFZlY3RvckluZGV4O1xuXG4gIC8qKlxuICAgKiBTcGVjaWZpZXMgd2hldGhlciB0byB1c2UgdGhlIGtub3dsZWRnZSBiYXNlIG9yIG5vdCB3aGVuIHNlbmRpbmcgYW4gSW52b2tlQWdlbnQgcmVxdWVzdC5cbiAgICovXG4gIHJlYWRvbmx5IGtub3dsZWRnZUJhc2VTdGF0ZT86IHN0cmluZztcblxuICAvKipcbiAgICogT1BUSU9OQUw6IFRhZyAoS0VZLVZBTFVFKSBiZWRyb2NrIGFnZW50IHJlc291cmNlXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZmFsc2VcbiAgICovXG4gIHJlYWRvbmx5IHRhZ3M/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xufVxuXG4vKipcbiAqIERlcGxveXMgYSBCZWRyb2NrIEtub3dsZWRnZSBCYXNlIGFuZCBjb25maWd1cmVzIGEgYmFja2VuZCBieSBPcGVuU2VhcmNoIFNlcnZlcmxlc3MsXG4gKiBQaW5lY29uZSwgUmVkaXMgRW50ZXJwcmlzZSBDbG91ZCBvciBBbWF6b24gQXVyb3JhIFBvc3RncmVTUUwuXG4gKlxuICovXG5leHBvcnQgY2xhc3MgS25vd2xlZGdlQmFzZSBleHRlbmRzIENvbnN0cnVjdCB7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgbmFtZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBJbnN0YW5jZSBvZiBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBrbm93bGVkZ2VCYXNlSW5zdGFuY2U6IGJlZHJvY2suQ2ZuS25vd2xlZGdlQmFzZTtcblxuICAvKipcbiAgICogVGhlIHJvbGUgdGhlIEtub3dsZWRnZSBCYXNlIHVzZXMgdG8gYWNjZXNzIHRoZSB2ZWN0b3Igc3RvcmUgYW5kIGRhdGEgc291cmNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHJvbGU6IGlhbS5Sb2xlO1xuXG4gIC8qKlxuICAgKiBUaGUgdmVjdG9yIHN0b3JlIGZvciB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdmVjdG9yU3RvcmU6XG4gIHwgVmVjdG9yQ29sbGVjdGlvblxuICB8IFBpbmVjb25lVmVjdG9yU3RvcmVcbiAgfCBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVxuICB8IEFtYXpvbkF1cm9yYURlZmF1bHRWZWN0b3JTdG9yZTtcblxuICAvKipcbiAgICogQSBuYXJyYXRpdmUgaW5zdHJ1Y3Rpb24gb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGluc3RydWN0aW9uPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBrbm93bGVkZ2VCYXNlQXJuOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBJRCBvZiB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkga25vd2xlZGdlQmFzZUlkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgT3BlblNlYXJjaCB2ZWN0b3IgaW5kZXggZm9yIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByaXZhdGUgdmVjdG9ySW5kZXg/OiBWZWN0b3JJbmRleDtcblxuICAvKipcbiAgICogVGhlIGRlc2NyaXB0aW9uIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGRlc2NyaXB0aW9uOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFNwZWNpZmllcyB3aGV0aGVyIHRvIHVzZSB0aGUga25vd2xlZGdlIGJhc2Ugb3Igbm90IHdoZW4gc2VuZGluZyBhbiBJbnZva2VBZ2VudCByZXF1ZXN0LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGtub3dsZWRnZUJhc2VTdGF0ZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcml2YXRlIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBLbm93bGVkZ2VCYXNlUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuICAgIHRoaXMuaW5zdHJ1Y3Rpb24gPSBwcm9wcy5pbnN0cnVjdGlvbjtcbiAgICBjb25zdCBlbWJlZGRpbmdzTW9kZWwgPSBwcm9wcy5lbWJlZGRpbmdzTW9kZWw7XG4gICAgY29uc3QgaW5kZXhOYW1lID0gcHJvcHMuaW5kZXhOYW1lID8/ICdiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtaW5kZXgnO1xuICAgIGNvbnN0IHZlY3RvckZpZWxkID1cbiAgICAgIHByb3BzLnZlY3RvckZpZWxkID8/ICdiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtdmVjdG9yJztcbiAgICBjb25zdCB0ZXh0RmllbGQgPSAnQU1BWk9OX0JFRFJPQ0tfVEVYVF9DSFVOSyc7XG4gICAgY29uc3QgbWV0YWRhdGFGaWVsZCA9ICdBTUFaT05fQkVEUk9DS19NRVRBREFUQSc7XG5cbiAgICB0aGlzLmRlc2NyaXB0aW9uID0gcHJvcHMuZGVzY3JpcHRpb24gPz8gJ0NESyBkZXBsb3llZCBLbm93bGVkZ2UgYmFzZSc7IC8vIGV2ZW4gdGhvdWdoIHRoaXMgcHJvcCBpcyBvcHRpb25hbCwgaWYgbm8gdmFsdWUgaXMgcHJvdmlkZWQgaXQgd2lsbCBmYWlsIHRvIGRlcGxveVxuICAgIHRoaXMua25vd2xlZGdlQmFzZVN0YXRlID0gcHJvcHMua25vd2xlZGdlQmFzZVN0YXRlID8/ICdFTkFCTEVEJztcblxuICAgIHZhbGlkYXRlTW9kZWwoZW1iZWRkaW5nc01vZGVsKTtcbiAgICB2YWxpZGF0ZVZlY3RvckluZGV4KFxuICAgICAgcHJvcHMudmVjdG9yU3RvcmUsXG4gICAgICBwcm9wcy52ZWN0b3JJbmRleCxcbiAgICAgIHByb3BzLnZlY3RvckZpZWxkLFxuICAgICAgcHJvcHMuaW5kZXhOYW1lLFxuICAgICk7XG4gICAgaWYgKHByb3BzLnZlY3RvckluZGV4KSB7XG4gICAgICB2YWxpZGF0ZUluZGV4UGFyYW1ldGVycyhwcm9wcy52ZWN0b3JJbmRleCwgaW5kZXhOYW1lLCB2ZWN0b3JGaWVsZCk7XG4gICAgfVxuXG4gICAgdGhpcy5uYW1lID1cbiAgICAgIHByb3BzLm5hbWUgPz8gZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMih0aGlzLCAnS0InLCB7IG1heExlbmd0aDogMzIgfSk7XG5cbiAgICBpZiAocHJvcHMuZXhpc3RpbmdSb2xlKSB7XG4gICAgICB0aGlzLnJvbGUgPSBwcm9wcy5leGlzdGluZ1JvbGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHJvbGVOYW1lID0gZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMihcbiAgICAgICAgdGhpcyxcbiAgICAgICAgJ0FtYXpvbkJlZHJvY2tFeGVjdXRpb25Sb2xlRm9yS25vd2xlZGdlQmFzZScsXG4gICAgICAgIHsgbWF4TGVuZ3RoOiA2NCB9LFxuICAgICAgKTtcbiAgICAgIHRoaXMucm9sZSA9IG5ldyBpYW0uUm9sZSh0aGlzLCAnUm9sZScsIHtcbiAgICAgICAgcm9sZU5hbWU6IHJvbGVOYW1lLFxuICAgICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uU2VydmljZVByaW5jaXBhbCgnYmVkcm9jay5hbWF6b25hd3MuY29tJyksXG4gICAgICB9KTtcbiAgICAgIHRoaXMucm9sZS5hc3N1bWVSb2xlUG9saWN5IS5hZGRTdGF0ZW1lbnRzKFxuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogWydzdHM6QXNzdW1lUm9sZSddLFxuICAgICAgICAgIHByaW5jaXBhbHM6IFtuZXcgaWFtLlNlcnZpY2VQcmluY2lwYWwoJ2JlZHJvY2suYW1hem9uYXdzLmNvbScpXSxcbiAgICAgICAgICBjb25kaXRpb25zOiB7XG4gICAgICAgICAgICBTdHJpbmdFcXVhbHM6IHtcbiAgICAgICAgICAgICAgJ2F3czpTb3VyY2VBY2NvdW50JzogY2RrLlN0YWNrLm9mKHRoaXMpLmFjY291bnQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgQXJuTGlrZToge1xuICAgICAgICAgICAgICAnYXdzOlNvdXJjZUFybic6IGNkay5TdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgICAgICAgICAgIHNlcnZpY2U6ICdiZWRyb2NrJyxcbiAgICAgICAgICAgICAgICByZXNvdXJjZTogJ2tub3dsZWRnZS1iYXNlJyxcbiAgICAgICAgICAgICAgICByZXNvdXJjZU5hbWU6ICcqJyxcbiAgICAgICAgICAgICAgICBhcm5Gb3JtYXQ6IGNkay5Bcm5Gb3JtYXQuU0xBU0hfUkVTT1VSQ0VfTkFNRSxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgKTtcblxuICAgICAgdGhpcy5yb2xlLmFkZFRvUG9saWN5KFxuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogWydiZWRyb2NrOkludm9rZU1vZGVsJ10sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbZW1iZWRkaW5nc01vZGVsLmFzQXJuKHRoaXMpXSxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgdGhlIHZlY3RvciBzdG9yZSBpZiB0aGUgdmVjdG9yIHN0b3JlIHdhcyBwcm92aWRlZCBieSB0aGUgdXNlci5cbiAgICAgKiBPdGhlcndpc2UgY2hlY2sgYWdhaW50cyBhbGwgcG9zc2libGUgdmVjdG9yIGRhdGFzdG9yZXMuXG4gICAgICogSWYgbm9uZSB3YXMgcHJvdmlkZWQgY3JlYXRlIGRlZmF1bHQgT3BlblNlYXJjaCBTZXJ2ZXJsZXNzIENvbGxlY3Rpb24uXG4gICAgICovXG4gICAgaWYgKHByb3BzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgVmVjdG9yQ29sbGVjdGlvbikge1xuICAgICAgKHtcbiAgICAgICAgdmVjdG9yU3RvcmU6IHRoaXMudmVjdG9yU3RvcmUsXG4gICAgICAgIHZlY3RvclN0b3JlVHlwZTogdGhpcy52ZWN0b3JTdG9yZVR5cGUsXG4gICAgICB9ID0gdGhpcy5oYW5kbGVPcGVuU2VhcmNoQ29sbGVjdGlvbihwcm9wcykpO1xuICAgIH0gZWxzZSBpZiAocHJvcHMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBQaW5lY29uZVZlY3RvclN0b3JlKSB7XG4gICAgICAoe1xuICAgICAgICB2ZWN0b3JTdG9yZTogdGhpcy52ZWN0b3JTdG9yZSxcbiAgICAgICAgdmVjdG9yU3RvcmVUeXBlOiB0aGlzLnZlY3RvclN0b3JlVHlwZSxcbiAgICAgIH0gPSB0aGlzLmhhbmRsZVBpbmVjb25lVmVjdG9yU3RvcmUocHJvcHMpKTtcbiAgICB9IGVsc2UgaWYgKHByb3BzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUpIHtcbiAgICAgICh7XG4gICAgICAgIHZlY3RvclN0b3JlOiB0aGlzLnZlY3RvclN0b3JlLFxuICAgICAgICB2ZWN0b3JTdG9yZVR5cGU6IHRoaXMudmVjdG9yU3RvcmVUeXBlLFxuICAgICAgfSA9IHRoaXMuaGFuZGxlQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUocHJvcHMpKTtcbiAgICB9IGVsc2UgaWYgKHByb3BzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhRGVmYXVsdFZlY3RvclN0b3JlKSB7XG4gICAgICAoe1xuICAgICAgICB2ZWN0b3JTdG9yZTogdGhpcy52ZWN0b3JTdG9yZSxcbiAgICAgICAgdmVjdG9yU3RvcmVUeXBlOiB0aGlzLnZlY3RvclN0b3JlVHlwZSxcbiAgICAgIH0gPSB0aGlzLmhhbmRsZUFtYXpvbkF1cm9yYURlZmF1bHRWZWN0b3JTdG9yZShwcm9wcykpO1xuICAgIH0gZWxzZSB7XG4gICAgICAoe1xuICAgICAgICB2ZWN0b3JTdG9yZTogdGhpcy52ZWN0b3JTdG9yZSxcbiAgICAgICAgdmVjdG9yU3RvcmVUeXBlOiB0aGlzLnZlY3RvclN0b3JlVHlwZSxcbiAgICAgIH0gPSB0aGlzLmhhbmRsZU9wZW5TZWFyY2hEZWZhdWx0VmVjdG9yQ29sbGVjdGlvbigpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBXZSBuZWVkIHRvIGFkZCBgc2VjcmV0c21hbmFnZXI6R2V0U2VjcmV0VmFsdWVgIHRvIHRoZSByb2xlXG4gICAgICogb2YgdGhlIGtub3dsZWRnZSBiYXNlIGlmIHdlIHVzZSBkYXRhIHNvdXJjZXNcbiAgICAgKiBvdGhlciB0aGFuIE9wZW5TZWFyY2ggU2VydmVybGVzcy5cbiAgICAgKi9cbiAgICBpZiAoISh0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgVmVjdG9yQ29sbGVjdGlvbikpIHtcbiAgICAgIHRoaXMucm9sZS5hZGRUb1BvbGljeShcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFsnc2VjcmV0c21hbmFnZXI6R2V0U2VjcmV0VmFsdWUnXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFt0aGlzLnZlY3RvclN0b3JlLmNyZWRlbnRpYWxzU2VjcmV0QXJuXSxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFdlIG5lZWQgdG8gYWRkIGByZHMtZGF0YTpFeGVjdXRlU3RhdGVtZW50YCxcbiAgICAgKiBgcmRzLWRhdGE6QmF0Y2hFeGVjdXRlU3RhdGVtZW50YCBhbmRcbiAgICAgKiBgcmRzOkRlc2NyaWJlREJDbHVzdGVyc2AgdG8gdGhlIHJvbGVcbiAgICAgKiBvZiB0aGUga25vd2xlZGdlIGJhc2UgaWYgd2UgdXNlIEFtYXpvbiBBdXJvcmEgYXNcbiAgICAgKiBhIGRhdGEgc291cmNlLlxuICAgICAqL1xuICAgIGlmIChcbiAgICAgIHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmUgfHxcbiAgICAgIHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVxuICAgICkge1xuICAgICAgdGhpcy5yb2xlLmFkZFRvUG9saWN5KFxuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAgJ3Jkcy1kYXRhOkV4ZWN1dGVTdGF0ZW1lbnQnLFxuICAgICAgICAgICAgJ3Jkcy1kYXRhOkJhdGNoRXhlY3V0ZVN0YXRlbWVudCcsXG4gICAgICAgICAgICAncmRzOkRlc2NyaWJlREJDbHVzdGVycycsXG4gICAgICAgICAgXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFt0aGlzLnZlY3RvclN0b3JlLnJlc291cmNlQXJuXSxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSB0aGUgdmVjdG9yIGluZGV4IGlmIHRoZSB2ZWN0b3Igc3RvcmUgaXMgT3BlblNlYXJjaCBTZXJ2ZXJsZXNzXG4gICAgICogYW5kIGl0IHdhcyBub3QgcHJvdmlkZWQuIE90aGVyd2lzZSB1c2UgdGhlIHByb3ZpZGVkIHZlY3RvciBpbmRleC5cbiAgICAgKi9cbiAgICBpZiAodGhpcy52ZWN0b3JTdG9yZVR5cGUgPT09IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1MpIHtcbiAgICAgIGlmICghcHJvcHMudmVjdG9ySW5kZXgpIHtcbiAgICAgICAgdGhpcy52ZWN0b3JJbmRleCA9IG5ldyBWZWN0b3JJbmRleCh0aGlzLCAnS0JJbmRleCcsIHtcbiAgICAgICAgICBjb2xsZWN0aW9uOiB0aGlzLnZlY3RvclN0b3JlIGFzIFZlY3RvckNvbGxlY3Rpb24sXG4gICAgICAgICAgaW5kZXhOYW1lLFxuICAgICAgICAgIHZlY3RvckZpZWxkLFxuICAgICAgICAgIHZlY3RvckRpbWVuc2lvbnM6IGVtYmVkZGluZ3NNb2RlbC52ZWN0b3JEaW1lbnNpb25zISxcbiAgICAgICAgICBtYXBwaW5nczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBtYXBwaW5nRmllbGQ6ICdBTUFaT05fQkVEUk9DS19URVhUX0NIVU5LJyxcbiAgICAgICAgICAgICAgZGF0YVR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgICAgZmlsdGVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG1hcHBpbmdGaWVsZDogJ0FNQVpPTl9CRURST0NLX01FVEFEQVRBJyxcbiAgICAgICAgICAgICAgZGF0YVR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgICAgZmlsdGVyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMudmVjdG9ySW5kZXgubm9kZS5hZGREZXBlbmRlbmN5KHRoaXMudmVjdG9yU3RvcmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy52ZWN0b3JJbmRleCA9IHByb3BzLnZlY3RvckluZGV4O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBzdG9yYWdlIGNvbmZpZ3VyYWlvbi4gSWYgaXQgaXMgb2YgdHlwZSBvZlxuICAgICAqIGBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZWAgZ2V0IHRleHRGaWVsZCwgbWV0YWRhdGFGaWVsZCxcbiAgICAgKiB2ZWN0b3JGaWVsZCBmcm9tIHRoZSBhcmd1bWVudHMuIE90aGVyd2lzZSB1c2UgZGVmYXVsdCB2YWx1ZXMuXG4gICAgICovXG4gICAgY29uc3Qgc3RvcmFnZUNvbmZpZ3VyYXRpb246IFN0b3JhZ2VDb25maWd1cmF0aW9uID0ge1xuICAgICAgaW5kZXhOYW1lOiBpbmRleE5hbWUsXG4gICAgICB2ZWN0b3JTdG9yZTogdGhpcy52ZWN0b3JTdG9yZSxcbiAgICAgIHZlY3RvclN0b3JlVHlwZTogdGhpcy52ZWN0b3JTdG9yZVR5cGUsXG4gICAgICB2ZWN0b3JGaWVsZDpcbiAgICAgICAgdGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlXG4gICAgICAgICAgPyB0aGlzLnZlY3RvclN0b3JlLnZlY3RvckZpZWxkXG4gICAgICAgICAgOiB2ZWN0b3JGaWVsZCxcbiAgICAgIHRleHRGaWVsZDpcbiAgICAgICAgdGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlIHx8XG4gICAgICAgICAgdGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIFBpbmVjb25lVmVjdG9yU3RvcmVcbiAgICAgICAgICA/IHRoaXMudmVjdG9yU3RvcmUudGV4dEZpZWxkXG4gICAgICAgICAgOiB0ZXh0RmllbGQsXG4gICAgICBtZXRhZGF0YUZpZWxkOlxuICAgICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgfHxcbiAgICAgICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgUGluZWNvbmVWZWN0b3JTdG9yZVxuICAgICAgICAgID8gdGhpcy52ZWN0b3JTdG9yZS5tZXRhZGF0YUZpZWxkXG4gICAgICAgICAgOiBtZXRhZGF0YUZpZWxkLFxuICAgIH07XG5cbiAgICBjb25zdCBrbm93bGVkZ2VCYXNlID0gbmV3IGJlZHJvY2suQ2ZuS25vd2xlZGdlQmFzZShcbiAgICAgIHRoaXMsXG4gICAgICAnTXlDZm5Lbm93bGVkZ2VCYXNlJyxcbiAgICAgIHtcbiAgICAgICAga25vd2xlZGdlQmFzZUNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICB0eXBlOiAnVkVDVE9SJyxcbiAgICAgICAgICB2ZWN0b3JLbm93bGVkZ2VCYXNlQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgICAgZW1iZWRkaW5nTW9kZWxBcm46IGVtYmVkZGluZ3NNb2RlbC5hc0Fybih0aGlzKSxcbiAgICAgICAgICAgIC8vIFVzZWQgdGhpcyBhcHByb2FjaCBhcyBpZiBwcm9wZXJ0eSBpcyBzcGVjaWZpZWQgb24gbW9kZWxzIHRoYXQgZG8gbm90XG4gICAgICAgICAgICAvLyBzdXBwb3J0IGNvbmZpZ3VyYWJsZSBkaW1lbnNpb25zIENsb3VkRm9ybWF0aW9uIHRocm93cyBhbiBlcnJvciBhdCBydW50aW1lXG4gICAgICAgICAgICBlbWJlZGRpbmdNb2RlbENvbmZpZ3VyYXRpb246IChlbWJlZGRpbmdzTW9kZWwubW9kZWxJZCA9PT0gJ2FtYXpvbi50aXRhbi1lbWJlZC10ZXh0LXYyOjAnKVxuICAgICAgICAgICAgICA/ICh7IGJlZHJvY2tFbWJlZGRpbmdNb2RlbENvbmZpZ3VyYXRpb246IHsgZGltZW5zaW9uczogZW1iZWRkaW5nc01vZGVsLnZlY3RvckRpbWVuc2lvbnMgfSB9KVxuICAgICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICAgIHJvbGVBcm46IHRoaXMucm9sZS5yb2xlQXJuLFxuICAgICAgICBzdG9yYWdlQ29uZmlndXJhdGlvbjogZ2V0U3RvcmFnZUNvbmZpZ3VyYXRpb24oc3RvcmFnZUNvbmZpZ3VyYXRpb24pLFxuICAgICAgICBkZXNjcmlwdGlvbjogcHJvcHMuZGVzY3JpcHRpb24sXG4gICAgICAgIHRhZ3M6IHByb3BzLnRhZ3MsXG4gICAgICB9LFxuICAgICk7XG5cbiAgICB0aGlzLmtub3dsZWRnZUJhc2VJbnN0YW5jZSA9IGtub3dsZWRnZUJhc2U7XG5cbiAgICBjb25zdCBrYkNSUG9saWN5ID0gbmV3IGlhbS5Qb2xpY3kodGhpcywgJ0tCQ1JQb2xpY3knLCB7XG4gICAgICAvLyByb2xlczogW2NyUHJvdmlkZXIucm9sZV0sXG4gICAgICByb2xlczogW3RoaXMucm9sZV0sXG4gICAgICBzdGF0ZW1lbnRzOiBbXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgICAnYmVkcm9jazpDcmVhdGVLbm93bGVkZ2VCYXNlJyxcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogV2UgbmVlZCB0byBhZGQgYGJlZHJvY2s6QXNzb2NpYXRlVGhpcmRQYXJ0eUtub3dsZWRnZUJhc2VgIGlmXG4gICAgICAgICAgICAgKiB3ZSBhcmUgZGVwbG95aW5nIFJlZGlzIG9yIFBpbmVjb25lIGRhdGEgc291cmNlc1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAvLy4uLih0aGlzLnZlY3RvclN0b3JlVHlwZSA9PT0gVmVjdG9yU3RvcmVUeXBlLlJFRElTX0VOVEVSUFJJU0VfQ0xPVUQgfHxcbiAgICAgICAgICAgIC4uLih0aGlzLnZlY3RvclN0b3JlVHlwZSA9PT0gVmVjdG9yU3RvcmVUeXBlLlBJTkVDT05FXG4gICAgICAgICAgICAgID8gWydiZWRyb2NrOkFzc29jaWF0ZVRoaXJkUGFydHlLbm93bGVkZ2VCYXNlJ11cbiAgICAgICAgICAgICAgOiBbXSksXG4gICAgICAgICAgXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFsnKiddLFxuICAgICAgICB9KSxcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICAgICdiZWRyb2NrOlVwZGF0ZUtub3dsZWRnZUJhc2UnLFxuICAgICAgICAgICAgJ2JlZHJvY2s6RGVsZXRlS25vd2xlZGdlQmFzZScsXG4gICAgICAgICAgICAnYmVkcm9jazpUYWdSZXNvdXJjZScsXG4gICAgICAgICAgXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFtcbiAgICAgICAgICAgIGNkay5TdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgICAgICAgICBzZXJ2aWNlOiAnYmVkcm9jaycsXG4gICAgICAgICAgICAgIHJlc291cmNlOiAna25vd2xlZGdlLWJhc2UnLFxuICAgICAgICAgICAgICByZXNvdXJjZU5hbWU6ICcqJyxcbiAgICAgICAgICAgICAgYXJuRm9ybWF0OiBjZGsuQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICBdLFxuICAgICAgICB9KSxcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFsnaWFtOlBhc3NSb2xlJ10sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbdGhpcy5yb2xlLnJvbGVBcm5dLFxuICAgICAgICB9KSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBrbm93bGVkZ2VCYXNlLm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnJvbGUpO1xuICAgIGtub3dsZWRnZUJhc2Uubm9kZS5hZGREZXBlbmRlbmN5KGtiQ1JQb2xpY3kpO1xuICAgIGlmIChcbiAgICAgIHRoaXMudmVjdG9yU3RvcmVUeXBlID09PSBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9TRVJWRVJMRVNTICYmXG4gICAgICB0aGlzLnZlY3RvckluZGV4XG4gICAgKSB7XG4gICAgICBrbm93bGVkZ2VCYXNlLm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnZlY3RvckluZGV4KTtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgdGhpcy52ZWN0b3JTdG9yZVR5cGUgPT09IFZlY3RvclN0b3JlVHlwZS5BTUFaT05fQVVST1JBICYmXG4gICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhRGVmYXVsdFZlY3RvclN0b3JlXG4gICAgKSB7XG4gICAgICBrbm93bGVkZ2VCYXNlLm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnZlY3RvclN0b3JlKTtcbiAgICB9XG5cbiAgICBOYWdTdXBwcmVzc2lvbnMuYWRkUmVzb3VyY2VTdXBwcmVzc2lvbnMoXG4gICAgICBrYkNSUG9saWN5LFxuICAgICAgW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdBd3NTb2x1dGlvbnMtSUFNNScsXG4gICAgICAgICAgcmVhc29uOlxuICAgICAgICAgICAgXCJCZWRyb2NrIENyZWF0ZUtub3dsZWRnZUJhc2UgY2FuJ3QgYmUgcmVzdHJpY3RlZCBieSByZXNvdXJjZS5cIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICB0cnVlLFxuICAgICk7XG5cbiAgICB0aGlzLmtub3dsZWRnZUJhc2VBcm4gPSBrbm93bGVkZ2VCYXNlLmF0dHJLbm93bGVkZ2VCYXNlQXJuO1xuICAgIHRoaXMua25vd2xlZGdlQmFzZUlkID0ga25vd2xlZGdlQmFzZS5hdHRyS25vd2xlZGdlQmFzZUlkO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBWZWN0b3JDb2xsZWN0aW9uIHR5cGUgb2YgVmVjdG9yU3RvcmUuXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wcyAtIFRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBLbm93bGVkZ2VCYXNlLlxuICAgKiBAcmV0dXJucyBUaGUgaW5zdGFuY2Ugb2YgVmVjdG9yQ29sbGVjdGlvbiwgVmVjdG9yU3RvcmVUeXBlLlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgaGFuZGxlT3BlblNlYXJjaENvbGxlY3Rpb24ocHJvcHM6IEtub3dsZWRnZUJhc2VQcm9wcyk6IHtcbiAgICB2ZWN0b3JTdG9yZTogVmVjdG9yQ29sbGVjdGlvbjtcbiAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcbiAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPSBwcm9wcy52ZWN0b3JTdG9yZSBhcyBWZWN0b3JDb2xsZWN0aW9uO1xuICAgIHZlY3RvclN0b3JlLmdyYW50RGF0YUFjY2Vzcyh0aGlzLnJvbGUpO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1MsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgUGluZWNvbmVWZWN0b3JTdG9yZSB0eXBlIG9mIFZlY3RvclN0b3JlLlxuICAgKlxuICAgKiBAcGFyYW0gcHJvcHMgLSBUaGUgcHJvcGVydGllcyBvZiB0aGUgS25vd2xlZGdlQmFzZS5cbiAgICogQHJldHVybnMgVGhlIGluc3RhbmNlIG9mIFBpbmVjb25lVmVjdG9yU3RvcmUsIFZlY3RvclN0b3JlVHlwZS5cbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZVBpbmVjb25lVmVjdG9yU3RvcmUocHJvcHM6IEtub3dsZWRnZUJhc2VQcm9wcyk6IHtcbiAgICB2ZWN0b3JTdG9yZTogUGluZWNvbmVWZWN0b3JTdG9yZTtcbiAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcbiAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPSBwcm9wcy52ZWN0b3JTdG9yZSBhcyBQaW5lY29uZVZlY3RvclN0b3JlO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5QSU5FQ09ORSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB0eXBlIG9mIFZlY3RvclN0b3JlLlxuICAgKlxuICAgKiBAcGFyYW0gcHJvcHMgLSBUaGUgcHJvcGVydGllcyBvZiB0aGUgS25vd2xlZGdlQmFzZS5cbiAgICogQHJldHVybnMgVGhlIGluc3RhbmNlIG9mIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlLCBWZWN0b3JTdG9yZVR5cGUuXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVBbWF6b25BdXJvcmFWZWN0b3JTdG9yZShwcm9wczogS25vd2xlZGdlQmFzZVByb3BzKToge1xuICAgIHZlY3RvclN0b3JlOiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZTtcbiAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcbiAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPSBwcm9wcy52ZWN0b3JTdG9yZSBhcyBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZTtcbiAgICByZXR1cm4ge1xuICAgICAgdmVjdG9yU3RvcmU6IHZlY3RvclN0b3JlLFxuICAgICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGUuQU1BWk9OX0FVUk9SQSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmUgdHlwZSBvZiBWZWN0b3JTdG9yZS5cbiAgICpcbiAgICogQHBhcmFtIHByb3BzIC0gVGhlIHByb3BlcnRpZXMgb2YgdGhlIEtub3dsZWRnZUJhc2UuXG4gICAqIEByZXR1cm5zIFRoZSBpbnN0YW5jZSBvZiBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmUsIFZlY3RvclN0b3JlVHlwZS5cbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZUFtYXpvbkF1cm9yYURlZmF1bHRWZWN0b3JTdG9yZShwcm9wczogS25vd2xlZGdlQmFzZVByb3BzKToge1xuICAgIHZlY3RvclN0b3JlOiBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmU7XG4gICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG4gIH0ge1xuICAgIGNvbnN0IHZlY3RvclN0b3JlID0gcHJvcHMudmVjdG9yU3RvcmUgYXMgQW1hem9uQXVyb3JhRGVmYXVsdFZlY3RvclN0b3JlO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5BTUFaT05fQVVST1JBLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIHRoZSBkZWZhdWx0IFZlY3RvclN0b3JlIHR5cGUuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBpbnN0YW5jZSBvZiBWZWN0b3JDb2xsZWN0aW9uLCBWZWN0b3JTdG9yZVR5cGUuXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVPcGVuU2VhcmNoRGVmYXVsdFZlY3RvckNvbGxlY3Rpb24oKToge1xuICAgIHZlY3RvclN0b3JlOiBWZWN0b3JDb2xsZWN0aW9uO1xuICAgIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xuICB9IHtcbiAgICBjb25zdCB2ZWN0b3JTdG9yZSA9IG5ldyBWZWN0b3JDb2xsZWN0aW9uKHRoaXMsICdLQlZlY3RvcnMnKTtcbiAgICB2ZWN0b3JTdG9yZS5ncmFudERhdGFBY2Nlc3ModGhpcy5yb2xlKTtcbiAgICByZXR1cm4ge1xuICAgICAgdmVjdG9yU3RvcmU6IHZlY3RvclN0b3JlLFxuICAgICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9TRVJWRVJMRVNTLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQXNzb2NpYXRlIGtub3dsZWRnZSBiYXNlIHdpdGggYW4gYWdlbnRcbiAgICovXG4gIHB1YmxpYyBhc3NvY2lhdGVUb0FnZW50KGFnZW50OiBBZ2VudCkge1xuICAgIGNvbnN0IGFnZW50S25vd2xlZGdlQmFzZVByb3BlcnR5OiBiZWRyb2NrLkNmbkFnZW50LkFnZW50S25vd2xlZGdlQmFzZVByb3BlcnR5ID1cbiAgICB7XG4gICAgICBkZXNjcmlwdGlvbjogdGhpcy5kZXNjcmlwdGlvbixcbiAgICAgIGtub3dsZWRnZUJhc2VJZDogdGhpcy5rbm93bGVkZ2VCYXNlSWQsXG4gICAgICBrbm93bGVkZ2VCYXNlU3RhdGU6IHRoaXMua25vd2xlZGdlQmFzZVN0YXRlLFxuICAgIH07XG4gICAgYWdlbnQua25vd2xlZGdlQmFzZXMgPSBbYWdlbnRLbm93bGVkZ2VCYXNlUHJvcGVydHldO1xuICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgdGhhdCBCZWRyb2NrIEtub3dsZWRnZSBCYXNlIGNhbiB1c2UgdGhlIHNlbGVjdGVkIG1vZGVsLlxuICpcbiAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICovXG5mdW5jdGlvbiB2YWxpZGF0ZU1vZGVsKGZvdW5kYXRpb25Nb2RlbDogQmVkcm9ja0ZvdW5kYXRpb25Nb2RlbCkge1xuICBpZiAoIWZvdW5kYXRpb25Nb2RlbC5zdXBwb3J0c0tub3dsZWRnZUJhc2UpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgVGhlIG1vZGVsICR7Zm91bmRhdGlvbk1vZGVsfSBpcyBub3Qgc3VwcG9ydGVkIGJ5IEJlZHJvY2sgS25vd2xlZGdlIEJhc2UuYCxcbiAgICApO1xuICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgaWYgVmVjdG9ySW5kZXggd2FzIHByb3ZpZGVkIGZvciBhIFZlY3RvclN0b3JlIG9mIHR5cGVcbiAqIG90aGVyIHRoYW4gYFZlY3RvckNvbGxlY3Rpb25gLlxuICpcbiAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICovXG5mdW5jdGlvbiB2YWxpZGF0ZVZlY3RvckluZGV4KFxuICB2ZWN0b3JTdG9yZTogYW55LFxuICB2ZWN0b3JJbmRleDogYW55LFxuICB2ZWN0b3JGaWVsZDogYW55LFxuICBpbmRleE5hbWU6IGFueSxcbikge1xuICBpZiAoISh2ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIFZlY3RvckNvbGxlY3Rpb24pICYmIHZlY3RvckluZGV4KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ0lmIHZlY3RvclN0b3JlIGlzIG5vdCBvZiB0eXBlIFZlY3RvckNvbGxlY3Rpb24sIHZlY3RvckluZGV4IHNob3VsZCBub3QgYmUgcHJvdmlkZWQgJyArXG4gICAgICAnaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyxcbiAgICApO1xuICB9XG4gIGlmICghKHZlY3RvclN0b3JlIGluc3RhbmNlb2YgVmVjdG9yQ29sbGVjdGlvbikgJiYgaW5kZXhOYW1lKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ0lmIHZlY3RvclN0b3JlIGlzIG5vdCBvZiB0eXBlIFZlY3RvckNvbGxlY3Rpb24sIGluZGV4TmFtZSBzaG91bGQgbm90IGJlIHByb3ZpZGVkICcgK1xuICAgICAgJ2luIEtub3dsZWRnZUJhc2UgY29uc3RydWN0LicsXG4gICAgKTtcbiAgfVxuICBpZiAoISh2ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIFZlY3RvckNvbGxlY3Rpb24pICYmIHZlY3RvckZpZWxkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ0lmIHZlY3RvclN0b3JlIGlzIG5vdCBvZiB0eXBlIFZlY3RvckNvbGxlY3Rpb24sIHZlY3RvckZpZWxkIHNob3VsZCBub3QgYmUgcHJvdmlkZWQgJyArXG4gICAgICAnaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyxcbiAgICApO1xuICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgdGhhdCBpbmRleE5hbWUgYW5kIHZlY3RvckZpZWxkIHBhcmFtZXRlcnMgYXJlIGlkZW50aWNhbFxuICogaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QgaWYgVmVjdG9ySW5kZXggd2FzIGNyZWF0ZWQgbWFudWFsbHkuXG4gKlxuICogQnkgZGVmYXVsdCB3ZSBhc3NpZ24gYHZlY3RvckluZGV4YCB0byBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4YFxuICogdmFsdWUgYW5kIGlmIHVzZXIgcHJvdmlkZXMgYHZlY3RvckluZGV4YCBtYW51YWxseSwgd2UgbmVlZCB0byBtYWtlIHN1cmVcbiAqIHRoZXkgYWxzbyBwcm92aWRlIGl0IGluIEtub3dsZWRnZUJhc2UgY29uc3RydWN0IGlmIHRoZSB2YWx1ZSBpcyBub3RcbiAqIGBiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtaW5kZXhgLiBTYW1lIGZvciB2ZWN0b3JGaWVsZC5cbiAqXG4gKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVJbmRleFBhcmFtZXRlcnMoXG4gIHZlY3RvckluZGV4OiBWZWN0b3JJbmRleCxcbiAgaW5kZXhOYW1lOiBzdHJpbmcsXG4gIHZlY3RvckZpZWxkOiBzdHJpbmcsXG4pIHtcbiAgaWYgKHZlY3RvckluZGV4LmluZGV4TmFtZSAhPT0gJ2JlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1pbmRleCcpIHtcbiAgICBpZiAodmVjdG9ySW5kZXguaW5kZXhOYW1lICE9PSBpbmRleE5hbWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ0RlZmF1bHQgdmFsdWUgb2YgaW5kZXhOYW1lIGlzIGBiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtaW5kZXhgLicgK1xuICAgICAgICAnIElmIHlvdSBjcmVhdGUgVmVjdG9ySW5kZXggbWFudWFsbHkgYW5kIGFzc2lnbiB2ZWN0b3JJbmRleCB0byB2YWx1ZSBvdGhlciB0aGFuJyArXG4gICAgICAgICcgYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1pbmRleGAgdGhlbiB5b3UgbXVzdCBwcm92aWRlIHRoZSBzYW1lIHZhbHVlIGluIEtub3dsZWRnZUJhc2UgY29uc3RydWN0LicgK1xuICAgICAgICAnIElmIHlvdSBjcmVhdGVkIFZlY3RvckluZGV4IG1hbnVhbGx5IGFuZCBzZXQgaXQgdG8gYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1pbmRleGAnICtcbiAgICAgICAgJyB0aGVuIGRvIG5vdCBhc3NpZ24gaW5kZXhOYW1lIGluIEtub3dsZWRnZUJhc2UgY29uc3RydWN0LicsXG4gICAgICApO1xuICAgIH1cbiAgfVxuICBpZiAodmVjdG9ySW5kZXgudmVjdG9yRmllbGQgIT09ICdiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtdmVjdG9yJykge1xuICAgIGlmICh2ZWN0b3JJbmRleC52ZWN0b3JGaWVsZCAhPT0gdmVjdG9yRmllbGQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ0RlZmF1bHQgdmFsdWUgb2YgdmVjdG9yRmllbGQgaXMgYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC12ZWN0b3JgLicgK1xuICAgICAgICAnIElmIHlvdSBjcmVhdGUgVmVjdG9ySW5kZXggbWFudWFsbHkgYW5kIGFzc2lnbiB2ZWN0b3JGaWVsZCB0byB2YWx1ZSBvdGhlciB0aGFuJyArXG4gICAgICAgICcgYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1maWVsZGAgdGhlbiB5b3UgbXVzdCBwcm92aWRlIHRoZSBzYW1lIHZhbHVlIGluIEtub3dsZWRnZUJhc2UgY29uc3RydWN0LicgK1xuICAgICAgICAnIElmIHlvdSBjcmVhdGVkIFZlY3RvckluZGV4IG1hbnVhbGx5IGFuZCBzZXQgaXQgdG8gYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC12ZWN0b3JgJyArXG4gICAgICAgICcgdGhlbiBkbyBub3QgYXNzaWduIHZlY3RvckZpZWxkIGluIEtub3dsZWRnZUJhc2UgY29uc3RydWN0LicsXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIERldGVybWluZSBzdG9yYWdlIGNvbmZpZ3VyYXRpb24gYmFzZWQgb24gdmVjdG9yIHN0b3JlIHR5cGUuXG4gKlxuICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gKi9cbmZ1bmN0aW9uIGdldFN0b3JhZ2VDb25maWd1cmF0aW9uKHBhcmFtczogU3RvcmFnZUNvbmZpZ3VyYXRpb24pOiBhbnkge1xuICBzd2l0Y2ggKHBhcmFtcy52ZWN0b3JTdG9yZVR5cGUpIHtcbiAgICBjYXNlIFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1M6XG4gICAgICBwYXJhbXMudmVjdG9yU3RvcmUgPSBwYXJhbXMudmVjdG9yU3RvcmUgYXMgVmVjdG9yQ29sbGVjdGlvbjtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1MsXG4gICAgICAgIG9wZW5zZWFyY2hTZXJ2ZXJsZXNzQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIGNvbGxlY3Rpb25Bcm46IHBhcmFtcy52ZWN0b3JTdG9yZS5jb2xsZWN0aW9uQXJuLFxuICAgICAgICAgIGZpZWxkTWFwcGluZzoge1xuICAgICAgICAgICAgdmVjdG9yRmllbGQ6IHBhcmFtcy52ZWN0b3JGaWVsZCxcbiAgICAgICAgICAgIHRleHRGaWVsZDogcGFyYW1zLnRleHRGaWVsZCxcbiAgICAgICAgICAgIG1ldGFkYXRhRmllbGQ6IHBhcmFtcy5tZXRhZGF0YUZpZWxkLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdmVjdG9ySW5kZXhOYW1lOiBwYXJhbXMuaW5kZXhOYW1lLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICBjYXNlIFZlY3RvclN0b3JlVHlwZS5QSU5FQ09ORTpcbiAgICAgIHBhcmFtcy52ZWN0b3JTdG9yZSA9IHBhcmFtcy52ZWN0b3JTdG9yZSBhcyBQaW5lY29uZVZlY3RvclN0b3JlO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogVmVjdG9yU3RvcmVUeXBlLlBJTkVDT05FLFxuICAgICAgICBwaW5lY29uZUNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICBuYW1lc3BhY2U6IHBhcmFtcy52ZWN0b3JTdG9yZS5uYW1lc3BhY2UgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgIGNvbm5lY3Rpb25TdHJpbmc6IHBhcmFtcy52ZWN0b3JTdG9yZS5jb25uZWN0aW9uU3RyaW5nLFxuICAgICAgICAgIGNyZWRlbnRpYWxzU2VjcmV0QXJuOiBwYXJhbXMudmVjdG9yU3RvcmUuY3JlZGVudGlhbHNTZWNyZXRBcm4sXG4gICAgICAgICAgZmllbGRNYXBwaW5nOiB7XG4gICAgICAgICAgICB0ZXh0RmllbGQ6IHBhcmFtcy50ZXh0RmllbGQsXG4gICAgICAgICAgICBtZXRhZGF0YUZpZWxkOiBwYXJhbXMubWV0YWRhdGFGaWVsZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICBjYXNlIFZlY3RvclN0b3JlVHlwZS5BTUFaT05fQVVST1JBOlxuICAgICAgcGFyYW1zLnZlY3RvclN0b3JlID1cbiAgICAgICAgcGFyYW1zLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVcbiAgICAgICAgICA/IChwYXJhbXMudmVjdG9yU3RvcmUgYXMgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUpXG4gICAgICAgICAgOiAocGFyYW1zLnZlY3RvclN0b3JlIGFzIEFtYXpvbkF1cm9yYURlZmF1bHRWZWN0b3JTdG9yZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBWZWN0b3JTdG9yZVR5cGUuQU1BWk9OX0FVUk9SQSxcbiAgICAgICAgcmRzQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIGNyZWRlbnRpYWxzU2VjcmV0QXJuOiBwYXJhbXMudmVjdG9yU3RvcmUuY3JlZGVudGlhbHNTZWNyZXRBcm4sXG4gICAgICAgICAgZGF0YWJhc2VOYW1lOiBwYXJhbXMudmVjdG9yU3RvcmUuZGF0YWJhc2VOYW1lLFxuICAgICAgICAgIHJlc291cmNlQXJuOiBwYXJhbXMudmVjdG9yU3RvcmUucmVzb3VyY2VBcm4sXG4gICAgICAgICAgdGFibGVOYW1lOiBwYXJhbXMudmVjdG9yU3RvcmUudGFibGVOYW1lLFxuICAgICAgICAgIGZpZWxkTWFwcGluZzoge1xuICAgICAgICAgICAgdmVjdG9yRmllbGQ6IHBhcmFtcy52ZWN0b3JGaWVsZC5yZXBsYWNlKC8tL2csICdfJyksXG4gICAgICAgICAgICBwcmltYXJ5S2V5RmllbGQ6IHBhcmFtcy52ZWN0b3JTdG9yZS5wcmltYXJ5S2V5RmllbGQsXG4gICAgICAgICAgICB0ZXh0RmllbGQ6IHBhcmFtcy50ZXh0RmllbGQudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIG1ldGFkYXRhRmllbGQ6IHBhcmFtcy5tZXRhZGF0YUZpZWxkLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYFVuc3VwcG9ydGVkIHZlY3RvciBzdG9yZSB0eXBlOiAke3BhcmFtcy52ZWN0b3JTdG9yZVR5cGV9YCxcbiAgICAgICk7XG4gIH1cbn1cbiJdfQ==